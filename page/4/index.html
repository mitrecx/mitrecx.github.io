<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/woAiLuo.jpg?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Goals determine what you are going to be">
<meta property="og:type" content="website">
<meta property="og:title" content="MITRE">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="MITRE">
<meta property="og:description" content="Goals determine what you are going to be">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MITRE">
<meta name="twitter:description" content="Goals determine what you are going to be">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/">





  <title>MITRE</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MITRE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Goals determine what you are going to be</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/22/servlet监听器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/22/servlet监听器/" itemprop="url">servlet监听器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-22T09:25:36+08:00">
                2018-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h1><p>监听器 是 servlet规范 中定义的一种特殊的组件，<strong>用来监听容器产生的事件</strong>。  </p>
<p>容器产生的事件主要有两大类：<br>1、 生命周期相关的事件<br>容器创建或销毁了 request，session，<strong>servlet上下文</strong> 时产生的事件。  </p>
<p>2、 绑定数据相关的事件<br>调用了 request，session，<strong>servlet上下文</strong> 的 setAttribute，removeAttribute 时产生的事件。  </p>
<h2 id="1-servlet-上下文"><a href="#1-servlet-上下文" class="headerlink" title="1. servlet 上下文"></a>1. servlet 上下文</h2><p><strong>什么是 servlet上下文 ？</strong><br>  容器启动之后，<strong>会为每一个web应用 创建唯一的一个符合ServletContext接口的对象</strong>。  </p>
<h3 id="1-1-特点"><a href="#1-1-特点" class="headerlink" title="1.1 特点"></a>1.1 <font color="orange">特点</font></h3><p>1、 唯一性： 一个web应用 对应唯一一个上下文。<br>2、 持久性： 只要容器没有关闭，并且应用没有被删除，则上下文会一直存在。  </p>
<p>获得上下文的 <strong>4种途径</strong>：<br><strong><font color="green">GenericServlet，或 ServletConfig，或 FilterConfig，或 HttpSession</font></strong><br>提供的 <strong>getServletContext</strong> 方法。  </p>
<h3 id="1-2-上下文的作用："><a href="#1-2-上下文的作用：" class="headerlink" title="1.2 上下文的作用："></a>1.2 <font color="orange">上下文的作用</font>：</h3><p>将数据绑定到上下文，应用可以随时访问。<br>1、绑定数据，<br>setAttribute，getAttribute，removeAttribute<br>注：<br>request.setAttribute, session.setAttribute, ServletContext.setAttribute, <strong>在绑定数据时，应该优先使用生命周期短的对象绑定</strong>，这样可以节约内存空间( request &lt; session &lt; context )。  </p>
<p>例如：<br>在 ServletA对象中绑定 一条数据，在ServletRead对象中读取并显示。<br>ServletA.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextA</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">// 获得上下文context，注：HTTPServlet 是 GenericServlet的子类</span></span><br><span class="line">		ServletContext ctx= getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将一条数据绑定到 context</span></span><br><span class="line">		ctx.setAttribute(<span class="string">"userList"</span>, <span class="string">"陈兴，mitre"</span>);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ContextRead.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextRead</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">//获得上下文context</span></span><br><span class="line">		ServletContext ctx=getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取context绑定的数据</span></span><br><span class="line">		String ul=(String)ctx.getAttribute(<span class="string">"userList"</span>);</span><br><span class="line">		out.println(ul);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>web.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>web06-context<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>write<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.ContextA<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>write<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/set<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>read<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.ContextRead<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>read<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/get<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 访问全局的初始化参数。<br>web.xml配置：<context-param\><br>ServletContext对象读取: String getInitParameter(String paramterName)  </context-param\></p>
<p>例如：<br>接着上一个例子<br>在 web.xml 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局的初始化参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>company<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>宇信<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 ServletRead.java 中读取初始化参数(添加两行代码):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextRead</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">//获得上下文context</span></span><br><span class="line">		ServletContext ctx=getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取context绑定的数据</span></span><br><span class="line">		String ul=(String)ctx.getAttribute(<span class="string">"userList"</span>);</span><br><span class="line">		out.println(ul);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取 全局的初始化参数</span></span><br><span class="line">		String companyName=ctx.getInitParameter(<span class="string">"company"</span>);</span><br><span class="line">		out.println(<span class="string">"&lt;br/&gt;"</span>+companyName);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果:<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/servlet-context-01.png" alt>  </p>
<h2 id="2-监听器"><a href="#2-监听器" class="headerlink" title="2. 监听器"></a>2. 监听器</h2><p>写一个监听器：<br>1、 写一个 java类，实现相应的监听器接口。<br>注：<br>要依据监听的事件类型来选择合适的接口。<br>比如，要监听 <strong>session</strong> 的创建和销毁，需要实现 <strong>HttpSessionListener接口</strong>。  </p>
<p>2、 实现接口方法，完成监听处理逻辑。  </p>
<p>3、 配置 web.xml  </p>
<p>实例：<br>使用监听器统计在线人数。  </p>
<p>配置web.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--首页--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>web.CountOnline<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--退出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>logout<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.LogOutServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>logout<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/logout<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>退出界面/首页 index.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=ISO-8859-1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	当前系统在线人数：</span><br><span class="line">	<span class="tag">&lt;<span class="name">%=</span> <span class="attr">application.getAttribute</span>("<span class="attr">count</span>") %&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"logout"</span> &gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>CountOnline类 实现 HttpSessionListener 接口。<br>当前浏览器 HttpSession 还不存在时，每次打开 <a href="http://localhost:8080/web06-context/" target="_blank" rel="noopener">http://localhost:8080/web06-context/</a> 地址，<br>都会触发 sessionCreated 方法，继而创建 HttpSession 对象。<br>如果当前浏览器 已经有 HttpSession 对象了，那么就不会触发 sessionCreated 方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountOnline</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  session对象创建时 会调用此方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent arg0)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session对象 正在创建.."</span>);</span><br><span class="line">		<span class="comment">// 通过HttpSessionEvent 获取 HttpSession 对象</span></span><br><span class="line">		HttpSession session=arg0.getSession();</span><br><span class="line">		<span class="comment">// 通过会话session 获取上下文ServletContext</span></span><br><span class="line">		ServletContext sctx=session.getServletContext();</span><br><span class="line">		Integer count=(Integer)sctx.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="keyword">if</span>(count==<span class="keyword">null</span>) &#123;</span><br><span class="line">			count=<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			count++;</span><br><span class="line">		&#125;</span><br><span class="line">		sctx.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * session对象销毁时 会调用此方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent arg0)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session对象 正在销毁。。"</span>);</span><br><span class="line">		HttpSession httpSession=arg0.getSession();</span><br><span class="line">		ServletContext sctx=httpSession.getServletContext();</span><br><span class="line">		Integer count=(Integer)sctx.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		count--;</span><br><span class="line">		sctx.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>退出登录(销毁HttpSession): LogOutServlet.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogOutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		HttpSession hSession=request.getSession();</span><br><span class="line">		hSession.invalidate();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/21/servlet过滤器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/21/servlet过滤器/" itemprop="url">servlet过滤器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-21T09:25:24+08:00">
                2018-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h1><p>servlet 规范中 定义的一种特殊的组件，用来拦截容器的调用过程。  </p>
<p>容器收到请求后，通常情况下会调用servlet 的 service 方法来处理请求，<br>如果有过滤器，则 <strong>容器先调用过滤器的方法</strong>。  </p>
<p><strong>注：</strong>  容器一启动，就会创建过滤器。  </p>
<h2 id="写一个-过滤器"><a href="#写一个-过滤器" class="headerlink" title="写一个 过滤器"></a>写一个 过滤器</h2><p>1、 写一个 java类，实现 <strong>Filter 接口</strong>。  </p>
<p>2、 在 <strong>doFilter方法</strong> 里，编写拦截处理逻辑。  </p>
<p>3、 配置 过滤器 ( web.xml )。  </p>
<p>实例：<br>写一个评论页面，在评论框中输入评论，<br>如果评论包含“敏感字”就不显示评论，<br>如果不包含就显示评论。  </p>
<p>1、 在根目录webContent下，写一个 <strong>comment.jsp</strong> 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"comment"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">			评论: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 写一个 CommentServlet.java， 先不考虑过滤：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> comment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line">		String comment = request.getParameter(<span class="string">"content"</span>);</span><br><span class="line">		out.println(<span class="string">"&lt;h1&gt;你的评论是: "</span> + comment + <span class="string">"&lt;/h1&gt;"</span>);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置一下 <strong>web.xml</strong> ，然后 Tomcat部署，debug ,可以正常访问，下面加入过滤器。  </p>
<p>3、写一个过滤器 <strong>CommentFilterA.java</strong>，屏蔽敏感字”傻” ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentFilterA</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器启动后，会创建过滤器对象 只会创建一个</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommentFilterA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的构造 方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器在创建好 过滤器对象 之后， 接下来会调用对象的init 方法 init 方法只会执行一次 注： 可以在web.xml 中配置</span></span><br><span class="line"><span class="comment">	 * &lt;init-param&gt;提供初始化参数 由 FilterConfig arg 来读取</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//可以定义一个属性，来保存 容器(web.xml,init-param)传过来的FilterConfig对象</span></span><br><span class="line">		<span class="comment">//config=arg0</span></span><br><span class="line">    <span class="comment">//在别处 就可以 读初始化参数:</span></span><br><span class="line">    <span class="comment">//String ils = config.getParameter("illegalString");</span></span><br><span class="line">		System.out.println(<span class="string">"FilterA init方法。。"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器调用 doFilter方法来处理请求。</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ServletRequest</span></span><br><span class="line"><span class="comment">	 *            arg0 请求对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ServletResponse</span></span><br><span class="line"><span class="comment">	 *            arg1 响应对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> FilterChain</span></span><br><span class="line"><span class="comment">	 *            arg2 过滤器链 如果调用 过滤器链 的 doFilter方法 则容器会继续向后调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest arg0, ServletResponse arg1, FilterChain arg2)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的 doFilter 方法 开始执行！"</span>);</span><br><span class="line">		<span class="comment">// 强转，因为要调用的方法是 HttpServletRequest子类的方法</span></span><br><span class="line">		HttpServletRequest request = (HttpServletRequest) arg0;</span><br><span class="line">		HttpServletResponse response = (HttpServletResponse) arg1;</span><br><span class="line">		<span class="comment">// 先执行过滤器，对请求报文 utf-8 编码处理</span></span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line"></span><br><span class="line">		String content = request.getParameter(<span class="string">"content"</span>);</span><br><span class="line">		<span class="keyword">if</span> (content.indexOf(<span class="string">"傻"</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">// 包含了敏感字</span></span><br><span class="line">			out.println(<span class="string">"&lt;h1&gt;评论包含了敏感字--傻&lt;/h1&gt;"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 没有包含敏感字，继续向后调用</span></span><br><span class="line">			arg2.doFilter(arg0, arg1);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的 doFilter 方法 执行完毕！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4、配置 <strong>web.xml</strong> , 添加 过滤器配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>web05-Filter<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filterA<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>web.CommentFilterA<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 初始化参数，非必须，通过FilterConfig对象读取 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>illegalString<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>猪<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filterA<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/comment<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>comt<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>comment.CommentServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>comt<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/comment<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>5、部署，测试可以实现过滤 “傻” 字。 第一个 <strong>java过滤器</strong> 完成。  </p>
<p><strong>注：</strong><br>当有多个过滤器时，<br>容器会依据 <strong><filter-mapping\></filter-mapping\></strong> 在web.xml 中的先后顺序 来调用。在前面的先调用。   </p>
<h2 id="java过滤器的优点"><a href="#java过滤器的优点" class="headerlink" title="java过滤器的优点"></a>java过滤器的优点</h2><p>1、 在不修改源程序的基础上，为程序增加一些过滤条件（过滤器独立于已存在的servlet程序）。   </p>
<p>2、 将多个组件相同的处理逻辑集中写在过滤器里面，方面代码维护。<br>比如，request.getSession 做登录验证。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/20/tomcat启动错误/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/tomcat启动错误/" itemprop="url">tomcat启动错误</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-20T09:20:54+08:00">
                2018-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>九月 02, 2018 4:30:51 上午 org.apache.tomcat.util.digester.SetPropertiesRule begin<br>信息: Starting Servlet Engine: Apache Tomcat/8.0.36<br>九月 02, 2018 4:30:54 上午 org.apache.jasper.servlet.TldScanner scanJars<br>信息: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.<br>九月 02, 2018 4:30:54 上午 org.apache.catalina.core.ContainerBase startInternal<br><strong><font color="red">严重: A child container failed during start</font></strong><br>java.util.concurrent.ExecutionException: org.apache.catalina.LifecycleException:<br><strong><font color="red">Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/web01copy]]</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>action<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>emp.ActionServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>action<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><url-pattern\><strong>*.do</strong></url-pattern\>被我写成了<br> <url-pattern\><strong>/*.do</strong></url-pattern\>  而导致了错误。<br> 仅仅一个 “/“ 导致起不了Tomcat。。平时一定要细心呀。  </p>
<p>我在网上搜了半天都没找到解决方法，<br>而这个错误就在 console 输出的错误提示中。  </p>
<p>总结：<br>我们把应用部署到 Tomcat 中，当Tomcat 启动不了的时候，<br>无非有两种可能(<strong>不考虑Tomcat不兼容</strong>)：<br>1、 缺少jar包（或版本不兼容）<br>2、 <strong>应用配置有问题</strong><br>而这两种可能都是应用的问题。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/20/servlet状态管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/servlet状态管理/" itemprop="url">servlet状态管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-20T09:18:01+08:00">
                2018-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><p>将浏览器和 web服务器 之间的多次交互作为一个整体来处理。<br>并且将多次交互所涉及的数据（状态）保存下来。  </p>
<h2 id="1-cookie"><a href="#1-cookie" class="headerlink" title="1. cookie"></a>1. cookie</h2><p><strong>cookie</strong> 是 服务器临时保存在浏览器端的少量数据。  </p>
<p><strong>工作原理：</strong><br>1、当 浏览器 访问服务器时，<br>服务器可以将少量数据以 <strong>set-cookie消息头</strong> 的方式发送给浏览器，<br>浏览器会将这些数据临时保存下来。<br>2、当 浏览器 <strong>再次</strong> 访问服务器时，<br>会将之前保存的这些数据以 <strong>cookie消息头</strong> 的方式发送给服务器。  </p>
<p>在 response 对象中 <strong>添加 cookie</strong>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cookie c=<span class="keyword">new</span> Cookie(String name, String value);</span><br><span class="line">response.addCookie(c);</span><br></pre></td></tr></table></figure></p>
<p>从请求对象request中 <strong>读取 cookie</strong>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求对象中的 cookie（可能是多个）</span></span><br><span class="line">Cookie[] request.getCookies();</span><br><span class="line"></span><br><span class="line">String cookie.getName();</span><br><span class="line">String cookie.getValue();</span><br></pre></td></tr></table></figure></p>
<h2 id="2-cookie-编码问题"><a href="#2-cookie-编码问题" class="headerlink" title="2. cookie 编码问题"></a>2. cookie 编码问题</h2><p><strong>如果</strong> 中文乱码，那么需要编码( encode ) 放在 cookie 中的汉字。<br>比如编码成 “utf-8” (三个字节保存一个汉字)，然后再传输。  </p>
<p><strong>编码 与 解码</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//编码：把字符串str 按照 字符集charset 编码</span></span><br><span class="line">String URLEncoder.encode(String str, String charset);</span><br><span class="line"></span><br><span class="line"><span class="comment">//解码：把字符串str 按照 字符集charset 解码</span></span><br><span class="line">String URLDecoder.decode(String str, String charset);</span><br></pre></td></tr></table></figure></p>
<p>注：对添加到 cookie 中的字符串 编码处理，在取出 浏览器发送来的 cookie 时 也要解码处理。  </p>
<h2 id="3-cookie-的生存时间"><a href="#3-cookie-的生存时间" class="headerlink" title="3. cookie 的生存时间"></a>3. cookie 的生存时间</h2><p>缺省情况下，浏览器会把cookie 保存在内存里，<br>只要浏览器不关闭，cookie 就一直存在，<br>浏览器关闭，cookie 就会被销毁。  </p>
<p>自己设置 cookie 的生存时间：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单位是秒</span></span><br><span class="line">cookieName.setMaxAge(<span class="keyword">int</span> seconds);</span><br></pre></td></tr></table></figure></p>
<p>seconds &gt; 0 , 浏览器把 cookie 保存在硬盘上，如果超过了指定时间， cookie 会被删除。<br>seconds &lt; 0 , 缺省情况。<br>seconds = 0 , cookie 会被立刻删除。一般用于删除已存在的 cookie。  </p>
<p>例如删除已存在的 cookie username：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个同名cookie username</span></span><br><span class="line">Cookie c=<span class="keyword">new</span> Cookie(<span class="string">"username"</span>,<span class="string">"轩辕荣耀"</span>);</span><br><span class="line"><span class="comment">//添加到响应对象上，用于发送给浏览器。</span></span><br><span class="line"><span class="comment">//一旦发送给浏览器会把浏览器端的同名cookie替换, 然后删除</span></span><br><span class="line">c.setMaxAge(<span class="number">0</span>);</span><br><span class="line">response.addCookie(c);</span><br></pre></td></tr></table></figure></p>
<h2 id="4-cookie-路径问题"><a href="#4-cookie-路径问题" class="headerlink" title="4. cookie 路径问题"></a>4. cookie 路径问题</h2><p>浏览器在向某个地址发请求时，会比较该地址是否匹配 cookie 的路径，如果匹配，那么响应的 cookie 会加载请求报文头里发送出去。  </p>
<p>cookie 的默认路径：<br>等于添加该 cookie 的组件 (servlet/jsp) 的路径。  </p>
<p>路径匹配规则：<br>请求路径等于cookie 的路径，<br>或者请求路径是cookie的子路径。  </p>
<h2 id="5-session-会话"><a href="#5-session-会话" class="headerlink" title="5. session 会话"></a>5. session 会话</h2><p>session： 服务器端为维护状态而创建的一个特殊的对象。  </p>
<p><strong>工作原理：</strong><br>浏览器访问服务器时，服务器会创建一个session 对象，<br>session对象 有一个唯一的id ，称之为 sessionId。<br>服务器会将 sessionId 以 cookie 的方式发送给浏览器。<br>浏览器再次访问服务器时，会将 sessionId 以 cookie的方式发送给服务器，服务器端可以利用sessionId找到对应的session对象。  </p>
<h3 id="5-1服务端如何获得-session"><a href="#5-1服务端如何获得-session" class="headerlink" title="5.1服务端如何获得 session"></a>5.1服务端如何获得 session</h3><p>方式 1<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpSession s=request.getSession(<span class="keyword">true</span>/<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure></p>
<p>true:<br>先查看 request请求 中有没有 sessionId ，<br>如果没有，就创建一个 session对象。<br>如果有，就 <strong>依据此 sessionId 查找对应的 session 对象</strong>，如果找到则返回，找不到就创建一个新的session对象。<br>false:<br>先查看 request请求 中有没有 sessionId ，<br>如果没有，返回 null<br>如果有，就 <strong>依据此 sessionId 查找对应的 session 对象</strong>，如果找到则返回，找不到就创建一个新的session对象。</p>
<p>方式 2<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常用写法</span></span><br><span class="line">HttpSession s=request.getSession();</span><br><span class="line"><span class="comment">// request.getSession(true) 的简写形式</span></span><br><span class="line"><span class="comment">// 等价于 request.getSession(true)</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-2-session-常用方法"><a href="#5-2-session-常用方法" class="headerlink" title="5.2 session 常用方法"></a>5.2 session 常用方法</h3><p>假设 有一个 session 对象 名为 sessionName：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得 session 的 id</span></span><br><span class="line">String sessionName.getId();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定数据</span></span><br><span class="line">sessionName.setAttribute(String name, Object obj);</span><br><span class="line"><span class="comment">// 根据绑定名 获得 绑定值</span></span><br><span class="line"><span class="comment">// 该方法可能返回 null</span></span><br><span class="line">Object sessionName.getAttribute(String name);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除绑定</span></span><br><span class="line">sessionName.removeAttribute(String name);</span><br></pre></td></tr></table></figure>
<h3 id="5-3-session-超时"><a href="#5-3-session-超时" class="headerlink" title="5.3 session 超时"></a>5.3 session 超时</h3><p>服务器 会将 空闲时间过长的 session对象 删除。  </p>
<p>缺省的删除时间在 Tomcat 的 server 工程中的 web.xml 中已默认配置。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml 默认 30 minutes --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可以用编程的方式修改 缺省时间：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setMaxInActiveInterval(<span class="keyword">int</span> seconds);</span><br></pre></td></tr></table></figure></p>
<h3 id="5-4-删除-session"><a href="#5-4-删除-session" class="headerlink" title="5.4 删除 session"></a>5.4 删除 session</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalidate();</span><br></pre></td></tr></table></figure>
<p>注：<br>为什么 不叫 delete 或 drop，而叫 invalidate ？<br>因为 容器在实现 invalidate 的时候，并没有删除 session 对象，而是 抹去 session 对象的值，然后重新赋值 再交给用户使用。  </p>
<h2 id="6-登录案例"><a href="#6-登录案例" class="headerlink" title="6. 登录案例"></a>6. 登录案例</h2><p>实现用户名-密码 登录系统机制 详细步骤：  </p>
<p>1、 在数据库中创建一张表(user)，用于存储用户名-密码等信息(隐私信息应当加密)。  </p>
<p>2、 包entity: 创建实体类 (User)。   </p>
<p>3、 包dao: 创建 DBUtil.java 连接数据库工具类，创建 UserDao.java 提供 数据库操作。  </p>
<p>4、 包web: ActionServlet.java   </p>
<p>5、 WebContent 目录: login.jsp 登录页面，success.jsp 登录成功页面。  </p>
<p>6、 <strong>session 验证：</strong><br>登录成功后，将一些数据绑定到 session 对象上，<br>比如，session.setAttribute(“user”,user);<br>对于需要保护的资源(success.jsp) , 添加session验证代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ActionServlet.java 代码:</span></span><br><span class="line"><span class="comment">//登录成功，将一些数据绑定到session对象上</span></span><br><span class="line">HttpSession session=request.getSession();</span><br><span class="line">session.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">response.sendRedirect(<span class="string">"success.jsp"</span>);</span><br><span class="line"><span class="comment">//登录失败/不登录 不绑定 数据到session</span></span><br></pre></td></tr></table></figure></p>
<p>success.jsp 代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object obj=session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line"><span class="comment">// 如果没有登录</span></span><br><span class="line"><span class="keyword">if</span>(obj==<span class="keyword">null</span>)&#123;</span><br><span class="line">  response.sendRedirect(<span class="string">"login.jsp"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注：<br>登录成功，就绑定一些数据到 session 对象，登录失败则不绑定。<br>所以，在登录成功的页面 需要 对session对象 验证是否有 绑定数据，<br>如果有就显示登录成功的页面，如果没有 就返回登录页面。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/02/信托业务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/02/信托业务/" itemprop="url">信托业务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-02T09:11:22+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/宇信工作/" itemprop="url" rel="index">
                    <span itemprop="name">宇信工作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="信托业务"><a href="#信托业务" class="headerlink" title="信托业务"></a>信托业务</h1><p>被委托人在委托人授权的权限内从事的民事、商事法律行为对委托人生效。<br>根据授权从事商事活动的 <strong>被委托人</strong> 又称为 <strong>经纪人</strong>。<br>根据授权从事民事诉讼、仲裁活动的 <strong>被委托人</strong> 又称为 <strong>代理人</strong>。  </p>
<h2 id="1-受托人"><a href="#1-受托人" class="headerlink" title="1. 受托人"></a>1. 受托人</h2><p><strong>受托人</strong> 是信托业务的关系人之一，又称 <strong>被委托人</strong> 或 <strong>受委托人</strong>     </p>
<p>受托人是信托业务的关系人之一，接受信托并按约定的信托条件，享受对信托财产进行管理和处理的人。<br><strong>受托人对信托财产的管理，是指不变更财物或权利的性质，而只对财产现状进行利用、改良、维护和保存</strong>;<br> 受托人对信托财产的处理，指受权对信托财产进行财物或权利的变更或消除的行为。<br> 受托人从事管理或处理财产时，必须严格遵循信托人的信托目的，对受益人的利益负责，不能借机为其自身谋利益。<br> 受托人可以由法人承当，也可以由自然人担任。   </p>
<h2 id="2-信托业务"><a href="#2-信托业务" class="headerlink" title="2. 信托业务"></a>2. 信托业务</h2><p>1、 授权<br>基于授权而形成授权人与被授权人之间<br>由法律直接规定赋予的公民权人为授权人，<strong>因他人授权而取得权利的人为被授权人</strong> 。  </p>
<p>授权人与被授权人之间因授权而形成委托(代理)关系，<br>在委托合同中当事人之间形成委托关系，<br>授权人为委托人，被授权人为被委托人(受委托人、受托人)  </p>
<p>2、 委托<br>基于委托合同而形成委托关系<br>《合同法》第三百九十六条　<strong>委托合同是委托人和受托人约定，由受托人处理委托人事务的合同</strong>。   </p>
<p>3、 代理<br>代理人（nominee/agent）是以被代理人名义进行代理活动的人。可以是自然人或法人。<br>自然人为代理人时，必须具有相应的民事行为能力；<br>法人为代理人时，其代理行为应符合法人的宗旨和业务范围。<br>代理人不得超越代理权限进行代理，不得滥用代理权。<br>代理人有权在代理权限范围内独立为意思表示，但不得损害被代理人利益。<br>代理人知道被委托事项违法仍然进行代理的，应与被代理人负连带责任。<br><del>依当事人的授权委托而确定的代理人，称为“委托代理人”或“意定代理人”；<br>依法律直接规定而确定的代理人称为“法定代理人”；<br>依人民法院或指定机关指定而确定的代理人，称为“指定代理人”。</del>   </p>
<table>
<thead>
<tr>
<th>类型</th>
<th>命名角度及对应名称</th>
<th>名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>授权</td>
<td>授权人</td>
<td>被授权人</td>
</tr>
<tr>
<td>委托</td>
<td>委托人</td>
<td>被委托人、受委托人、受托人</td>
</tr>
<tr>
<td>代理</td>
<td>被代理人、本人</td>
<td>代理人</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/贷款分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/贷款分类/" itemprop="url">贷款分类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:50:29+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/宇信工作/" itemprop="url" rel="index">
                    <span itemprop="name">宇信工作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-按贷款主体经济性质分"><a href="#1-按贷款主体经济性质分" class="headerlink" title="1. 按贷款主体经济性质分"></a>1. 按贷款主体经济性质分</h1><ol>
<li>国有及国家控股企业贷款。  </li>
<li>集体企业贷款。  </li>
<li>私营企业贷款。  </li>
<li>个体工商业者贷款。  </li>
</ol>
<h1 id="2-按贷款信用程度划分"><a href="#2-按贷款信用程度划分" class="headerlink" title="2. 按贷款信用程度划分"></a>2. 按贷款信用程度划分</h1><ol>
<li><font color="green">信用贷款</font>。指以借款人的信誉发放的贷款。  </li>
<li><p><font color="green">担保贷款</font>。指保证贷款、抵押贷款、质押贷款。<br><strong>保证贷款</strong>，指按规定的保证方式以第三人承诺在借款人不能偿还贷款时，按约定承担一般保证责任或者连带责任而发放的贷款。<br><strong>抵押贷款</strong>，指按规定的抵押方式以借款人或第三人的财产作为抵押物发放的贷款。<br><strong>质押贷款</strong>，指按规定的质押方式以借款人或第三人的动产或权利作为质物发放的贷款。  </p>
</li>
<li><p><font color="green">票据贴现</font>。指贷款人以购买借款人未到期商业票据的方式发放的贷款。  </p>
</li>
</ol>
<h1 id="3-按贷款经营属性划分"><a href="#3-按贷款经营属性划分" class="headerlink" title="3. 按贷款经营属性划分"></a>3. 按贷款经营属性划分</h1><ol>
<li>自营贷款。指贷款人以合法方式筹集的资金自主发放的贷款，其风险由贷款人承担，并由贷款人收回本金和利息。</li>
<li>委托贷款。指由政府部门、企事业单位及个人等委托人提供资金，由贷款人(即受托人)根据委托人确定的贷款对象、用途、金额、期限、利率等代为发放、监督使用并协助收回的贷款。贷款人(受托人)只收取手续费，不承担贷款风险。</li>
<li>特定贷款。指经国务院批准并对贷款可能造成的损失采取相应补救措施后责成国有独资商业银行发放的贷款。</li>
</ol>
<h1 id="4-按贷款使用期限划分"><a href="#4-按贷款使用期限划分" class="headerlink" title="4. 按贷款使用期限划分"></a>4. 按贷款使用期限划分</h1><ol>
<li><strong>短期贷款</strong>。指贷款期限在1年以内(含1年)的贷款。目前主要有6个月、1年等期限档次的短期贷款。这种贷款也称为 <strong>流动资金贷款</strong>，在整个贷款业务中所占比重很大，是金融机构最主要的业务之一。</li>
<li>中、长期贷款。中期贷款指贷款期限在1年以上(不含1年)5年以下(含5年)的贷款。长期贷款，指贷款期限在5年(不含5年)以上的贷款。人民币中、长期贷款包括固定资产贷款和专项贷款。</li>
</ol>
<h1 id="5-按贷款的使用质量划分"><a href="#5-按贷款的使用质量划分" class="headerlink" title="5. 按贷款的使用质量划分"></a>5. 按贷款的使用质量划分</h1><ol>
<li>正常贷款。指预计贷款正常周转，在贷款期限内能够按时足额偿还的贷款。</li>
<li><strong>不良贷款</strong>。不良贷款包括呆账贷款、呆滞贷款和逾期贷款。  </li>
</ol>
<p>注：<br><strong>呆账贷款</strong>，指按财政部有关规定列为呆账的贷款。<br><strong>呆滞贷款</strong>，指按财政部有关规定，逾期(含展期后到期)并超过规定年限以上仍未归还的贷款，或虽未逾期或逾期不满规定年限但生产经营已终止、项目已停建的贷款(不含呆账贷款)。  </p>
<p>自1998年起，将陆续对商业银行贷款质量按国际金融同业标准分类评级，即将银行贷款划分为 <strong>正常</strong>、<strong>关注</strong>、<strong><font color="red"> 次级、可疑、损失</font></strong>  五个等级，后三类贷款称为<strong><font color="red">“不良贷款”</font></strong>。</p>
<h1 id="6-附：贷款金额"><a href="#6-附：贷款金额" class="headerlink" title="6. 附：贷款金额"></a>6. 附：贷款金额</h1><p><font color="orange">贷款金额</font> 是贷款合同和借据上面的金额；  </p>
<p><font color="orange">贷款余额</font> 是 <strong>贷款金额</strong> 扣减还款金额后的余额。<br>简单说，<strong>贷款金额</strong> 指的发放贷款的金额，<strong>贷款余额</strong> 指的剩余的贷款金额。比如你贷款100万，你过了一个月还了10万元。贷款金额是100万元，贷款余额是90万元。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/软件工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/软件工具/" itemprop="url">软件工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:47:54+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程工具/" itemprop="url" rel="index">
                    <span itemprop="name">编程工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-编辑器"><a href="#1-编辑器" class="headerlink" title="1. 编辑器"></a>1. 编辑器</h1><h2 id="1-1-vim"><a href="#1-1-vim" class="headerlink" title="1.1 vim"></a>1.1 vim</h2><p>Linux 系统中最好用的文本编辑器之一。<br>用法参见：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vimtutor</span><br></pre></td></tr></table></figure></p>
<h2 id="1-2-UltraEdit"><a href="#1-2-UltraEdit" class="headerlink" title="1.2 UltraEdit"></a>1.2 UltraEdit</h2><p>Windows 下 <strong>最好用</strong> 的文本编辑器。<br>UltraEdit是一个很全面的编辑器：<br>HTML Editor<br>HEX Editor<br>PHP editor<br>CSS editor<br>C++ Editor<br>Shell scripts<br>PL/SQL Editor<br>Visual Basic editor</p>
<p>UE 常用的快捷键：  </p>
<ol>
<li>Ctrl+J 选中一个单词</li>
<li>F3 / Ctrl+F3 查找上一个/下一个  <strong>配合Ctrl+J 或Ctrl+F使用</strong></li>
<li>Ctrl+B 匹配括号</li>
<li>Ctrl+E 删除当前行</li>
<li>Alt+C 列模式</li>
<li>Ctrl+F5 / Alt+F5 大小写转换</li>
<li>Ctrl+F2 为当前行添加书签</li>
<li>F2 / Alt+F2 下一个/上一个书签</li>
<li>Ctrl+R 就是 replace，支持RE</li>
<li>Ctrl+N 新建new</li>
<li>Ctrl+F4 关闭Tab</li>
</ol>
<h1 id="2-Chrome浏览器"><a href="#2-Chrome浏览器" class="headerlink" title="2. Chrome浏览器"></a>2. Chrome浏览器</h1><p>chrome常用快捷键：  </p>
<ol>
<li>Ctrl+g/ Ctrl+Shift+g 搜索上一个或下一个</li>
<li>Ctrl+T 新打开一个Tab</li>
<li>Ctrl+shift+T 恢复已关闭的Tab</li>
<li>Ctrl+W 关闭当前Tab</li>
<li>Ctrl+F 搜索</li>
<li>Alt+D 选中地址栏</li>
</ol>
<h2 id="2-1-Chrome插件之Vimium"><a href="#2-1-Chrome插件之Vimium" class="headerlink" title="2.1 Chrome插件之Vimium"></a>2.1 Chrome插件之Vimium</h2><p>Vimium被称之为黑客级的插件。它可以让我们在 Chrome 中 <strong>用键盘代替鼠标</strong> 上网。<br>查看使用方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shift + /</span><br></pre></td></tr></table></figure></p>
<h2 id="2-2-Chrome插件之SwitchyOmega"><a href="#2-2-Chrome插件之SwitchyOmega" class="headerlink" title="2.2 Chrome插件之SwitchyOmega"></a>2.2 Chrome插件之SwitchyOmega</h2><p>配合软件 <strong>shadowsocks</strong> 使用，方便快捷的翻墙插件。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/servlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/servlet/" itemprop="url">servlet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:45:59+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-什么是servlet-？"><a href="#1-什么是servlet-？" class="headerlink" title="1. 什么是servlet ？"></a>1. 什么是servlet ？</h1><p>sun公司制定的一种用来<strong>扩展web服务器功能</strong> 的 <strong>组件 (规范)</strong>。<br>（1）扩展web服务器功能<br>&nbsp;&nbsp;&nbsp;web服务器只能处理静态资源的请求（即事先需要把HTML文件准备好），可以使用servlet来扩展，即web服务器可以通过调用servlet来处理动态资源的请求，比如访问数据库。<br>（2）组件规范<br>&nbsp;&nbsp;&nbsp;<strong>组件</strong>：符合一定规范，实现部分功能，并且需要部署到相应的容器内才可以运行的软件模块。<br>&nbsp;&nbsp;&nbsp;<strong>servlet</strong>是一个容器，需要部署到相应的servlet容器里才能运行。<br>&nbsp;&nbsp;&nbsp;<strong>容器</strong>：提供组件运行环境的程序。  </p>
<h1 id="2-如何写一个servlet"><a href="#2-如何写一个servlet" class="headerlink" title="2. 如何写一个servlet"></a>2. 如何写一个servlet</h1><p>不利用开发工具，纯手写一个servlet：  </p>
<ol>
<li>写一个java类，实现 Servlet接口 或者 <strong>继承 HttpServlet抽象类</strong> 。  </li>
<li>编译<br>终端 <code>javac</code> 命令编译需要引入 javax 扩展包中的 servlet-api.jar (javax.servlet.*，在 Tomcat 主目录的 lib 文件夹中有此包)。<br>如果在 eclipse 中开发，需要 Window -》 Preferences -》Server -》 Runtime Environments 下 添加 Tomcat 的主目录，同时需要注意 右击项目 -》 build path -》libraries -》 add library -》 Server Runtime 在项目上 添加 Tomcat 容器。  </li>
<li>打包（变成一个组件）<br>创建具有如下结构的文件夹：<br>APPname/（应用名）<br>&nbsp;&nbsp; WEB-INF/<br>&nbsp;&nbsp;&nbsp;&nbsp; classes/<br>&nbsp;&nbsp;&nbsp;&nbsp; lib/  (可选，放jar文件)<br>&nbsp;&nbsp;&nbsp;&nbsp; <strong>web.xml</strong> (<strong>部署描述文件</strong>)</li>
<li>部署<br>将第3步创建好的整个文件夹添加到 Tomcat容器里。<br><font color="red">注</font>： 可以使用 <strong>jar</strong> 命令将第3步创建好的整个文件夹压缩成 <strong>“.war”</strong> 的文件，然后拷贝。  </li>
<li>启动容器，访问servlet<br><a href="http://ip:port/APPname/url-pattern" target="_blank" rel="noopener">http://ip:port/APPname/url-pattern</a><br><font color="red">注</font>： <strong>url-pattern</strong> 在web.xml 文件中定义  </li>
</ol>
<h1 id="3-Tomcat是如何运行的："><a href="#3-Tomcat是如何运行的：" class="headerlink" title="3. Tomcat是如何运行的："></a>3. Tomcat是如何运行的：</h1><p>在浏览器地址栏输入一个地址<br>step1.&nbsp;  browser 根据ip, port 建立连接。<br>step2.&nbsp; browser 将相关数据 (请求参数) 打包，然后发送。<br>step3.&nbsp; Tomcat 解析请求数据包，并且将解析到的数据封装到 request 对象，同时创建一个response对象。<br>step4.&nbsp; Tomcat容器创建 servlet 对象，然后调用该对象的 service() 方法。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="red">注</font>：Tomcat 容器会将 request 和 response 传递，通过 request 获得请求参数，将处理结果写到 response 。<br>step5.&nbsp; Tomcat 容器读取 response 中的处理结果，并将处理结果打包发送给 browser。<br>step6.&nbsp; 浏览器解析相应数据包，生成相应的页面。  </p>
<h1 id="4-请求资源路径-和-请求参数"><a href="#4-请求资源路径-和-请求参数" class="headerlink" title="4. 请求资源路径 和 请求参数"></a>4. 请求资源路径 和 请求参数</h1><h2 id="4-1-web-xml-配置请求资源路径"><a href="#4-1-web-xml-配置请求资源路径" class="headerlink" title="4.1 web.xml 配置请求资源路径"></a>4.1 web.xml 配置请求资源路径</h2><p>容器如何处理请求资源路径：<br>在浏览器地址栏输入 <a href="http://ip:port/web_App_name/hello.html" target="_blank" rel="noopener">http://ip:port/web_App_name/hello.html</a><br>容器根据 <strong>应用名</strong> 找到 应用所在的目录，并去 web.xml文件 中查找有没有一个和”/hello.html” 匹配的servlet。具体调用按下列顺序：  </p>
<ol>
<li>如果 web.xml 中有，就调用此servlet。   </li>
<li>如果 web.xml 中没有，就调用 WebContent(应用主目录) 目录 下的 对应的”/hello.html” 文件。  </li>
<li>如果 Webcontent 目录下也没有资源文件， 将会报 404 。  </li>
</ol>
<p>web.xml 中配置 <url-pattern\> </url-pattern\> 有三种匹配方式：<br>1、 <strong>精确匹配</strong>  </p>
<p><url-pattern\> /hello.html </url-pattern\>  </p>
<p>2、 <strong>通配符匹配</strong>  </p>
<p><url-pattern\> /* </url-pattern\><br>使用 “ <strong>*</strong> “ 匹配 0 或 多个 字符  </p>
<p>3、 <strong>后缀匹配</strong>  </p>
<p><url-pattern\> <strong>*.do</strong> </url-pattern\><br>使用 “ <strong>*.</strong> “ 开头，后接多个字符 ,<br>比如，后接 do ，会处理所有 以 “ <strong>.do</strong> “ 结尾的请求。<br><strong>注：  后缀匹配 不以 “ / “  开头 。</strong></p>
<h2 id="4-2-请求参数"><a href="#4-2-请求参数" class="headerlink" title="4.2 请求参数"></a>4.2 请求参数</h2><p>没有请求参数：<br><a href="http://localhost:8080/TestTomcat2/wowowo" target="_blank" rel="noopener">http://localhost:8080/TestTomcat2/wowowo</a><br>有请求参数：<br><a href="http://localhost:8080/TestTomcat2/wowowo" target="_blank" rel="noopener">http://localhost:8080/TestTomcat2/wowowo</a><font color="red">?num=10</font><br><strong>问号</strong> 表示 后面是一些请求参数。num是请求参数名。<br><a href="http://localhost:8080/TestTomcat/bmi" target="_blank" rel="noopener">http://localhost:8080/TestTomcat/bmi</a><font color="red">?weight=60&amp;height=1.9</font><br><strong>&amp;</strong> 连接多个请求参数。  </p>
<h1 id="5-字符集编码问题"><a href="#5-字符集编码问题" class="headerlink" title="5. 字符集编码问题"></a>5. 字符集编码问题</h1><h2 id="servlet-输出中文有乱码"><a href="#servlet-输出中文有乱码" class="headerlink" title="servlet 输出中文有乱码"></a>servlet 输出中文有乱码</h2><p>response.getWriter().println 方法在默认情况下，会使用”iso-8859-1”来编码，而 “iso-8859-1” 编码不支持中文。  </p>
<p>解决，把响应输出编码方式 设置为 utf-8 ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>)</span><br></pre></td></tr></table></figure></p>
<p><font color="red">注意顺序</font>：先设置编码，后获取输出流 response.getWriter()。  </p>
<h2 id="表单中包含中文参数值-引起乱码"><a href="#表单中包含中文参数值-引起乱码" class="headerlink" title="表单中包含中文参数值 引起乱码"></a>表单中包含中文参数值 引起乱码</h2><p>原因：  <strong>表单</strong> 提交时，browser会对表单中的值进行编码（用页面的编码方式），服务端解码时，默认用 iso-8859-1 来解码。<br>解决，把页面字符集设置为 utf-8 同时 把服务端解码方式 设置为 utf-8 ：<br>1、 在HTML 的 &lt;head&gt; 中加个&lt;meta&gt; 标签，指定表单提交时的编码方式：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 服务端 <code>request.getParameter()</code> 必须使用相同的 <strong>字符集</strong> 解码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br></pre></td></tr></table></figure></p>
<p>该指定只对 <strong>POST请求</strong> 有效，对 <strong>GET请求</strong> 无效 (GET方法提交表单是，提交的内容在URL中，一开始就已经按照编码分析提交内容，所以 setCharacterEncoding() 对 GET 无效)。  </p>
<p><font color="red">注意顺序</font>：先设置编码，后获取 参数 request.getParameter()。   </p>
<h1 id="6-转发"><a href="#6-转发" class="headerlink" title="6. 转发"></a>6. 转发</h1><p>1、 转发：<br>一个 <strong>web 组件 (servlet/jsp)</strong> 将 未完成的处理交个另外一个 <strong>web 组件</strong> 继续做。<br>比如，一个 servlet 将处理结果 转发 给一个 jsp 来展现。  </p>
<p>2、 如何转发：  </p>
<ol>
<li>绑定数据到 request 对象上   </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//name 绑定名， obj 绑定值</span></span><br><span class="line"><span class="comment">//obj 不存在的话 就是null</span></span><br><span class="line">request.setAttribute(String name, Object Obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">//依据绑定名获得绑定值</span></span><br><span class="line">Object request.getAttribute(String name);</span><br></pre></td></tr></table></figure>
<ol>
<li>获得转发器  </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uri 是转发的地址</span></span><br><span class="line">RequestDispatcher rd= request.getRequestDispatcher(String uri);</span><br></pre></td></tr></table></figure>
<ol>
<li>转发  </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rd.forward(request, response);</span><br></pre></td></tr></table></figure>
<p>注：  </p>
<ul>
<li>转发之后 ， 浏览器的地址不变。即，浏览器访问的地址，不会随着转发而改变，转发是服务器内部的事情，浏览器并不知情。  </li>
<li>转发地址有限制，必须是同一个应用。  </li>
<li>转发可以共享请求对象，响应对象。 <strong>重定向不能共享，因为重定向浏览器会发起两次请求。第一次请求完毕会销毁request 和 response 。</strong>    </li>
</ul>
<h1 id="7-处理servlet-运行时异常"><a href="#7-处理servlet-运行时异常" class="headerlink" title="7. 处理servlet 运行时异常"></a>7. 处理servlet 运行时异常</h1><p>处理 servlet  运行时异常有两种方法：   </p>
<p>1、 转发到异常处理页面<br>绑定异常处理信息到 <strong>request</strong><br>转发到一个异常处理页面<br>编写异常处理页面  </p>
<p>2、 交个容器处理<br>将异常抛给容器，  throw new ServletException(e)<br>在 web.xml 中配置异常处理页面，<strong><error-page></error-page></strong><br>编写异常处理页面  </p>
<p>通常， <strong>系统异常</strong> (如，数据库连接断了)交给容器处理。<br><strong>应用异常</strong> (如，登录密码错误)一般使用转发来处理。  </p>
<h1 id="8-路径问题"><a href="#8-路径问题" class="headerlink" title="8. 路径问题"></a>8. 路径问题</h1><p>1、 超链接:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"delete.do"</span>&gt;</span>删除<span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 表单提交:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"add.do"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、 重定向:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"list.do"</span>);</span><br></pre></td></tr></table></figure></p>
<p>4、 转发：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"listEmp.jsp"</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="green">绝对路径</font></strong>： 以 “/”  开头。<br><strong>超链接、表单提交、重定向</strong> 写绝对路径时： 从 <strong><font color="red">应用名</font></strong> 开始写。<br><strong>转发</strong> 写绝对路径时： 从 <strong><font color="red">应用名之后</font></strong> 开始写。  </p>
<p>硬编码：路径写死，如：/webApp/jsp/hello.jsp<br>注意：  不要把 <strong>应用名</strong> 直接写在路径里！<br>应该使用下面的方法获取部署时的应用名：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String rootDir = request.getContextPath()</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="green">相对路径</font></strong>： 不以 “/” 开头。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/MySQL-安装与命令行操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/MySQL-安装与命令行操作/" itemprop="url">MySQL 安装与命令行操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:43:12+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="1-Ubuntu-安装-MySQL"><a href="#1-Ubuntu-安装-MySQL" class="headerlink" title="1. Ubuntu 安装 MySQL"></a>1. Ubuntu 安装 MySQL</h2> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 mysql-server 会要求输入 root密码</span></span><br><span class="line">sudo apt-get install mysql-server  </span><br><span class="line">apt-get isntall mysql-client</span><br><span class="line">sudo apt-get install libmysqlclient-dev</span><br></pre></td></tr></table></figure>
<p>启动 mysql 服务：<br> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br><span class="line">sudo netstat -apt | grep mysql</span><br></pre></td></tr></table></figure></p>
<p>如果看到有mysql 的 socket 处于 listen 状态则表示 启动成功。  </p>
<h2 id="2-MySQL命令行"><a href="#2-MySQL命令行" class="headerlink" title="2. MySQL命令行"></a>2. MySQL命令行</h2><h3 id="2-1-登录MySQL"><a href="#2-1-登录MySQL" class="headerlink" title="2.1 登录MySQL"></a>2.1 登录MySQL</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># -u root 表示用 root 账户登录</span></span><br><span class="line"><span class="comment"># -p 表示 password</span></span><br></pre></td></tr></table></figure>
<p>本地登录 MySQL 没有问题，但是远程登录的时候，默认是拒绝连接的，这是配置文件默认配置的问题。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/mysql</span><br><span class="line">vim mysql.conf.d/mysql.cnf</span><br><span class="line"><span class="comment"># 修改 系统变量 bind-address 为0.0.0.0 表示绑定地址任意</span></span><br><span class="line"><span class="comment"># bind-address            = 0.0.0.0</span></span><br><span class="line"></span><br><span class="line">service mysql restart</span><br><span class="line">```  </span><br><span class="line">更多 [server系统变量](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html) 详细配置 参见官方文档。</span><br><span class="line"><span class="comment">## 2.2 查看数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2.2.1显示数据库</span></span><br><span class="line">```MySQL</span><br><span class="line">show databases</span><br></pre></td></tr></table></figure></p>
<p>如果已经用 root 用户登录了，如下图，可以看到默认的 4 个数据库(不包括DBmitre，这是我后来创建的)。<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-8-23/showDatabases.png" alt>  </p>
<h3 id="2-2-2连接数据库：-use-lt-数据库名-gt"><a href="#2-2-2连接数据库：-use-lt-数据库名-gt" class="headerlink" title="2.2.2连接数据库： use &lt;数据库名&gt;"></a>2.2.2连接数据库： use &lt;数据库名&gt;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--查看当前使用的数据库，默认是NULL</span><br><span class="line">select database();</span><br><span class="line"></span><br><span class="line">--选择数据库 DBmitre</span><br><span class="line">use DBmitre;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-创建和删除数据库"><a href="#2-3-创建和删除数据库" class="headerlink" title="2.3 创建和删除数据库"></a>2.3 创建和删除数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--create database &lt;数据库名&gt;</span><br><span class="line">create database DBmitre;</span><br><span class="line"></span><br><span class="line">--drop database &lt;数据库名&gt;</span><br><span class="line">drop database DBmitre;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-创建用户"><a href="#2-4-创建用户" class="headerlink" title="2.4 创建用户"></a>2.4 创建用户</h2><p>1、增加一个用户 user1 密码为 password1，让他可以在任何主机上登录( <strong>主机地址填写为%</strong> )，并对所有数据库有查询、插入、修改、删除的权限。首先用root用户连入MYSQL，然后键入以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select,insert,update,delete on *.* to use1r@% Identified by “password1”;</span><br></pre></td></tr></table></figure></p>
<p>2、增加一个用户 user2 密码为 password2,让他只可以在localhost上登录，并可以对数据库 DBmitre 进行查询、插入、修改、删除的操作（localhost指本地主机，即MYSQL数据库所在的那台主机），这样用户即使用知道user2的密码，他也无法从internet上直接访问数据库，只能通过MYSQL主机上的web页来访问了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select,insert,update,delete on DBmitre.* to user2@localhost identified by “password2”;</span><br></pre></td></tr></table></figure></p>
<p>3、如果你不想 user2 有密码，可以再打一个命令将密码消掉。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select,insert,update,delete on DBmitre.* to user2@localhost identified by “”;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-5-其他命令"><a href="#2-5-其他命令" class="headerlink" title="2.5 其他命令"></a>2.5 其他命令</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> --显示MYSQL的版本</span><br><span class="line"> select version();</span><br><span class="line"></span><br><span class="line">--当前选择的数据库</span><br><span class="line">select database();</span><br><span class="line"></span><br><span class="line">--当前用户及数据库连接地址</span><br><span class="line">select user();</span><br></pre></td></tr></table></figure>
<h1 id="3-字符集问题"><a href="#3-字符集问题" class="headerlink" title="3. 字符集问题"></a>3. 字符集问题</h1><p>查看表的字符集<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show create table table_name \G;</span><br><span class="line"></span><br><span class="line">--查看字符集</span><br><span class="line">show variables like &apos;%char%&apos;;</span><br></pre></td></tr></table></figure></p>
<p>修改 <strong>表</strong> 的字符集：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name DEFAULT CHARACTER SET character_name;</span><br></pre></td></tr></table></figure></p>
<p>同时修改 <strong>表和列</strong> 的字符集：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name CONVERT TO CHARACTER SET utf8;</span><br></pre></td></tr></table></figure></p>
<p>注：也可以修mysql配置文件/etc/my.cnf 来改变字符集。<br>在 <strong>[mysqld]</strong> 下 添加 <strong>character_set_server=utf8</strong>  </p>
<p><strong>修改字符集，然后重启。</strong></p>
<p><strong><font color="red">JDBC 连接MySQL 这样还不能完全解决乱码问题，因为 JDBC 驱动默认的字符集 是 ISO-8859-1</font></strong>。<br>解决方法：在连接URL中加  <strong>“?useUnicode=true&amp;characterEncoding=utf8”</strong> 来指定 JDBC 驱动连接数据库的字符集。   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String driver=<span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">		String url=<span class="string">"jdbc:mysql://cherry.mitrecx.cn:3306/DBmitre"</span>;</span><br><span class="line">		Connection conn=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class.forName(driver);</span><br><span class="line">			conn=DriverManager.getConnection(url+<span class="string">"?useUnicode=true&amp;characterEncoding=utf8"</span>,<span class="string">"root"</span>,<span class="string">"1234567"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>注：<br>Oracle 数据库不会存在这样字符编码的问题。</p>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ol>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/" target="_blank" rel="noopener">MySQL 8.0 Reference Manual</a></li>
<li><a href="https://www.cnblogs.com/bluealine/p/7832219.html" target="_blank" rel="noopener">Mysql常用命令行大全</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/Linux-用户管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/Linux-用户管理/" itemprop="url">Linux 用户管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:37:15+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Linux用户管理"><a href="#Linux用户管理" class="headerlink" title="Linux用户管理"></a>Linux用户管理</h1><h2 id="1-添加用户"><a href="#1-添加用户" class="headerlink" title="1. 添加用户"></a>1. 添加用户</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加用户</span></span><br><span class="line">useradd -s /bin/bash -m mitre</span><br><span class="line"><span class="comment">#设置密码</span></span><br><span class="line">passwd mitre</span><br></pre></td></tr></table></figure>
<p>-s: name of user’s login shell<br>-m: home directory  </p>
<p>或者：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser mitre</span><br></pre></td></tr></table></figure></p>
<p><strong>useradd</strong> 和 <strong>adduser</strong> 区别：<br>useradd 如果后面不添加任何参数选项，创建出来的默认是“三无”用户：一无Home Directory，二无密码，三无系统Shell。<br>adduser 创建用户的过程是一种人机对话，系统会提示你输入各种信息，然后会根据这些信息帮你创建新用户。  </p>
<h2 id="2-删除用户"><a href="#2-删除用户" class="headerlink" title="2. 删除用户"></a>2. 删除用户</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r mitre</span><br></pre></td></tr></table></figure>
<p>-r 表示:<br>Files in the user’s home directory will be removed along with the home directory itself and the user’s mail spool.<br>Files located in other file systems will have to be searched for and deleted manually.<br>用户home目录中的文件将随home目录本身和用户的邮件卷一起删除。<br>位于其他文件系统中的文件将必须手动搜索和删除。  </p>
<h2 id="3-sudo"><a href="#3-sudo" class="headerlink" title="3. sudo"></a>3. sudo</h2><p>sudo  <strong>/ˈsuːdoʊ/</strong> :<br>以前：superuser do<br>现在：substitute user do  </p>
<p>如果用户XXX没有 <strong>superuser 权限</strong>，使用 sudo 时，会提示：  </p>
<font color="red">XXX is not in the sudoers file. This incident will be reported.</font>

<p>把XXX加入 sudoers 中：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure></p>
<p>添加:  <strong>username &nbsp;&nbsp; ALL=(ALL:ALL) ALL </strong><br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/sudoers.jpg" alt>  </p>
<h2 id="4-用户的其他操作"><a href="#4-用户的其他操作" class="headerlink" title="4. 用户的其他操作"></a>4. 用户的其他操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看哪些用户在线</span></span><br><span class="line">who -H</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换用户 substitute</span></span><br><span class="line">su username</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换到root</span></span><br><span class="line">sudo -s</span><br></pre></td></tr></table></figure>
<p>The Unix command <a href="https://en.wikipedia.org/wiki/Su_(Unix" target="_blank" rel="noopener">su</a>), which stands for(代表，表示) substitute user is used by a computer user to execute commands with the privileges of another user account.</p>
<h2 id="5-references"><a href="#5-references" class="headerlink" title="5. references"></a>5. references</h2><ol>
<li><a href="https://en.wikipedia.org/wiki/Sudo" target="_blank" rel="noopener">sudo</a>  </li>
<li><a href="https://www.youtube.com/watch?v=YSSIm0g00m4" target="_blank" rel="noopener">sudo and sudoers</a>  </li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/jsp学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/jsp学习/" itemprop="url">jsp学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:32:55+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jsp/" itemprop="url" rel="index">
                    <span itemprop="name">jsp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-jsp-简介"><a href="#1-jsp-简介" class="headerlink" title="1. jsp 简介"></a>1. jsp 简介</h1><p>jsp 是 sun 公司制定的一种 <strong>服务器端动态页面技术</strong> 规范。  </p>
<p>jsp 文件以 “.jsp” 结尾，文件内容主要是 HTML 和 少量 java 代码。<strong>容器会将 jsp 文件自动转换成一个 servlet ，然后执行</strong>。   </p>
<p>我们用 (PrintWriter)out.println 可以动态地生成页面，那么为什么还需要 jsp ？<br>原因有二：  </p>
<ol>
<li>out.println 只适用于生成简单的页面。生成复杂的页面，修改将会十分困难。  </li>
<li>jsp 将页面与 java控制逻辑代码(servlet) 分开，专注 <strong>动态生成页面</strong>。简洁，简单，功能强大。  </li>
</ol>
<h1 id="2-如何写一个-jsp"><a href="#2-如何写一个-jsp" class="headerlink" title="2. 如何写一个 jsp"></a>2. 如何写一个 jsp</h1><p>step1. 创建 “.jsp” 文件  </p>
<p>step2. 添加以下内容：<br>1、 HTML(css, js) 直接写  </p>
<p>2、 java 代码：  </p>
<p>① java 代码片段<br> &lt;% java 语句; %&gt;</p>
<p>② jsp 表达式<br>&lt;%= java表达式 %&gt; 等价于 out.print(java对象);<br>jsp表达式的唯一的作用是，不用写print 语句了。。。  </p>
<p>3、 隐含对象(9个)  </p>
<p>在 jsp 文件中可以直接使用的对象：<br>out<br>request<br>response<br>session</p>
<p>4、 指令<br>指令：通知容器，在将 jsp 文件转化成 servlet 类时，做一些额外的处理，比如 导包。  </p>
<p>指令的语法：<br>&lt;%@ 指令名称 属性=属性值 %&gt;  </p>
<p><strong>page 指令：</strong><br>import 属性 用于导包<br>例如：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span> = <span class="string">"java.util.*"</span> %&gt;</span><br></pre></td></tr></table></figure></p>
<p>contentType 属性 response.setContentType() 的内容<br>pageEncoding 属性 jsp 文件的编码<br>例如：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> contentType=<span class="string">"text/html;charset=utf-8"</span> pageEncoding=<span class="string">"utf-8"</span> %&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>include指令:</strong><br>将 jsp 文件转换成 servlet 类时，将 file 属性 指定的文件的内容插入到所在位置：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"header.jsp"</span> %&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="3-jsp-是如何执行的"><a href="#3-jsp-是如何执行的" class="headerlink" title="3. jsp 是如何执行的"></a>3. jsp 是如何执行的</h1><ol>
<li><strong>容器将 jsp 文件转换成一个 servlet 类</strong>  </li>
</ol>
<p>HTML（css, js） —&gt;  放在service 方法中，用out.write 输出。  </p>
<p>&lt;% java 语句; %&gt;  —&gt; 放在service 方法中，原封不动。   </p>
<p>&lt;%= java表达式 %&gt; —&gt; 放在service 方法中，out.print(java表达式) 输出。  </p>
<ol>
<li><strong> 容器调用 servlet </strong>  </li>
</ol>
<p>可以看出，jsp 最终还是转换成 java 代码了。<br>如： hello.jsp 执行以后 生成 hello_jsp.java  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/HTTP协议的简单应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/HTTP协议的简单应用/" itemprop="url">HTTP协议的简单应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:27:44+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-什么是HTTP协议"><a href="#1-什么是HTTP协议" class="headerlink" title="1. 什么是HTTP协议"></a>1. 什么是HTTP协议</h1><p>由 <a href="https://www.w3.org/" target="_blank" rel="noopener">w3c</a> 制定的网络应用层协议，<br>规定了 <strong>浏览器与web服务器 </strong> 之间如何通信，以及数据包的结构。<br><strong>通信过程：</strong><br>step1. 建立连接<br>step2. 发送请求<br>step3. 发送相应<br>step4. 关闭连接  </p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/http-%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A81.png" alt>  </p>
<p><strong> 特点：</strong><br>一次请求，一次连接。<br>即如果浏览器需要发送新的请求，就需要建立新的连接。<br>这样设计的优点是，服务器可以利用 <strong>有限的连接</strong> 为尽可能多的 <strong>请求</strong> 服务。  </p>
<h1 id="2-HTTP数据包格式"><a href="#2-HTTP数据包格式" class="headerlink" title="2. HTTP数据包格式"></a>2. HTTP数据包格式</h1><ol>
<li><p>请求数据包<br>请求行<br>消息头<br>实体内容  </p>
</li>
<li><p>相应数据包<br>状态行<br>消息头<br>实体内容  </p>
</li>
</ol>
<p>利用 eclipse 自带的抓包工具 抓个包：<br>打开 window -&gt; show view -&gt; other -&gt; debug -&gt; tcp/ip monitor<br>右击空白处-&gt; properties -&gt; add<br>比如简单配置如下<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/eclipse-tcpIpMonitor.png" alt><br>OK 完了 start。<br>现在访问<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以下路径</span></span><br><span class="line"><span class="comment"># http://localhost:8888/TestTomcat2/bmi?height=1.7&amp;weight=100</span></span><br></pre></td></tr></table></figure></p>
<p>注意端口是8888，这个monitor就是一个代理服务器，它会转发到Tomcat 监听的8080端口。<br><a href="https://github.com/mitrecx/TestTomcat" target="_blank" rel="noopener">源代码</a>  </p>
<p>现在看看 monitor 转发了什么(show header)<br><strong>Request:</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#请求行</span></span><br><span class="line"><span class="comment">#注：GET请求会把请求参数放在路径的后面</span></span><br><span class="line">GET /TestTomcat2/bmi?height=1.7&amp;weight=100 HTTP/1.1  </span><br><span class="line"><span class="comment"># 键值对 用冒号: 隔开</span></span><br><span class="line">Host: localhost:8080      </span><br><span class="line"></span><br><span class="line"><span class="comment">#消息头</span></span><br><span class="line">Connection: keep-alive  </span><br><span class="line">Upgrade-Insecure-Requests: 1  </span><br><span class="line"><span class="comment">#浏览器信息</span></span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)AppleWebKit/537.36 (KHTML, like Gecko)Chrome/68.0.3440.84 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8  </span><br><span class="line">Accept-Encoding: gzip, deflate, br  </span><br><span class="line">Accept-Language: en,zh;q=0.9,lb;q=0.8,zh-CN;q=0.7,en-US;q=0.6  </span><br><span class="line"></span><br><span class="line"><span class="comment">#实体内容</span></span><br><span class="line"><span class="comment">#这是一个GET请求，实体内容没有数据！</span></span><br><span class="line"><span class="comment">#只有POST请求，才有内容</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Response:</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#状态行</span></span><br><span class="line">HTTP/1.1 200</span><br><span class="line"></span><br><span class="line"><span class="comment">#消息头</span></span><br><span class="line"><span class="comment">#Content-Type服务器返回的数据类型</span></span><br><span class="line">Content-Type: text/html;charset=ISO-8859-1  </span><br><span class="line">Content-Length: 39  </span><br><span class="line">Date: Wed, 08 Aug 2018 16:31:22 GMT</span><br><span class="line"></span><br><span class="line"><span class="comment">#实体内容</span></span><br><span class="line">34.602076124567475</span><br><span class="line">&lt;h1&gt;my pride&lt;/h1&gt;</span><br><span class="line"><span class="comment">#浏览器解析其中的数据，生成相应的页面</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-HTTP的两种请求方式"><a href="#3-HTTP的两种请求方式" class="headerlink" title="3. HTTP的两种请求方式"></a>3. HTTP的两种请求方式</h1><h2 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h2><p>以下情况，浏览器发送 get 请求  </p>
<ol>
<li>直接输入url</li>
<li>点击链接</li>
<li>表单默认提交方式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--表单的 提交方式method 默认就是get --&gt;</span><br><span class="line">&lt;form method=&quot;get&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>GET请求特点：  </p>
<ol>
<li>请求参数放在请求资源路径的后面</li>
<li>最多只能提交2k字节</li>
<li>不安全</li>
</ol>
<h2 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h2><p>以下情况，浏览器发送 post 请求</p>
<ol>
<li>设置表单 method=”post”   </li>
</ol>
<figure class="highlight xhtml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 模拟content-type消息头 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"font-size:30px;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"TestTomcat2"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">legend</span>&gt;</span>欢迎<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">        身高：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"height"</span>/&gt;</span></span><br><span class="line">        体重：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"weight"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"确定"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开URL</span></span><br><span class="line">http://localhost:8888/TestTomcat2</span><br><span class="line"><span class="comment"># 填好表单，点击提交</span></span><br><span class="line"><span class="comment"># 将会自动跳转到以下URL，请求参数不会显示出来</span></span><br><span class="line">http://localhost:8888/TestTomcat2/bmi</span><br></pre></td></tr></table></figure>
<p>post 请求特点：</p>
<ol>
<li>不会把请求参数显示在URL中</li>
<li>相对安全  （注：不会对请求参数加密）</li>
</ol>
<h1 id="4-HTTP-状态码："><a href="#4-HTTP-状态码：" class="headerlink" title="4. HTTP 状态码："></a>4. HTTP 状态码：</h1><p>404 :    </p>
<p><font color="red">HTTP Status 404 – Not Found</font> 没有资源<br>描述：The requested resource is not available.<br>或者是，The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.  </p>
<p><font color="purple">可能原因：</font>  </p>
<ol>
<li>请求地址写错  </li>
<li>没有部署该应用</li>
<li>map.xml 中，<servlet-name> 不一致</servlet-name></li>
</ol>
<p>500 :  </p>
<p><font color="red">HTTP Status 500 – Internal Server Error</font> 服务器程序运行错误<br>cannot be cast to javax.servlet.Servlet  </p>
<p><font color="purple">可能原因：</font>  </p>
<ol>
<li>我们自己写的 servlet 没有继承 HTTPServlet. (console: cannot be cast to javax.servlet.Servlet)  </li>
<li>map.xml 中，<servlet-class> 写错了，包中没有这个 class。  </servlet-class></li>
<li>代码写的不严谨，比如 对请求参数没有做检查就去转换。  </li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/远程桌面Ubuntu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/远程桌面Ubuntu/" itemprop="url">远程桌面Ubuntu</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:20:54+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/远程桌面/" itemprop="url" rel="index">
                    <span itemprop="name">远程桌面</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="远程桌面Ubuntu"><a href="#远程桌面Ubuntu" class="headerlink" title="远程桌面Ubuntu"></a>远程桌面Ubuntu</h1><p>Linux 有 ssh ，Windows 有 Xshell ，那么还要远程桌面干嘛？？<br><strong>ssh隧道 虽然强大</strong>，但是在安装 Oracle Weblogic Server/Oracle数据库 的时候，ssh 将束手无策。<br>有了图形桌面，在服务端安装 Oracle产品 将易如反掌。  </p>
<h2 id="1-服务端-Ubuntu"><a href="#1-服务端-Ubuntu" class="headerlink" title="1. 服务端(Ubuntu)"></a>1. 服务端(Ubuntu)</h2><p>不论是 Windows 还是 Linux 远程连接 Ubuntu 都需要在远程服务端安装 <strong>桌面环境</strong> 。  </p>
<h3 id="1-1-xrdp-和-vnc"><a href="#1-1-xrdp-和-vnc" class="headerlink" title="1.1 xrdp 和 vnc"></a>1.1 xrdp 和 vnc</h3><p><a href="http://www.xrdp.org/" target="_blank" rel="noopener">xrdp</a>: An open source <strong><font color="red">remote desktop protocol(rdp)</font></strong> server.<br>xrdp uses <strong>the remote desktop protocol</strong> to present a <strong>GUI(Graphical User Interface)</strong> to the user.   </p>
<p><a href="https://en.wikipedia.org/wiki/Virtual_Network_Computing" target="_blank" rel="noopener">vnc</a> 是一种 <strong>图形桌面共享系统</strong>(graphical desktop sharing system)。它利用 RFB协议(Remote Frame Buffer protocol) 来远程控制另一台计算机。  </p>
<h3 id="1-2-在Ubuntu上安装桌面环境"><a href="#1-2-在Ubuntu上安装桌面环境" class="headerlink" title="1.2 在Ubuntu上安装桌面环境"></a>1.2 在Ubuntu上安装桌面环境</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装xrdp</span></span><br><span class="line">sudo apt-get install xrdp</span><br></pre></td></tr></table></figure>
<p>仅仅安装 xrdp 协议，还不能在windows上使用 远程桌面 连接到Ubuntu。<br>还要安装vnc4Server才行：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装vnc4server</span></span><br><span class="line">sudo apt-get install vnc4server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装xubuntu-desktop</span></span><br><span class="line">sudo apt-get install xubuntu-desktop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向xsession中写入xfce4-session(每个用户需要单独运行)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"xfce4-session"</span> &gt;~/.xsession</span><br></pre></td></tr></table></figure></p>
<p>开启xrdp服务<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service xrdp restart</span><br></pre></td></tr></table></figure></p>
<h2 id="2-本地端-Linux-Windows"><a href="#2-本地端-Linux-Windows" class="headerlink" title="2. 本地端(Linux/Windows)"></a>2. 本地端(Linux/Windows)</h2><h3 id="2-1-本地为-Windows-环境"><a href="#2-1-本地为-Windows-环境" class="headerlink" title="2.1 本地为 Windows 环境"></a>2.1 本地为 Windows 环境</h3><p>打开 Windows 自带的 <strong>远程桌面连接</strong> 工具，输入 <strong>服务端</strong> IP 和 用户名，密码 就可以连接了。  </p>
<h3 id="2-2-本地为-Linux-环境"><a href="#2-2-本地为-Linux-环境" class="headerlink" title="2.2 本地为 Linux 环境"></a>2.2 本地为 Linux 环境</h3><p>暂时没试，以后再说。<br>2018-8-21</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/Linux-安装weblogic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/01/Linux-安装weblogic/" itemprop="url">Linux 安装weblogic</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-01T21:13:13+08:00">
                2018-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblogic/" itemprop="url" rel="index">
                    <span itemprop="name">weblogic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Ubuntu16-04-上搭建-weblogic-应用服务器"><a href="#Ubuntu16-04-上搭建-weblogic-应用服务器" class="headerlink" title="Ubuntu16.04 上搭建 weblogic 应用服务器"></a>Ubuntu16.04 上搭建 weblogic 应用服务器</h1><p>weblogic简介：<br>Oracle WebLogic Server is a scalable, enterprise-ready Java Platform, Enterprise Edition (Java EE) application server.<br> The WebLogic Server infrastructure(基础设施) supports the deployment(部署) of many types of distributed applications(分布式应用程序) and is an ideal foundation for building applications based on Service Oriented Architectures (SOA).<br>Oracle WebLogic Server是一个可扩展的企业Java平台，企业版（Java EE）应用服务器。<br>WLS设施支持的许多类型的分布式应用程序的部署，它是一个基于面向服务的架构（SOA）的理想的构建应用的基础。<br><strong>简单来讲：WLS是一个企业级的应用服务器。</strong>  </p>
<h2 id="1-准备工作-–-java开发环境"><a href="#1-准备工作-–-java开发环境" class="headerlink" title="1. 准备工作 – java开发环境"></a>1. 准备工作 – java开发环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>如果没有jdk环境的话，首先安装jdk。<br>安装方法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:webupd8team/java</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install oracle-java8-installer</span><br></pre></td></tr></table></figure></p>
<p>如果不能使用 <strong>add-apt-repository</strong> ，那么需要安装：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-software-properties</span><br><span class="line">apt-get install software-properties-common</span><br></pre></td></tr></table></figure></p>
<h2 id="2-安装weblogic"><a href="#2-安装weblogic" class="headerlink" title="2. 安装weblogic"></a>2. 安装weblogic</h2><h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h3><p><a href="http://www.oracle.com/technetwork/middleware/weblogic/downloads/index.html" target="_blank" rel="noopener">下载weblogic</a>.  下载选择 generic installer(通用下载器) 即可。  </p>
<p>其实安装WebLogic Server 非常简单。由于你对 <strong>Linux 图形桌面环境</strong> 不了解，那么你可能会走一点弯路。    </p>
<p>工作需要，我买了阿里的云主机MITRE(Ubuntu16.04)。ssh 连接到MITRE上，然后在终端操作安装weblogic，可是，总是报 <font color="red">X11</font> 与图形桌面相关的错误。<br>明明是按照Oracle官网的安装教程走的，不可能错的啊！！<br>于是在自己的laptop(Ubuntu16.04)上也安装了一遍。第一步就出问题了！<br>查看相关资料验证了我的猜想，<strong><a href="https://www.oracle.com/index.html" target="_blank" rel="noopener">Oracle</a> 的WebLogic Server安装必须要有桌面环境</strong>。  </p>
<p><a href="https://mitrecx.github.io/2018/09/01/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2Ubuntu/" target="_blank" rel="noopener">远程桌面Ubuntu16.04 的方法，参考这里</a></p>
<p>执行 jar文件 开始安装，基本上全选默认:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar fmw_12.2.1.3.0_wls_generic.jar</span><br></pre></td></tr></table></figure></p>
<p><a href="https://docs.oracle.com/en/middleware/lifecycle/12.2.1.3/wlsig/installing-oracle-weblogic-server-and-coherence-software.html#GUID-E4241C14-42D3-4053-8F83-C748E059607A" target="_blank" rel="noopener">安装WebLogic Server细节问题，参考这里</a></p>
<h3 id="2-2-建域"><a href="#2-2-建域" class="headerlink" title="2.2 建域"></a>2.2 建域</h3><p>创建一个域(domain)：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># weblogic 12c 建域的脚本在这个目录下 /Oracle/Middleware/Oracle_Home/oracle_common/common/bin</span></span><br><span class="line"><span class="comment"># 其他版本的weblogic ，查找建域脚本所在目录</span></span><br><span class="line">find . -name <span class="string">"config.sh"</span> -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开 find 到的那个目录</span></span><br><span class="line"><span class="built_in">cd</span> config_dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行建域脚本</span></span><br><span class="line">./config.sh</span><br></pre></td></tr></table></figure></p>
<p><strong>注1</strong> : 需要输入密码，模式选product 而不选 development。    </p>
<p><strong>注2</strong> : weblogic 12c 在 Middleware/wlserver 目录下也有一个 config.sh , 但这个目录下的脚本是不建议( <strong>deprecated</strong> )使用的。可以自行打开查看。    </p>
<p><strong>注3</strong> :<strong><font color="pink">我这里（WebLogic 12c Release）创建域也要桌面环境，但 11g 是不用的。</font></strong>。  </p>
<h3 id="2-3-配置密码文件-boot-properties"><a href="#2-3-配置密码文件-boot-properties" class="headerlink" title="2.3 配置密码文件 boot.properties"></a>2.3 配置密码文件 boot.properties</h3><p>每次在终端启动WebLogic的时候都要输入用户名、密码，很麻烦。<br>可以在AdminServer 目录下创建security/boot.properties<br>boot.properties里只要写上用户名、密码就可以了。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># domain/base_domain/servers/AdminServer/security/boot.properties</span></span><br><span class="line">username=weblogic</span><br><span class="line">password=password</span><br></pre></td></tr></table></figure></p>
<p>服务器启动一次，boot.properties会自动加密。  </p>
<h2 id="3-weblogic-相关问题"><a href="#3-weblogic-相关问题" class="headerlink" title="3. weblogic 相关问题"></a>3. weblogic 相关问题</h2><p>./startWeblogic 启动webLogic， 启动到 <strong><info\><management\> <bea-141107\></bea-141107\></management\></info\></strong> 卡住不动，<br><a href="https://blog.csdn.net/weiruoao/article/details/46349359" target="_blank" rel="noopener">据说</a>，这是JDK一个bug。<br>解决办法: 在weblogic启动脚本里 <strong>setDomainEnv.sh</strong>, 加入以下内容:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTIONS=<span class="string">"<span class="variable">$&#123;JAVA_OPTIONS&#125;</span> -Djava.security.egd=file:/dev/./urandom"</span></span><br><span class="line"><span class="built_in">export</span> JAVA_OPTIONS</span><br></pre></td></tr></table></figure></p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ol>
<li><a href="https://docs.oracle.com/cd/E24902_01/doc.91/e23434/install_config_12_1_3.htm#EOHLU214" target="_blank" rel="noopener">WebLogic Reference Guide</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/04/ubuntu软件安装问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/04/ubuntu软件安装问题/" itemprop="url">ubuntu软件安装问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-04T12:16:53+08:00">
                2018-08-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天想安装一个ksh，结果报错了。<br>然后我发现，<strong>install</strong> 任何软件都会报同样的错。<br>错误如下：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/sourceList.png" alt><br>最后还有一句：  </p>
<p><font color="red"><br>E: Problem with MergeList /var/lib/apt/lists/ppa.launchpad.net_chris-lea_node.js_ubuntu_dists_xenial_main_binary-amd64_Packages<br></font><br>这无疑是 <strong>软件源</strong> (<font color="orange">/etc/apt/sources.list</font>)出问题了。  </p>
<p>解决办法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除apt-get install 的所有软件状态包</span></span><br><span class="line">sudo rm /var/lib/apt/lists/* -vf</span><br><span class="line"><span class="comment">#更新并覆盖所有以apt-get 方式安装的软件源或包</span></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="var-lib-apt-lists"><a href="#var-lib-apt-lists" class="headerlink" title="/var/lib/apt/lists"></a>/var/lib/apt/lists</h1><p>/var 包括系统运行时要 <strong>改变</strong> 的数据。<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/linux_var.png" alt>  </p>
<p>如果/usr是 <strong>安装时</strong> 会占用较大硬盘容量的目录，那么/var就是在系统 <strong>运作后</strong> 才会渐渐占用硬盘容量的目录。   </p>
<p>因为/var目录主要针对常态性 <strong>变动的文件</strong> ，包括缓存(cache)、登录档(log file)以及某些软件运作所产生的文件。  </p>
<p><font color="green">/var/lib/</font> 程序本身执行的过程中，需要使用到的数据文件放置的目录。<br><strong>在此目录下各自的软件有各自的目录。</strong><br>举例来说，MySQL的数据库放置到/var/lib/mysql/而rpm的数据库则放到/var/lib/rpm去。  </p>
<p><font color="green">/var/lib/apt</font> 可以理解为apt的缓存。 安装软件Source list的问题都可以试试先删除缓存，再更新：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /var/lib/apt/lists/* -vf</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></p>
<h1 id="etc-apt-sources-list-的解读"><a href="#etc-apt-sources-list-的解读" class="headerlink" title="/etc/apt/sources.list 的解读"></a><font color="orange">/etc/apt/sources.list</font> 的解读</h1><p>/etc/apt/sources.list 和/etc/apt/sources.list.d/*.list的各文件。 是 <strong>包管理工具 apt</strong> 所用的记录软件包仓库位置的配置文件。  </p>
<p><font color="orange">/etc/apt/sources.list</font>文件内容截取：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial universe</span><br><span class="line"><span class="comment"># deb-src http://cn.archive.ubuntu.com/ubuntu/ xenial universe</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</span><br><span class="line"><span class="comment">#deb-src http://cn.archive.ubuntu.com/ubuntu/ xenial-updates universe</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到，每一行(条目) 由 4个字段组成：  </p>
<ul>
<li>档案类型  </li>
<li>仓库地址</li>
<li>发行版</li>
<li>软件包分类  </li>
</ul>
<h2 id="档案类型-Archive-type"><a href="#档案类型-Archive-type" class="headerlink" title="档案类型 (Archive type)"></a>档案类型 (Archive type)</h2><p>条目的第一个词 deb 或是 deb-src 表明了所获取的软件包档案类型。<br>档案类型有两种：   </p>
<ol>
<li><strong>deb</strong> 档案类型为 <strong>二进制预编译软件包</strong> ，一般我们所用的档案类型。  </li>
<li><strong>deb-src</strong> 档案类型为用于编译二进制软件包的源代码。  </li>
</ol>
<h2 id="仓库地址-Repository-URL"><a href="#仓库地址-Repository-URL" class="headerlink" title="仓库地址 (Repository URL)"></a>仓库地址 (Repository URL)</h2><p>条目的第二个词则是软件包所在仓库的地址。我们可以更换仓库地址为其他地理位置更靠近自己的镜像来提高下载速度。<br>我用的镜像地址是 <strong>阿里云</strong> 的。  </p>
<h2 id="发行版-Distribution"><a href="#发行版-Distribution" class="headerlink" title="发行版 (Distribution)"></a>发行版 (Distribution)</h2><p>跟在仓库地址后的是发行版。<br>发行版有两种分类方法:<br>一类是 <strong>发行版的具体代号</strong>，如 <strong>xenial</strong>, trusty,  precise 等；<br>一类则是 <strong>发行版的发行类型</strong>，如oldstable, stable, testing 和 unstable。  </p>
<h2 id="软件包分类-Component"><a href="#软件包分类-Component" class="headerlink" title="软件包分类 (Component)"></a>软件包分类 (Component)</h2><p>跟在发行版之后的就是软件包的具体分类了，可以有一个或多个。  </p>
<p>Ubuntu 对软件包的分类可以用下表来表示(参考自 <a href="https://en.wikipedia.org/wiki/Ubuntu_%28operating_system%29#Package_classification_and_support" target="_blank" rel="noopener">Wikipedia</a>):  </p>
<table>
<thead>
<tr>
<th></th>
<th>自由软件</th>
<th>非自由软件</th>
</tr>
</thead>
<tbody>
<tr>
<td>官方支持的</td>
<td>Main</td>
<td>Restricted</td>
</tr>
<tr>
<td>非官方支持的</td>
<td>Universe</td>
<td>Multiverse</td>
</tr>
</tbody>
</table>
<p>universe 社区维护的自由软件。<br>multiverse 非自由软件。  </p>
<hr>
<h1 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h1><ol>
<li><a href="https://blog.csdn.net/gong_xucheng/article/details/53886271" target="_blank" rel="noopener">/etc/apt/sources.list 详解</a>   </li>
<li><a href="https://www.jb51.net/LINUXjishu/151820.html" target="_blank" rel="noopener">深入理解linux系统的目录结构</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/03/企业身份代码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/03/企业身份代码/" itemprop="url">企业身份代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-03T15:41:49+08:00">
                2018-08-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/宇信工作/" itemprop="url" rel="index">
                    <span itemprop="name">宇信工作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="我国现有现有主要机构代码"><a href="#我国现有现有主要机构代码" class="headerlink" title="我国现有现有主要机构代码"></a>我国现有现有主要机构代码</h2><p>我国现有机构代码分为两类。一是“原始码”，即由登记管理部门在法人和其他组织注册登记时发放的代码，主要包括工商部门的工商注册号、机构编制部门的机关及事业单位证书号、民政部门的社会组织登记证号等。<br>二是“衍生码”，即在法人和其他组织注册后，相关部门发放的管理码，如组织机构代码管理部门的 <strong>组织机构代码</strong>、人民银行的 <strong>机构信用代码</strong>、税务总局的纳税人识别号等。</p>
<p>1.组织机构代码。<br>组织机构代码管理部门编制的组织机构代码共9位，包含本体代码（8位）和校验码（1位）两个部分。</p>
<p>2.工商注册号。<br>工商部门编制的工商注册号共15位，包含首次登记管理机关代码（6位）、顺序码（8位）和校验码（1位）三个部分。</p>
<p>3.事业单位证书号。<br>机构编制部门编制的事业单位证书号共12位，包含举办单位类别（1位）、核准登记的机关（6位）、同一机关辖内不同事业单位（5位）三个部分。</p>
<p>4.社会组织登记证号。<br>民政部门编制的社会组织登记证号是汉字和阿拉伯数字的组合。</p>
<p>5.机构信用代码。<br>人民银行编制的机构信用代码共18位，包含准入登记管理机构类别（1位）、机构类别（2位）、行政区划（6位）、结算账户开户许可证核准号标识位（8位）、校验码（1位）五个部分。</p>
<p>6.纳税人识别号。<br>税务部门对已申领组织机构代码的纳税人编制的纳税人识别号共15位，包含行政区划码（6位）和组织机构代码（9位）两个部分。</p>
<h1 id="组织机构代码"><a href="#组织机构代码" class="headerlink" title="组织机构代码"></a>组织机构代码</h1><p>代码一共有9位： 由8位数字(或大写拉丁字母)本体代码和1位数字(或大写拉丁字母)校验码组成。<br>组织机构代码是对中华人民共和国内依法注册、依法登记的机关、企事业单位、社会团体，以及其他组织机构颁发一个在全国范围内唯一的、始终不变的代码标识。<br>如同居民的身份证一样，组织机构代码证是组织机构在社会经济活动中统一赋予的单位身份证。组织机构代码系统覆盖范围广泛，对申领代码单位的资质审核也有数字档案（档案数字化）作为凭证，可以动态追溯每一个组织机构的历史发展变化。<br>2016年10月18日，国家质量监督检验检疫总局发布《国家质量监督检验检疫总局关于修改和废止部分规章的决定》（总局令第184号），正式废止组织机构代码管理办法。<strong>组织机构代码</strong>在优化营商环境改革中<strong>退出了历史舞台</strong>。取而代之的是<strong>统一社会信用代码</strong>。  </p>
<h1 id="统一社会信用代码"><a href="#统一社会信用代码" class="headerlink" title="统一社会信用代码"></a>统一社会信用代码</h1><p>统一社会信用代码相当于让法人和其他组织拥有了一个全国统一的“身份证号”，是推动社会信用体系建设的一项重要改革措施。  </p>
<h2 id="1-发展历程"><a href="#1-发展历程" class="headerlink" title="1. 发展历程"></a>1. 发展历程</h2><p>2015年6月4日，国务院常务会议决定实施法人和其他组织统一社会信用代码制度，提升社会运行效率和信用。<br>截至2018年3月底，全国法人和非法人组织存量代码转换率为99.8%，存量证照换发率82%；全国个体工商户存量换码率95%。  </p>
<h2 id="2-构成特点"><a href="#2-构成特点" class="headerlink" title="2. 构成特点"></a>2. 构成特点</h2><p>一是嵌入了组织机构代码作为主体标识码。通过组织机构代码的唯一性确保社会信用代码不会重码。换言之，组织机构代码的唯一性完美“遗传”给统一社会信用代码。<br>二是在组织机构代码前增加行政区划代码，这个组合不难发现就是税务登记证号码。这样就提高了统一社会代码的兼容性，在过渡期内税务机关可以利用这种嵌套规则更加便利地升级到新的信用代码系统。<br>三是预留前两位给登记机关和机构类别，这样统一社会信用代码在应用中更加清晰高效，第一位便于登记机关管理，可以作为检索条目，第二位可以准确给组织机构归类，方便细化分管。<br>四是统一社会信用代码位数为18位，和身份证的位数相同，这一巧妙设计在未来“两码管两人”的应用中可以实现登记、检索、填表等统一。</p>
<h2 id="现有机构代码存在的主要问题"><a href="#现有机构代码存在的主要问题" class="headerlink" title="现有机构代码存在的主要问题"></a>现有机构代码存在的主要问题</h2><p>当前我国机构代码不统一，缺乏有效协调管理和信息共享工作机制，大多数代码仅应用于各部门内部管理，一些部门信息数据相互割裂封闭，存在信息孤岛问题。<br>各类机构代码长度、含义、作用不同，有的部门如工商、民政、机构编制部门等，在法人和其他组织成立时赋码；有的部门如人民银行、税务部门等，在行使管理职能过程中再次赋码。<br>法人和其他组织在设立和办理相关业务时，需到多个部门申请代码，有的还收取费用。多个代码共存现象较为普遍，影响了同一主体信息比对，增加了社会负担，降低了行政效率。</p>
<h1 id="机构信用代码"><a href="#机构信用代码" class="headerlink" title="机构信用代码"></a>机构信用代码</h1><p><strong>机构信用代码</strong> 是 <strong>中国人民银行</strong> 以金融业务为基础，赋予每个机构在全国范围内唯一的，不变的编码。  </p>
<h2 id="1-什么是机构信用代码？"><a href="#1-什么是机构信用代码？" class="headerlink" title="1. 什么是机构信用代码？"></a>1. 什么是机构信用代码？</h2><p>机构信用代码，是指中国人民银行以金融业务为基础，按照一定规则赋予每一个机构在全国范围内唯一、不变的编码。<br>机构信用代码以结算账户开户许可证核准号为基础编制，共18 位，包含有准入管理部门类别、机构类别、行政区划代码等内容。</p>
<h2 id="2-什么是机构信用代码证？"><a href="#2-什么是机构信用代码证？" class="headerlink" title="2. 什么是机构信用代码证？"></a>2. 什么是机构信用代码证？</h2><p>机构信用代码证是承载机构信用代码的证书。机构信用代码证由中国人民银行统一式样和内容，记载机构信用代码、机构名称、注册地址及发证单位等信息。</p>
<h2 id="3-机构信用代码证有什么用？"><a href="#3-机构信用代码证有什么用？" class="headerlink" title="3. 机构信用代码证有什么用？"></a>3. 机构信用代码证有什么用？</h2><p>机构信用代码证已逐步在人民银行和银行业金融机构<font color="green">征信业务</font>、<font color="green">信贷业务</font>、账户业务、现金业务、<font color="green">票据业务</font>、外汇业务等领域推广应用，将成为金融系统及其他经济领域机构客户身份识别的重要手段，成为机构的“<strong>经济身份证</strong>”。<br>机构在人民银行和银行业金融机构办理业务时，出示机构信用代码证，可以得到更加方便、快捷的金融服务。<br>四、哪些机构可以申领机构信用代码证？<br>在中华人民共和国境内依法设立、从事经济活动的机关、事业单位、企业、社会团体、民办非企业以及其他组织均可申领机构信用代码。</p>
<h2 id="4-机构信用代码系统记录哪些信息？"><a href="#4-机构信用代码系统记录哪些信息？" class="headerlink" title="4. 机构信用代码系统记录哪些信息？"></a>4. 机构信用代码系统记录哪些信息？</h2><p>人民银行建设了机构信用代码系统对外提供服务，机构信用代码系统记录机构的基本信息：<br>名称、登记注册部门、注册地址、成立日期等，<br>以及机构已有的其他代码，如登记注册号、纳税人识别号等。<br>机构信用代码系统通过存储机构的信用代码和其他已有代码，实现机构信用代码与其他代码的索引和关联查询功能。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/03/work-whark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/03/work-whark/" itemprop="url">work&whark</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-03T00:42:48+08:00">
                2018-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>搭建weblogic环境</li>
<li>学习servlet</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/18/Linux系统管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/18/Linux系统管理/" itemprop="url">Linux系统管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-18T09:31:41+08:00">
                2018-02-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="root-系统管理员的登录"><a href="#root-系统管理员的登录" class="headerlink" title="root: 系统管理员的登录"></a>root: 系统管理员的登录</h1><p>管理员主要使用root用户ID履行职责。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">"^root"</span> /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>以上命令输出可以看出root用户ID为0，事实上，任何一个以0为事实UID的进程都具有root的能力。  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su -</span><br><span class="line"><span class="comment">#有时候需要用sudo执行</span></span><br><span class="line">sudo su -</span><br></pre></td></tr></table></figure>
<p>“ - ” 参数表示使用root的登录环境； 如果想保留当前用户的环境（如，主目录），就不用参数 “ - “。<br>root的提示符（PS1）通常是 #  </p>
<p>su不仅可以切换到root用户，su可以切换到任何一个用户(su [opt] [uname])：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su mitre</span><br><span class="line">su mitrecx</span><br></pre></td></tr></table></figure></p>
<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h2 id="理解-etc-passwd"><a href="#理解-etc-passwd" class="headerlink" title="理解/etc/passwd"></a>理解/etc/passwd</h2><p>除密码以外，所有用户信息都存储在/etc/passwd中。<br>这个文件曾经包含了密码，所以人们还一直在用passwd称呼它。现在密码加密存储在/etc/shadow。<br><strong>login和passwd程序会查阅这两个文件，以完成用户身份验证。</strong>  </p>
<p>passwd文件一共7个字段：  </p>
<ol>
<li><p>用户名</p>
</li>
<li><p>密码：早期UNIX系统的密码是放在这个文件中的，但因为这个文件的特性是所有程序都能够读取，所以，这样很容易造成数据被窃取，因此后来就将这个字段的密码数据改放到/etc/shadow中了</p>
</li>
<li><p>UID：用户ID，每个账号名称对应一个UID，通常UID=0表示root管理员</p>
</li>
<li><p>GID：组ID，与/etc/group有关，/etc/group与/etc/passwd差不多，是用来规范用户组信息的</p>
</li>
<li><p>用户信息说明栏： 用来解释这个账号是干什么的</p>
</li>
<li><p>家目录：home目录，即用户登陆以后跳转到的目录，以root用户为例，/root是它的家目录，所以root用户登陆以后就跳转到/root目录这里</p>
</li>
<li><p>Shell：用户使用的shell，通常使用/bin/bash这个shell，这也就是为什么登陆Linux时默认的shell是bash的原因，就是在这里设置的，如果要想更改登陆后使用的shell，可以在这里修改。另外一个很重要的东西是有一个shell可以用来替代让账号无法登陆的命令，那就是/sbin/nologin。</p>
</li>
</ol>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/Linux_etc_passwd.png" alt>  </p>
<h2 id="理解-etc-group"><a href="#理解-etc-group" class="headerlink" title="理解/etc/group"></a>理解/etc/group</h2><p>group一个4个字段：  </p>
<ol>
<li>组名  </li>
<li>密码  </li>
<li>组ID（GID）</li>
<li>属于该组的用户列表  </li>
</ol>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/Linux_etc_group.png" alt><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加用户组 gid为1314 gname为offer</span></span><br><span class="line">groupadd -g 1314 offer</span><br><span class="line"><span class="comment">#详细参数man</span></span><br></pre></td></tr></table></figure></p>
<h2 id="修改和添加用户配置文件"><a href="#修改和添加用户配置文件" class="headerlink" title="修改和添加用户配置文件"></a>修改和添加用户配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -u 210 -g dba -c <span class="string">"THE RDBMS"</span> -d /home/oracle -s /bin/ksh -m oracle</span><br></pre></td></tr></table></figure>
<p><strong>useradd   — create a new user or update default new user information</strong>  </p>
<p><strong><font color="green">-u, –uid UID</font></strong><br>The numerical value of the user’s ID. This value must be <strong>unique</strong>, <strong>unless</strong> the -o option is used. The value must be non-negative. The default is to use the smallest ID value greater than or equal to UID_MIN and greater than every<br>other user.<br><strong><font color="green">-g, –gid GROUP</font></strong><br><strong>The group name</strong> or number of the user’s initial login group. The group name must exist. A group number must refer to an already existing group.<br>If not specified, the behavior of useradd will depend on the USERGROUPS_ENAB variable in /etc/login.defs. If this variable is set to yes (or -U/–user-group is specified on the command line), a group will be created for the user, with the same name as her loginname.<br><strong><font color="green">-c, –comment COMMENT</font></strong><br>Any text string. It is generally <strong>a short description</strong> of the login, and is currently used as the field for the user’s full name.<br><strong><font color="green">-d, –home-dir HOME_DIR</font></strong><br>The new user will be created using HOME_DIR as the value for the user’s login directory. The default is to append the LOGIN name to BASE_DIR and use that as the login directory name. <strong>The directory HOME_DIR does not have to exist but will not be created if it is missing.</strong>(如果没有HOME_DIE目录，这个-d选项会失效)<br><strong><font color="green">-s, –shell SHELL</font></strong><br>The name of <strong>the user’s login shell</strong>. The default is to leave this field blank, which causes the system to select the default login shell specified by the SHELL variable in /etc/default/useradd, or an empty string by default.<br><strong><font color="green">-m, –create-home</font></strong><br><strong>Create the user’s home directory if it does not exist</strong>. The files and directories contained in the skeleton directory<br>(which can be defined with the -k option) will be copied to the home directory.  </p>
<p>一个例子：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s /bin/bash -m sm</span><br><span class="line">sudo passwd sm</span><br><span class="line">sudo userdel -r sm</span><br></pre></td></tr></table></figure></p>
<p><strong>userdel — delete a user account and related files</strong>  </p>
<p><strong><font color="green">-r, –remove</font></strong><br>Files in the user’s home directory will be removed along with the home directory itself and the user’s mail spool.<br>Files located in other file systems will have to be searched for and deleted manually.(如果没有-r选项，就不会删除用户文件,需要自己手动删除)  </p>
<h1 id="维护安全"><a href="#维护安全" class="headerlink" title="维护安全"></a>维护安全</h1><p><strong>因为计算机系统中的安全性最终与文件相关</strong>，所以错误的文件权限很容易被恶意用户用于hack。<br>维护文件安全的三种机制：  </p>
<ul>
<li>受限制的shell（可以在passwd的第七字段设置）  </li>
<li>Set-User-Id(SUID): 临时能力（不同的事实UID和真实UID）</li>
<li>粘着位</li>
</ul>
<p>粘着位，在/tmp，/usr/tmp目录下，不同的用户创建的文件其他用户可以访问，但不可以删除。这就是通过粘着位实现的。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 1755 one.txt</span><br><span class="line">ll one.txt</span><br><span class="line">-rwxr-xr-t  1 one   one     54 2月  18 13:53 one.txt*</span><br></pre></td></tr></table></figure></p>
<p>注意到，other用户的可执行的位置变成了t，即是 sticky bit。<br>这样其他用户就不能删除不归它们所有的文件。（也不能写）<br>粘着位的用处不大啊，不能删除的话，只要设置给other权限为” r - x “不就行了。。。  </p>
<h1 id="启动与关机"><a href="#启动与关机" class="headerlink" title="启动与关机"></a>启动与关机</h1><p>计算机加电后，<strong>系统</strong> 会查找所有外围设备，然后执行一系列程序，<strong>最终把内核加载到内存中</strong>。<br>内核随后生成init ( PID为1 )，init再进一步生成其他进程。<br><strong>init通常做为 initialization(n,初始化) 的缩写使用</strong><br>正常情况下，系统会处于以下这些系统相关的 <strong>运行级别（run-level）</strong> 之一：<br>0 —— 系统关机<br>1 —— 系统管理模式（加载了本地文件系统）<br>2 —— 多用户模式（NFS不可用）<br>3 —— 完全用户模式<br>5 —— Linux <strong>图形环境模式</strong><br>6 —— 关机和重启模式<br>s或S —— 单用户模式（加载文件系统）  </p>
<p>当系统重启时，init首先进入 <strong>运行级别</strong> 1或S，然后在转入用户模式（2、3或5）。<br>当系统关闭时，init转为 <strong>运行级别</strong> 0或6 。  </p>
<p>管理员可以显式使用init命令，将系统转为任意 <strong>运行级别</strong> 。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看运行级别</span></span><br><span class="line">who -r</span><br></pre></td></tr></table></figure></p>
<p>我在一天工作结束时，要关机了！<br>使用shutdown命令关闭计算机，shutdown用wall通知所有用户：系统将要关闭，并给出注销指令。<br>注：<br>一些系统（如Solaris）提供了reboot和halt命令，他们也会关闭系统，但不会向用户发出警告。<br>在管理多用户系统时，应当坚持使用shutdown。  </p>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/shutdown_k.png" alt>  </p>
<h1 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h1><p>文件系统采用目录结构，有自己的根目录。<br>操作系统通常驻留在多个文件系统上。在启动时，这些文件系统使用一种加载技术合并起来，向用户显示为单个文件系统。<br>这些文件系统中有一个特殊系统—— <strong>根文件系统</strong>。它包含UNIX的基本要素——root目录、/bin、/etc、/dev、/lib目录。<br>大多数系统还有 <strong>交换文件系统</strong> ，当系统内存中加载的内容过多时，内核会将一些进程移除内存，放到swap文件系统中。当这些交换的进程做好运行准备时，再将它们加载到内存。用户不能直接访问swap。  </p>
<p>除了这些基本的文件系统之外，还有更多的文件系统。<strong>系统文件应当与用户创建的数据文件隔离存放</strong>。因此，通常有一个/home文件系统来容纳所有用户，将/usr、/tmp等作为独立的文件系统。  </p>
<p>文件系统的4个组成部分：  </p>
<ol>
<li>启动块——这个块 <strong>包含了</strong> 一个小的 <strong>启动程序和分区表</strong>，它经常被称为主引导记录（MBR）。<font color="red">(原来，MBR在文件系统中)</font>  </li>
<li>超级块——这个区域包含了有关文件系统的全局信息。包括iNode和数据块的空闲列表。  </li>
<li>inode块——包含了文件系统中 <strong>每个文件的inode</strong>。创建一个文件时，会在这里分配一个inode。  </li>
<li>数据块——用户生成的 <strong>所有数据和程序</strong> 都存储在这一区域。  </li>
</ol>
<p><strong><font color="orange">文件系统类型</font></strong>:<br>ext4,ext3<br>nfs<br>swap<br>vfat<br>fat32<br>windows里还有NTFS  </p>
<h1 id="加载和卸载文件系统"><a href="#加载和卸载文件系统" class="headerlink" title="加载和卸载文件系统"></a>加载和卸载文件系统</h1><p>mount : mount a filesystem<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mount device dir</span></span><br><span class="line">mount  /dev/sda1 /tmp</span><br></pre></td></tr></table></figure></p>
<p>umount: unmount file systems<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#umount &#123;directory|device&#125;</span></span><br><span class="line">umount /dev/sda1</span><br></pre></td></tr></table></figure></p>
<p>注：<br>在使用mount -a时，在mount配置文件中列出的所有文件系统都将被加载。在系统启动时会执行mount -a 。<br>同样道理，shutdown会运行 umount -a 。  </p>
<h1 id="fsck：-文件系统检查"><a href="#fsck：-文件系统检查" class="headerlink" title="fsck： 文件系统检查"></a>fsck： 文件系统检查</h1><p><strong>fsck（file system consistency check，文件系统一致性检查）</strong>：<br>update守护进程每30秒调用一次sync，将超级块和 inode 的内存副本写到磁盘。<br>这一延迟为文件系统的不一致性创建了条件。如果在将超级块写到磁盘之前发生了掉电，文件系统将不在完整。<br><strong>fsck 命令用于检查和修复被破坏的文件系统。</strong>  </p>
<h1 id="管理磁盘空间"><a href="#管理磁盘空间" class="headerlink" title="管理磁盘空间"></a>管理磁盘空间</h1><h2 id="df-查看磁盘空闲空间"><a href="#df-查看磁盘空闲空间" class="headerlink" title="df: 查看磁盘空闲空间"></a>df: 查看磁盘空闲空间</h2><p><strong>df (disk free，磁盘空闲)命令分别报告每个文件系统上的空闲空间数。</strong><br>df - report file system disk space usage  </p>
<h2 id="du-磁盘利用率"><a href="#du-磁盘利用率" class="headerlink" title="du: 磁盘利用率"></a>du: 磁盘利用率</h2><p><strong>我们经常要查看一个特定目录树的使用情况，而不是整个文件系统的耗用情况</strong>。<br><strong>du（disk usage，磁盘利用率）命令会递推查看目录树。</strong><br>如果直接使用du，通常会显示很多文件（列出目录下的所有子目录，子目录的子目录…的使用情况）。一般我们可以使用 -s （summary）选项，只显示一层子目录，而且还是汇总的。  </p>
<p>查看/home目录下各用户耗用的空间量：<br><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/du_sh.png" alt>  </p>
<h2 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a>fdisk</h2><p>fdisk - manipulate disk partition table ，磁盘分区表操作工具；<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure></p>
<p>分别在不同主机上运行，结果如下：<br><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/0218_1.png" alt><br>注：<br>fdisk可以添加、删除、转换分区，自己还没有尝试，略略…  </p>
<h1 id="tar-备份文件"><a href="#tar-备份文件" class="headerlink" title="tar: 备份文件"></a>tar: 备份文件</h1><p><strong>tar — The GNU version of the tar archiving utility</strong>  </p>
<p>键选项（只能使用一个）：  </p>
<table>
<thead>
<tr>
<th>选项</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>创建一个新档案</td>
</tr>
<tr>
<td>-x</td>
<td>从档案中提取文件</td>
</tr>
<tr>
<td>-t</td>
<td>列出档案中的内容</td>
</tr>
<tr>
<td>-r, -u</td>
<td>在档案中追加文件, -u只追加比档案新的文件</td>
</tr>
</tbody>
</table>
<p>非键选项：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>-f</td>
<td>archive file，就是要操作的档案</td>
</tr>
<tr>
<td>-v</td>
<td>以长格式列出文件</td>
</tr>
<tr>
<td>-j</td>
<td>–bzip2</td>
</tr>
<tr>
<td>-z</td>
<td>–gzip, –gunzip –ungzip</td>
</tr>
</tbody>
</table>
<p>测试：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#把当前目录下的shell脚本备份到 666档案</span></span><br><span class="line">mitre@mitre-TM1701666:~/Desktop$ tar -cvf 666 *.sh</span><br><span class="line">hh.sh</span><br><span class="line">ifStr.sh</span><br><span class="line">set.sh</span><br><span class="line">test.sh</span><br><span class="line">tt.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#把 以f开头的文件 追加到 666</span></span><br><span class="line">mitre@mitre-TM1701666:~/Desktop$ tar -uvf 666 f*</span><br><span class="line">first_prog.c</span><br><span class="line">foo</span><br><span class="line"></span><br><span class="line">mitre@mitre-TM1701666:~/Desktop$ tar -tvf 666</span><br><span class="line">-rwxrwxr-x mitre/mitre      56 2018-02-03 23:43 hh.sh</span><br><span class="line">-rwxrwxr-x mitre/mitre     166 2018-02-03 15:28 ifStr.sh</span><br><span class="line">-rwxrwxr-x mitre/mitre      77 2018-02-03 22:29 set.sh</span><br><span class="line">-rwxrwxr-x mitre/mitre     209 2018-02-03 02:29 test.sh</span><br><span class="line">-rwxrwxr-x mitre/mitre     268 2018-02-10 22:03 tt.sh</span><br><span class="line">-rw-rw-r-- mitre/mitre     425 2018-02-07 13:32 first_prog.c</span><br><span class="line">-rw-rw-r-- mitre/mitre     191 2018-01-31 18:01 foo</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份目录</span></span><br><span class="line">mitre@mitre-TM1701666:~/Desktop$ tar -jcvf dir.bzip2 Dir/</span><br><span class="line">Dir/</span><br><span class="line">Dir/rec_deposit</span><br><span class="line">Dir/Makefile2</span><br><span class="line">Dir/cdir/</span><br><span class="line">Dir/cdir/kk</span><br><span class="line">Dir/Makefile</span><br><span class="line">Dir/rec_deposit.o</span><br><span class="line">Dir/quit.o</span><br><span class="line">Dir/quit.c</span><br><span class="line">Dir/rec_deposit.c</span><br><span class="line">Dir/arg_check.h</span><br><span class="line">Dir/quit.h</span><br><span class="line">Dir/arg_check.c</span><br><span class="line">Dir/progs.tar</span><br><span class="line">Dir/arg_check.o</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/14/Linux系统程序设计2-进程控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/14/Linux系统程序设计2-进程控制/" itemprop="url">Linux系统程序设计2-进程控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-14T21:37:12+08:00">
                2018-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进程概述"><a href="#进程概述" class="headerlink" title="进程概述"></a>进程概述</h1><p>内核为进程映像分配内存，但还会在大量寄存器中维护控制信息。内核利用控制信息来切换进程。  </p>
<h2 id="虚拟地址空间"><a href="#虚拟地址空间" class="headerlink" title="虚拟地址空间"></a>虚拟地址空间</h2><p>在执行C程序时，“程序加载器”把磁盘上的二进制代码转移到内存中。<br>如果 <strong>进程</strong> 需要，内核还会在内存中生成额外的空间。<strong>进程可以访问这一部分内存位置</strong> 称为进程的<font color="orange">虚拟地址空间</font>。<br>虚拟地址空间划分为许多段：  </p>
<ul>
<li>文本段：包含要执行的指令(instruction)，是从磁盘文件读入的。一个程序的多个实例可以共享这个段（如：三个运行vi的用户将使用同一个文本段）。  </li>
<li>数据段：存储着程序使用的全局、静态变量。  </li>
<li>栈：存储着局部变量和函数的参数及返回地址。  </li>
<li>其他段：命令行参数和环境变量通常在栈的底部。  </li>
</ul>
<h2 id="进程表"><a href="#进程表" class="headerlink" title="进程表"></a>进程表</h2><p>每个活动的进程的属性都存储在一个结构中，这个结构代表 <strong>进程表</strong> 中的一项。<br>现代Linux/Unix在内存中维护进程表。进程表的重要属性如下：  </p>
<ul>
<li>进程的PID和PPID</li>
<li>进程的状态——运行、睡眠、僵尸等</li>
<li>进程的真实UID和GID</li>
<li>进程的事实UID和GID（effective 事实的，有效的）</li>
<li>文件说明符表</li>
<li>文件创建掩码</li>
<li>CPU使用信息</li>
<li>挂起的信号掩码</li>
<li>信号处置表</li>
</ul>
<p>一个fork子进程的 <strong>进程表项</strong> 有许多字段都是从其父进程复制而来的。<br>当子进程执行一个新程序是，进程表项保留，但一些字段会发生变化。<br><strong><font color="orange"> 进程表中包含了与信号相关的重要数据</font></strong></p>
<h1 id="进程环境"><a href="#进程环境" class="headerlink" title="进程环境"></a>进程环境</h1><p>一个进程的环境包含存储在栈底部的shell <strong>环境变量</strong>。这些变量可以在全局 environ 变量中获得，在C程序中声明如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> **environ;</span><br></pre></td></tr></table></figure></p>
<p>environ 是一个数组，其中的元素是指向char的指针（就是C风格字符串）。<br>这个数组存储的指针指向 name=value 形式的环境变量字符串。这些值可以用两个函数getenv和setenv来设置和提取：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由环境变量名提取其值value，返回指向char类型(value)的指针</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">getenv</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//envname是变量名，envval是变量值，overwrite决定是否覆盖已有值(0不覆盖，1覆盖)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setenv</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *envname, <span class="keyword">const</span> <span class="keyword">char</span> *envval, <span class="keyword">int</span> overwrite)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>举例：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取PATH的值</span></span><br><span class="line"><span class="keyword">char</span> *path = getenv(<span class="string">"PATH"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改PATH为.</span></span><br><span class="line">setenv(<span class="string">"PATH"</span>, <span class="string">"."</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<p>process.c查看一些进程属性：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"PID: %4d, PPID: %4d\n"</span>, getpid(), getppid());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"UID: %4d, GID: %4d\n"</span>, getuid(), getgid());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"EUID: %4d, EGID: %4d\n"</span>, geteuid(), getegid());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"PATH = %s\n"</span>, getenv(<span class="string">"PATH"</span>));</span><br><span class="line">        setenv(<span class="string">"PATH"</span>,<span class="string">"."</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"New PATH=%s\n"</span>,getenv(<span class="string">"PATH"</span>));</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/linux_process.png" alt>  </p>
<h1 id="fork-复制当前进程"><a href="#fork-复制当前进程" class="headerlink" title="fork: 复制当前进程"></a>fork: 复制当前进程</h1><p>通过fork()系统调用我们可以创建一个和当前进程印象一样的新进程.我们通常将新进程称为子进程,而当前进程称为父进程.<br>而子进程继承了父进程的整个地址空间,其中包括了进程上下文,堆栈地址,内存信息进程控制块(PCB)等.  </p>
<p>fork的语法很简单，但其返回方式 <strong>不同寻常</strong> :<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pid_t</span> fork(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>为使内核能够区分原进程及复制进程</strong>， fork返回两次，分别给出不同的返回值：  </p>
<ul>
<li>子进程返回0</li>
<li>父进程返回子进程的PID  </li>
</ul>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/linux_fork.png" alt><br>一个简单的fork程序：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"before fork \n"</span>);</span><br><span class="line">        pid=fork();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pid&gt;<span class="number">0</span>) <span class="comment">//返回子进程pid，在父进程中</span></span><br><span class="line">        &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"parent-----pid:%d\t ppid:%d\t child pid: %d\n"</span>, getpid(), getppid(), pid);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pid ==<span class="number">0</span>) <span class="comment">//返回0，在子进程中</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"child -----pid:%d\t ppid:%d\n"</span>,getpid(),getppid());</span><br><span class="line">        <span class="keyword">else</span>  <span class="comment">//这是返回-1的情况</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"fork error\n"</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//以下语句会输出两遍，子父进程各一遍</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Both processes continue from here\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://mitre.oss-cn-hangzhou.aliyuncs.com/blog_pic5/linux_fork_2.png" alt>  </p>
<p>以上程序中，sleep(1)是为了让父进程在子进程后执行。<strong>因为子进程和父进程的执行顺序是随机的</strong> 。  </p>
<p>fork()系统调用总结：<br>1）fork()函数的一次调用返回2次返回。<br>2）fork系统调用之后，父进程和子进程交替执行，并且它们处于不同空间中。<br>3) 将fork()返回值大于零设置为父进程,这是因为子进程获得父进程的pid相对容易,而父进程获子进程pid难,所以在fork()系统调用中将子进程的pid作为父进程的返回值，解决了获得子进程pid的问题。  </p>
<h1 id="exec-进程创建的最终步骤"><a href="#exec-进程创建的最终步骤" class="headerlink" title="exec: 进程创建的最终步骤"></a>exec: 进程创建的最终步骤</h1><p>我们执行 fork 操作以创建进程，但多半会在后面跟有 exec 操作，在子进程的地址空间中运行另外一个程序。  </p>
<h2 id="exec叙述："><a href="#exec叙述：" class="headerlink" title="exec叙述：  "></a>exec叙述：  </h2><p>在 fork 期间继承的许多属性都不会因为 exec 而改变。例如：上一个程序的文件说明符、root目录、umask设置、全局变量都保持不变。<br>不过coder可以通过两个方式来改变exec后的环境：  </p>
<ul>
<li>关闭一个或多个文件说明符，这样，在 fork 前后打开的文件就不能直接在exec的进程中读取。  </li>
<li>向exec的进程中传送一个单独的环境，而不是在environ全局变量中保存默认环境。  </li>
</ul>
<p>我们经常用 exec 这个名称来指代这种关系，并没有一个名为 exec 的系统调用。<br>事实上，有一个execve，有五个库函数都是以她为基础的。我们直接将她们称为exec或exec系列。<br>整个系列可以分为两个部分，分别为 execl 集和 execv 集。<br>注：<br>execl中的 ”l” 表示一个参数列表（list），而execv中的 “v” 表示参数数目可变（variable）。  </p>
<h2 id="两个库函数：execl和execv"><a href="#两个库函数：execl和execv" class="headerlink" title="两个库函数：execl和execv"></a>两个库函数：execl和execv</h2><p>execl不使用PATH；第一个参数（path）表示一个绝对或相对路径名；其他参数表示命令行中的每个单词。<br>execl用法：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int execl(const char *path, const char *arg0, ..., (char *) );</span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execl(<span class="string">"/bin/wc"</span>, <span class="string">"wc"</span>, <span class="string">"-l"</span>, <span class="string">"foo"</span>, (<span class="keyword">char</span> *) <span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>在例子中我们看到，execl的参数以 <strong>(char *) 0</strong> 结尾，这就是一个0，被强制转换为指向char的指针，相当于NULL。<br>例子表达的意思就是：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -l foo</span><br></pre></td></tr></table></figure></p>
<p>因为execl要求单独指定命令行的每个单词，所以如果 <strong>在运行是才能知道参数</strong> ，execl就无法使用了。解决办法是用execv。<br>execv也不使用PATH，第一个参数（path）表示一个绝对或相对路径名；第二个参数是一个存放字符型指针的数组，数组里存放的是要执行的命令。<br>execv用法：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execv</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, <span class="keyword">char</span> *<span class="keyword">const</span> argv[])</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *cmdargs[]=&#123;<span class="string">"wc"</span>, <span class="string">"-l"</span>, <span class="string">"/etc/passwd"</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">execv(<span class="string">"/bin/wc"</span>, cmdargs);</span><br></pre></td></tr></table></figure></p>
<p>相当于shell中的：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -l /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p><del>其实我并没有感觉execv有优越性。</del><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  execl(<span class="string">"/bin/wc"</span>, <span class="string">"wc"</span>, <span class="string">"-l"</span>, <span class="string">"/etc/passwd"</span>, (<span class="keyword">char</span> *)<span class="number">0</span> );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"execl error"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为什么最后写一句”输出错误”？<br>因为除非导致错误，否则对exec的调用不会返回。  </p>
<h2 id="其他exec成员"><a href="#其他exec成员" class="headerlink" title="其他exec成员"></a>其他exec成员</h2><p>execlp和execvp：<br>这些函数使用PATH查找命令的位置，所以第一参数只要给出命令名即可。<br>这里略过。  </p>
<h1 id="收集退出状态：wait-和-waitpid"><a href="#收集退出状态：wait-和-waitpid" class="headerlink" title="收集退出状态：wait 和 waitpid"></a>收集退出状态：wait 和 waitpid</h1><p>一般情况下，一个进程的终止要么是通过main，要么是调用exit或return。它向调用者返回退出状态，这一状态可以在shell中的参数 “$?” 中获得。<br>当一个进程终止而又没有显式调用exit时，退出状态为 0 。在任何一种情况下，内核都会关闭所有已打开文件，刷新所有输出流，释放进程地址空间。<strong>但进程没有被完全删除</strong>。<br>接下来，内核将退出状态放在进程表中，并将子进程的状态改为僵尸（zombie）。这一机制是“寄希望于” <strong>父进程最终可能调用wait或waitpid</strong>，以拾取退出状态。<br>如果父进程最终这样做了，内核就释放该进程表项，并从系统中删除该进程。<br>注：<br>我们无法杀死一个僵尸，因为它不是进程，但太多的僵尸会消耗进程表的可用位置。ps输出内容在最后一列将僵尸显示为<defunct>。为清除僵尸，可能需要重启系统。  </defunct></p>
<h2 id="wait：父进程等待子进程死亡"><a href="#wait：父进程等待子进程死亡" class="headerlink" title="wait：父进程等待子进程死亡"></a>wait：父进程等待子进程死亡</h2><h2 id="waitpid：更强大的等待机制"><a href="#waitpid：更强大的等待机制" class="headerlink" title="waitpid：更强大的等待机制"></a>waitpid：更强大的等待机制</h2><p>我不清楚为什么需要 wait和waitpid，如果是为了完全删除进程，显示调用exit不就可以了吗？<br>以后理解再说明。  </p>
<hr>
<p>[1]Sumitabha Das, Your UNIX/Linux: the Ultimate Guide, Third Edition</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/14/Linux系统程序设计1-文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/14/Linux系统程序设计1-文件/" itemprop="url">Linux系统程序设计1--文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-14T19:48:53+08:00">
                2018-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-linux系统程序设计—文件"><a href="#1-linux系统程序设计—文件" class="headerlink" title="1.  linux系统程序设计—文件"></a>1.  linux系统程序设计—文件</h1><p>系统调用是一种例程。<br>系统调用用于执行文件I/O、分配内存、创建进程等。<br>标准ANSI C库函数，如fopen和printf可以作为对象模块捆绑到一个档案中。系统调用与之不同，它们内置在内核中，一般由汇编语言编写。但是，提供了接口，可以像调用函数一样调用接口。  </p>
<p><font color="orange">库函数通常不包含系统调用提供的精细控制功能</font> 。例如：<br>fopen不能设置文件权限，而open可以设置。<br>只有利用stat系统调用才能知道文件的大小。<br>只有fork系统调用才能创建进程。  </p>
<p><strong>系统调用</strong>要比调用<strong>库函数</strong> 的的开销大.  </p>
<h1 id="2-errno-和-perror：处理错误"><a href="#2-errno-和-perror：处理错误" class="headerlink" title="2.  errno 和 perror：处理错误"></a>2.  errno 和 perror：处理错误</h1><p><strong>系统调用在错误时返回-1</strong><br>错误的发生可能会有多种原因——资源不可用、接收到一个信号、I/O操作失败、调用参数无效。  </p>
<p>当系统调用返回-1时，内核将静态（全局）变量errno设定为一个正整数。这个<strong>用符号常量表示的整数</strong>与<strong>错误消息</strong>相关联。  </p>
<p>仅当系统调用返回错误时才使用perror。<br>perror函数语法：<br>void perror(const char *s)  ;<br>函数的以一个字符串s为参数。函数输出：打印该字符串s、一个冒号、一个空格，然后是与errno相关联的消息。  </p>
<table>
<thead>
<tr>
<th>符号常量</th>
<th>errno</th>
<th>消息</th>
</tr>
</thead>
<tbody>
<tr>
<td>E PERM</td>
<td>1</td>
<td>Operation not permitted</td>
</tr>
<tr>
<td>E NOENT</td>
<td>2</td>
<td>No such file or directory</td>
</tr>
<tr>
<td>E SRCH</td>
<td>3</td>
<td>No such process</td>
</tr>
<tr>
<td>E INTR</td>
<td>4</td>
<td>Interrupted system call</td>
</tr>
<tr>
<td>E IO</td>
<td>5</td>
<td>I/O error</td>
</tr>
<tr>
<td>E ACCES</td>
<td>13</td>
<td>Permission denied</td>
</tr>
<tr>
<td>E EXIT</td>
<td>17</td>
<td>File exits</td>
</tr>
<tr>
<td>E NOTDIR</td>
<td>20</td>
<td>Not a directory</td>
</tr>
<tr>
<td>EISDIR</td>
<td>21</td>
<td>Is a directory</td>
</tr>
</tbody>
</table>
<p>以下程序show_errors.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;  //获取open中的O_RDONLY</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  //获取fprintf中的stderr</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; //获取exit</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/error.h&gt;  //获取errno</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">  <span class="comment">//以只读模式打开</span></span><br><span class="line">  <span class="keyword">if</span>(open(argv[<span class="number">1</span>],O_RDONLY)==<span class="number">-1</span>) <span class="comment">//O表示open，RD表示read。</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"errno=%d\n"</span>, errno);</span><br><span class="line">    perror(<span class="string">"open"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行时，如：<br>$ ./a.out foofoo<br>errno = 2<br>open: No such file or directory</p>
<h1 id="3-open-打开和创建文件"><a href="#3-open-打开和创建文件" class="headerlink" title="3. open: 打开和创建文件"></a>3. open: 打开和创建文件</h1><p>一些与文件Ｉ/O相关的系统调用：　　</p>
<ul>
<li>open , close</li>
<li>read , write</li>
<li>lseek</li>
<li>truncate , ftruncate</li>
</ul>
<p><strong>在读写一个文件之前，必须要用open打开它。</strong><br>open语法：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> open（<span class="keyword">const</span> <span class="keyword">char</span> \*path, <span class="keyword">int</span> oflag, ...)  ;</span><br></pre></td></tr></table></figure></p>
<p><strong>open以int形式返回一个文件说明符 (<font color="orange"> file description</font> ) 。当发生错误时，open返回 -1 。</strong><br>第一个参数(path)是一个指针，指向一个表示文件路径名的字符串(绝对路径或相对路径)，<br>第二个参数(oflag)用于<strong>设置打开模式</strong>(读、写或读-写)。这一模式用三个符号常量表示：<br><strong>O_RDONLY</strong> 打开文件供读取<br><strong>O_WRONLY</strong>  打开文件供写入<br><strong>O_RDWR</strong>    打开文件供读和写<br>这些常量在/usr/include下的文件 fcnlt.h 中定义。<br>用法:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fd;</span><br><span class="line"><span class="comment">//以只读方式打开passwd文件，如果打开出错，就打印错误</span></span><br><span class="line"><span class="keyword">if</span>( (fd=open(<span class="string">"/etc/passwd"</span>,O_RDONLY)) == <span class="number">-1</span>)&#123;</span><br><span class="line">  perror(<span class="string">"open"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此外，open还有更多打开模式 ( 也在fcntl.h中定义 ):<br><strong>O_APPEND</strong>  追加模式打开文件(仅当打开模式为O_WRONLY或O_RDWR)<br><strong>O_TRUNC</strong>  将文件截短为0(条件同上)，其实就是覆盖文件(注:truncate  截短、缩短)<br><strong>O_CREAT</strong>  若文件不存在，则创建文件<br><strong>O_EXCL</strong>   若指定O_CREAT，且该文件存在，则生成一条错误<br><strong>O_SYNC</strong>  同步读写操作。确保在将数据写到磁盘之前，write不会返回<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类似shell中的&gt;&gt;</span></span><br><span class="line">fd=open(<span class="string">"foo.txt"</span>, O_WRONLY | O_APPEND )</span><br><span class="line"><span class="comment">//类似shell中的&gt;</span></span><br><span class="line">fd=open(<span class="string">"../foo.txt"</span>, O_WRONLY | O_TRUNC )</span><br></pre></td></tr></table></figure></p>
<p>如果文件不存在，就要用O_CREAT（有时会用到O_EXCL）创建它，并在第三参数指定其权限。<br><strong>Linux/Unix在sys/stat.h中提供了符号常量以设置权限</strong><br>但是也可以，用八进制(octal)数设置权限，必须添加前缀0。（例如0644而不是644）<br>0644等同于：<br>S_IRUSR|S_IWUSR | S_IRGRP | S_IROTH<br>表示用户可读写，组可读，其他可写<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打开foo.txt，以截断方式写入，如果foo.txt不存在，就创建该文件</span></span><br><span class="line">fd = open(<span class="string">"foo.txt"</span>, O_WRONLY|O_CREAT|OTRUNC, <span class="number">0644</span>);</span><br></pre></td></tr></table></figure></p>
<h1 id="4-close-关闭文件"><a href="#4-close-关闭文件" class="headerlink" title="4. close: 关闭文件"></a>4. close: 关闭文件</h1><p><strong>程序在终止之前会关闭所有已打开文件，但不在需要文件时主动关闭是一种好习惯。</strong><br>close系统调用可以关闭一个文件:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>close用文件描述符( file description )作为参数，实际上是释放<strong>对该进程的文件说明符</strong>。<br>close成功返回0，失败返回-1.  </p>
<h1 id="5-read-读取文件"><a href="#5-read-读取文件" class="headerlink" title="5. read:  读取文件"></a>5. read:  读取文件</h1><p>两个系统调用——read和write——负责对常规文件(REG,regular)以及管道和套接字进行读写操作。<br><strong>这两个调用的语法类似，都利用了用户定义的缓冲区。</strong><br>read利用open返回的文件说明符来读取文件：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> read(<span class="keyword">int</span> fildes, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbyte);</span><br></pre></td></tr></table></figure></p>
<p>read尝试从文件说明符fildes向缓冲区buf中读取nbyte个字符。<br><strong>文件说明符</strong>就是要<strong>读取的对象</strong>，<strong>缓冲区</strong>是读取后<strong>内容存放的地方</strong>，<strong>nbyte</strong>是一次<strong>读取n个字节</strong><br>注：nbyte通常是缓冲区本身的大小<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 4096</span></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line"><span class="keyword">while</span>( (n=read(fd, buf, BUFSIZE))&gt;<span class="number">0</span> ) <span class="comment">//由open获得的fd</span></span><br></pre></td></tr></table></figure></p>
<p>每次read调用，读取4096个字节。<strong>在遇到EOF之前，read返回所读字符数，<del>而遇到EOF时，返回0</del>( 准确地说，是文件的大小是缓冲区的整数倍，最后一次遇到EOF返回0 )</strong>。但最后一次迭代可能例外，最后一次迭代中，返回的是尚未读取的字符数（因为文件的大小可能不是缓冲区大小的整数倍）。read错误返回-1。<br>例如：如上程序，fd描述的文件有4100个字节，第一次迭代read返回4096，第二次迭代read返回4个字节，第三次返回0。  </p>
<p>如果要处理所读取的每个字符，可将buf声明为一个char变量，然后将其地址传给read：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> buf;</span><br><span class="line"><span class="keyword">while</span>( (n=read(fd, &amp;buf, <span class="number">1</span>))&gt;<span class="number">0</span> )</span><br></pre></td></tr></table></figure></p>
<p>用单字符缓冲区读取100个字符需要100次系统调用，这个代价高昂。在这种情况下，诸如fgetc之类的<strong>库函数</strong>是比较好的选择。  </p>
<h1 id="6-write：-写文件"><a href="#6-write：-写文件" class="headerlink" title="6. write： 写文件"></a>6. write： 写文件</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> write(<span class="keyword">int</span> fildes, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbyte) ;</span><br></pre></td></tr></table></figure>
<p>write把<strong>缓冲区</strong>的内容写入到fildes说明的<strong>文件</strong>中。<br>write返回所写字符个数。如果write运行期间磁盘已满或文件大小超出系统限制，则write返回-1。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 8192</span></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line">n = write(fd, buf, BUFSIZE);</span><br></pre></td></tr></table></figure></p>
<p>和read一样，write可以一次写一个字符：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf;</span><br><span class="line">write(fd, &amp;buf, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<hr>
<p>一个利用系统调用复制文件的程序：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//quit.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quit</span><span class="params">(<span class="keyword">char</span> *, <span class="keyword">int</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//quit.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"quit.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quit</span><span class="params">(<span class="keyword">char</span> *message, <span class="keyword">int</span> exit_status)</span></span>&#123;</span><br><span class="line">        perror(message);</span><br><span class="line">        <span class="built_in">exit</span>(exit_status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ccp.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"quit.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fd1,fd2;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>((fd1=open(argv[<span class="number">1</span>],O_RDONLY))==<span class="number">-1</span>)</span><br><span class="line">                quit(<span class="string">"open"</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>((fd2=open(<span class="string">"passwd.bak"</span>,O_WRONLY|O_CREAT|O_TRUNC, <span class="number">0664</span>))==<span class="number">-1</span>)</span><br><span class="line">                quit(<span class="string">"open2"</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>( (n=read(fd1,buf,BUFSIZE))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(n!=write(fd2,buf,n))</span><br><span class="line">                        quit(<span class="string">"write"</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        close(fd1);</span><br><span class="line">        close(fd2);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译、运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编译quit.c 生成quit.o目标文件</span></span><br><span class="line">$ gcc -c quit.c</span><br><span class="line"></span><br><span class="line"><span class="comment">#用ccp.c和quit.o编译出a.out(默认的可执行文件名，可用-o指定别的名)</span></span><br><span class="line">$ gcc ccp.c quit.o</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行程序，复制passwd的内容到当前目录下的passwd.bak文件中</span></span><br><span class="line">$ ./a.out /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>write不一定写入磁盘，如果把ccp.c中的第二个open和close删除，把fd2改为1 ( 或改为STDOUT_FILENO，需要包含头文件unistd.h )，就可以写到标准输出了。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"quit.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fd1,fd2;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">char</span> buf[BUFSIZE];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>((fd1=open(argv[<span class="number">1</span>],O_RDONLY))==<span class="number">-1</span>)</span><br><span class="line">                quit(<span class="string">"open"</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//      if((fd2=open("passwd.bak",O_WRONLY|O_CREAT|O_TRUNC, 0664))==-1)</span></span><br><span class="line"><span class="comment">//              quit("open2",2);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>( (n=read(fd1,buf,BUFSIZE))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(n!=write(STDOUT_FILENO,buf,n))</span><br><span class="line">                        quit(<span class="string">"write"</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        close(fd1);</span><br><span class="line"><span class="comment">//      close(fd2);</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注：<br>读写标准流时，应当使用符号常量STDIN_FILENO、STDOUT_FILENO、STDERR_FILENO作为文件说明符，而不是他们所表示的整数0、1、2。这些符号常量在unistd.h中定义。  </p>
<hr>
<h2 id="缓冲IO和无缓冲IO"><a href="#缓冲IO和无缓冲IO" class="headerlink" title="缓冲IO和无缓冲IO"></a>缓冲IO和无缓冲IO</h2><p><a href="https://www.cnblogs.com/cavehubiao/p/3981482.html" target="_blank" rel="noopener">带不带缓存是相对层来说的</a>。<br>如果你要写入数据到文件上时（就是写入磁盘上），内核先将数据写入到内核中所设的缓冲储存器。<br>假如这个缓冲储存器的长度是100个字节，你调用系统函：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> write (<span class="keyword">int</span> fd,<span class="keyword">const</span> <span class="keyword">void</span> * buf,<span class="keyword">size_t</span> count);</span><br></pre></td></tr></table></figure></p>
<p>写操作时，设每次写入长度count=10个字节，那么你几要调用10次这个函数才能把这个缓冲区写满，<strong>此时数据还是在缓冲区，并没有写入到磁盘。</strong><br>缓冲区满时才进行实际上的IO操作，把数据写入到磁盘上，所以上面说的“不带缓存””不是没有缓存而是没有直写进磁盘。</p>
<p>那么，既然<strong>不带缓存的操作实际在内核是有缓存器的</strong>，那<strong>带缓存的IO操作</strong>又是怎么回事呢？</p>
<p>带缓存IO也叫标准IO，符合ANSI C 的标准IO处理，不依赖系统内核，所以移植性强，我们使用标准IO操作很多时候是为了减少对read()和write()的系统调用次数，带缓存IO其实就是在用户层再建立一个缓存区，这个缓存区的分配和优化长度等细节都是标准IO库代你处理好了，不用去操心.<br>还是用上面那个例子说明这个操作过程：<br>内核缓存（注意这个不是用户层缓存区）区长度是100字节，<br>我们调用不带缓存的IO函数write()就要调用10次，这样系统效率低，<br>现在我们在用户层建立另一个缓存区（用户层缓存区或者叫流缓存），假设流缓存的长度是50字节，<br>我们用标准C库函数的fwrite()将数据写入到这个流缓存区里面，流缓存区满50字节后在进入内核缓存区，此时再调用系统函数write()将数据写入到文件（实质是磁盘）上，<br>标准IO操作fwrite()最后还是要掉用无缓存IO操作write,这里进行了两次调用fwrite()写100字节也就是进行两次系统调用write()。  </p>
<h1 id="lseek-定位偏移指针"><a href="#lseek-定位偏移指针" class="headerlink" title="lseek: 定位偏移指针"></a>lseek: 定位偏移指针</h1><h1 id="truncate和ftruncate：截短文件"><a href="#truncate和ftruncate：截短文件" class="headerlink" title="truncate和ftruncate：截短文件"></a>truncate和ftruncate：截短文件</h1><h1 id="umask：-在创建期间修改文件权限"><a href="#umask：-在创建期间修改文件权限" class="headerlink" title="umask： 在创建期间修改文件权限"></a>umask： 在创建期间修改文件权限</h1><h1 id="目录导航–getcwd"><a href="#目录导航–getcwd" class="headerlink" title="目录导航–getcwd"></a>目录导航–getcwd</h1><h1 id="读取目录"><a href="#读取目录" class="headerlink" title="读取目录"></a>读取目录</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打开目录</span></span><br><span class="line"><span class="function">DIR *<span class="title">opendir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *dirname)</span></span>;</span><br><span class="line"><span class="comment">//读打开的目录，这个结构体至少有目录的inode和dirName两个成员</span></span><br><span class="line"><span class="function">struct dirent *<span class="title">readdir</span><span class="params">(DIR *dirp)</span></span>;</span><br><span class="line"><span class="comment">//关闭打开的目录</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">closedir</span><span class="params">(DIR *dirp)</span></span></span><br></pre></td></tr></table></figure>
<h1 id="修改目录中的项目"><a href="#修改目录中的项目" class="headerlink" title="修改目录中的项目"></a>修改目录中的项目</h1><ol>
<li>mkdir和rmdir——这些调用的意义与同名命令相同</li>
<li>link和symlink——link创建一个硬链接，symlink创建一个符号链接</li>
<li>unlink——和rm差不多，删除一个普通文件或符号链接，它不会删除目录</li>
<li>rename——和mv一样</li>
</ol>
<h1 id="读取Inode：struct-stat-和-stat"><a href="#读取Inode：struct-stat-和-stat" class="headerlink" title="读取Inode：struct stat 和 stat"></a>读取Inode：struct stat 和 stat</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span>&#123;</span></span><br><span class="line">  <span class="keyword">ino_t</span> st_ino ; <span class="comment">//Inode 编号</span></span><br><span class="line">  <span class="keyword">mode_t</span> st_mode; <span class="comment">//模式(类型和权限)</span></span><br><span class="line">  <span class="keyword">nlink_t</span> st_nlink; <span class="comment">//硬链接数</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">uid_t</span> st_uid; <span class="comment">//UID(所有者)</span></span><br><span class="line">  <span class="keyword">gid_t</span> st_gid; <span class="comment">//GID(用户组所有者)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">dev_t</span> st_rdev; <span class="comment">//设备ID(用于设备文件)</span></span><br><span class="line">  <span class="keyword">off_t</span> st_size; <span class="comment">//文件大小(字节)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">time_t</span> st_atime; <span class="comment">//最后访问时间</span></span><br><span class="line">  <span class="keyword">time_t</span> st_mtime; <span class="comment">//最后修改时间</span></span><br><span class="line">  <span class="keyword">time_t</span> st_ctime; <span class="comment">//inode 最后修改时间</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">blksize_t</span> st_blksize ; <span class="comment">//IO的优选块大小</span></span><br><span class="line">  <span class="keyword">blkcnt_t</span> st_blocks; <span class="comment">//分配的块数</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>stat系统调用：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">stat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, struct stat *buf)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lstat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, struct stat *buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fstat</span><span class="params">(<span class="keyword">int</span> fildes, struct stat *buf)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>stat和lstat的第一参数需要路径名，第二参数是一个stat结构的地址（把第一参数下的文件信息以stat结构存放在第二参数中）。stat和lstat的区别是，对于符号链接，stat会沿着符号链接前进：如果，文件foo是链接到bar的(foo-&gt;bar)，那么对foo进行stat操作，<strong>stat会用bar的属性填充stat结构</strong>, 而 <strong>lstat会提取foo的属性</strong>。其他方面，stat和lstat没有区别。lstat更常用。<br>fstat的第一参数是文件说明符，第二参数同样是stat结构地址。  </p>
<h1 id="access：检查实际用户的权限"><a href="#access：检查实际用户的权限" class="headerlink" title="access：检查实际用户的权限"></a>access：检查实际用户的权限</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">access</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, <span class="keyword">int</span> amode)</span></span>;</span><br></pre></td></tr></table></figure>
<p>第一参数是 <strong>路径名</strong>, 第二参数指定了 <strong>要测试的访问权限</strong> 。<br>amode可以取以下4个值：<br>R_OK ——读取权限正常<br>W_OK ——写权限OK<br>X_OK ——执行权限OK<br>F_OK ——文件存在</p>
<h1 id="修改文件属性"><a href="#修改文件属性" class="headerlink" title="修改文件属性"></a>修改文件属性</h1><h2 id="chmod和fchmod：改变文件权限"><a href="#chmod和fchmod：改变文件权限" class="headerlink" title="chmod和fchmod：改变文件权限"></a>chmod和fchmod：改变文件权限</h2><h2 id="chown：改变所有权"><a href="#chown：改变所有权" class="headerlink" title="chown：改变所有权"></a>chown：改变所有权</h2><h2 id="utime：改变时间戳"><a href="#utime：改变时间戳" class="headerlink" title="utime：改变时间戳"></a>utime：改变时间戳</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png" alt="mitre">
            
              <p class="site-author-name" itemprop="name">mitre</p>
              <p class="site-description motion-element" itemprop="description">Goals determine what you are going to be</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">104</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.yanmin99.com/" title="yanmin" target="_blank">yanmin</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://whark.cn" title="大鹏" target="_blank">大鹏</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.notall.cn/" title="zkp" target="_blank">zkp</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://qiracle.cn/" title="强强" target="_blank">强强</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mitre</span>

  
</div>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">totle: <span id="busuanzi_value_site_pv"></span> times</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">Visitors: <span id="busuanzi_value_site_uv"></span></span>
    <span class="post-meta-divider">|</span>



  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
