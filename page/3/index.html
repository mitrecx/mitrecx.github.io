<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/woAiLuo.jpg?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Goals determine what you are going to be">
<meta property="og:type" content="website">
<meta property="og:title" content="MITRE">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="MITRE">
<meta property="og:description" content="Goals determine what you are going to be">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MITRE">
<meta name="twitter:description" content="Goals determine what you are going to be">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>MITRE</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MITRE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Goals determine what you are going to be</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/Oracle学习1-SQL语言基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/Oracle学习1-SQL语言基础/" itemprop="url">Oracle-学习1-SQL语言基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-06T11:18:15+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先建两张表：部门表，员工表。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> DEPARTMENT</span><br><span class="line">(</span><br><span class="line">  department_no   VARCHAR2(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  department_name VARCHAR2(<span class="number">100</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 添加主键约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> department</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> pk_dept_no primary <span class="keyword">key</span>(department_no);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> department</span><br><span class="line"><span class="keyword">is</span> <span class="string">'部门表'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> department.department_no</span><br><span class="line"><span class="keyword">is</span> <span class="string">'部门编号'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> department.department_name</span><br><span class="line"><span class="keyword">is</span> <span class="string">'部门名称'</span>;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> EMP</span><br><span class="line">(</span><br><span class="line">  emp_id        VARCHAR2(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  emp_name      VARCHAR2(<span class="number">100</span>),</span><br><span class="line">  hire_date     VARCHAR2(<span class="number">10</span>),</span><br><span class="line">  department_no VARCHAR2(<span class="number">10</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改字段 emp_id名称为 emp_no</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp</span><br><span class="line"><span class="keyword">rename</span> <span class="keyword">column</span> emp_id <span class="keyword">to</span> emp_no;</span><br><span class="line"></span><br><span class="line"><span class="comment">--添加 外键约束（普通外键约束）</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> EMP</span><br><span class="line">  <span class="keyword">add</span> <span class="keyword">constraint</span> FK_DEPT_NO foreign <span class="keyword">key</span> (department_no)</span><br><span class="line">  <span class="keyword">references</span> department (department_no);</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除约束条件</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">constraint</span> fk_dept_no;</span><br><span class="line"></span><br><span class="line"><span class="comment">--重新添加 外键约束（级联外键约束）</span></span><br><span class="line">  <span class="keyword">alter</span> <span class="keyword">table</span> EMP</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">constraint</span> FK_DEPT_NO foreign <span class="keyword">key</span> (department_no)</span><br><span class="line">    <span class="keyword">references</span> department (department_no) <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> emp</span><br><span class="line"><span class="keyword">is</span> <span class="string">'员工表'</span>;</span><br></pre></td></tr></table></figure>
<p>两种形式的外键约束：<br>1、普通外键约束（如果存在A表引用B表主键，则无法删除B表中被引用记录）<br>2、级联外键约束（可以删除B表中被引用的记录，但是同时会把对应的A表中的记录也删除）</p>
<p>创建结果：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ut.table_name <span class="string">"表名"</span>, utc.comments, uo.created <span class="string">"表创建时间"</span>, uo.last_ddl_time <span class="string">"表修改时间"</span></span><br><span class="line"><span class="keyword">from</span> user_tables ut <span class="keyword">left</span> <span class="keyword">join</span> user_tab_comments utc <span class="keyword">on</span>(utc.TABLE_NAME=ut.table_name)</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> user_objects uo <span class="keyword">on</span>(ut.table_name=uo.object_name)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> uo.last_ddl_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-22_151125.png" alt>  </p>
<h1 id="1-where-子句"><a href="#1-where-子句" class="headerlink" title="1 where 子句"></a>1 where 子句</h1><p>在 Oracle ， <strong><font color="red">where子句中 不能用 “=NULL”</font></strong> ，只能用 “is NULL” 或 “is NOT NULL”。<br>但是，更新表时，<strong>set子句 可以用 “=null”</strong>，例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp</span><br><span class="line"><span class="keyword">set</span> salary=<span class="literal">null</span></span><br><span class="line"><span class="keyword">where</span> salary = <span class="number">0.00</span>;</span><br></pre></td></tr></table></figure></p>
<p>空值函数 NAV 和 NVL2 ：<br>nvl(str, replace_with) , 若 str 为空，则取 replace_with 的值。否则不变。<br>nvl2(str, str2, replace_with),  若 str 为空，则取 replace_with 的值。否则取 str2 的值。  </p>
<p>为了方便测试，给 <strong>emp表</strong> 添加一个 salary 字段：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp</span><br><span class="line">  <span class="keyword">add</span> salary <span class="built_in">number</span>(<span class="number">10</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-22_154406.png" alt>  </p>
<p>测试：若工资为空，则置为0，否则置为 10000。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> nvl2(salary,<span class="number">10000</span>,<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10000</span><br><span class="line">10000</span><br><span class="line">10000</span><br><span class="line">0</span><br></pre></td></tr></table></figure></p>
<p>where 子句中的 <strong>比较运算符</strong> ：<br><code> &gt; 大于， &gt;= 大于等于 </code><br><code> &lt; 小于， &lt;= 小于等于 </code><br><code> = 等于， &lt;&gt; 不等于 </code>  </p>
<p>查看在 2018年1月1日 之前 入职的员工：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> <span class="keyword">to_date</span>(hire_date,<span class="string">'yyyy-mm-dd'</span>) &lt; <span class="keyword">to_date</span>(<span class="string">'2018-1-1'</span>,<span class="string">'yyyy-mm-dd'</span>);</span><br></pre></td></tr></table></figure></p>
<p>where 子句中的 <strong>逻辑运算符</strong> ：<br><code> not </code>，如果原条件为真，则得到假。如果原条件为假，结果为真。<br><code> and </code>，如果左右两个条件都为真，则得到的值就为真。<br><code> or </code>，  只要左右两个条件有一个为真，则得到的值就为真。  </p>
<p><strong>注意：<font color="red"> and 的优先级高于 or。</font></strong>  </p>
<p>Oracle 运算符的优先级(由高到低)：  </p>
<ol>
<li>算术运算符(即‘+’,‘-’，‘*’,‘/’)</li>
<li>连接运算符（即‘||’）</li>
<li>比较运算符（即‘&gt;’，‘&gt;=’，‘&lt;’，‘&lt;=’，‘&lt;&gt;’）</li>
<li>Is [not] null,[not] like,[not] in</li>
<li>[not] between-and</li>
<li>逻辑运算符: not</li>
<li>逻辑运算符: and</li>
<li>逻辑运算符: or</li>
</ol>
<p>where 子句中的 <strong>模糊查询</strong> ：<br><code> like </code> ， like 匹配有 两个通配符：<br>一个是 “<strong>-</strong>“ 用于 “标识单个字符，只能是一个字符”。<br>一个是 “<strong>%</strong>“ 用于 “标识 0 到多个字符”。    </p>
<p>例：<br>查找员工名字含有 字符e 的员工<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> emp_name <span class="keyword">like</span> <span class="string">'%e%'</span>;</span><br></pre></td></tr></table></figure></p>
<p>查找 01 和 02 号部门中的所有员工<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> emp.department_no <span class="keyword">in</span> (<span class="string">'01'</span>,<span class="string">'02'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--等价于</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> emp.department_no = <span class="string">'01'</span> <span class="keyword">or</span> emp.department_no=<span class="string">'02'</span>;</span><br></pre></td></tr></table></figure></p>
<p><code> &gt;any </code> 演示：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--工资 大于8000 的员</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> salary &gt;all (<span class="number">4000</span>,<span class="number">5000</span>,<span class="number">8000</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong> ALL  和  ANY </strong> :<br><code> &gt;ALL </code>，大于最大<br><code> &lt;ALL </code>，小于最小<br><code> &gt;ANY </code>，大于最小<br><code> &lt;ANY </code>，小于最大  </p>
<h1 id="2-排序"><a href="#2-排序" class="headerlink" title="2 排序"></a>2 排序</h1><p>查表 emp，按照 工资降序 排列：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> salary <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-22_195633.png" alt>  </p>
<p>查表 emp，按照 工资降序 同时 入职日期从早到晚(从小到大) 排列：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">where</span> salary <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>, hire_date;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-22_195810.png" alt>  </p>
<p>注意：  </p>
<ol>
<li><p><strong>order by</strong> 必须出现在 select 中的最后一句。  </p>
</li>
<li><p><strong>order by</strong> 的排序条件是多列时，左边的排序优先级 <strong>高于</strong> 右边。   </p>
</li>
</ol>
<h1 id="3-聚合函数-分组函数"><a href="#3-聚合函数-分组函数" class="headerlink" title="3 聚合函数(分组函数)"></a>3 聚合函数(分组函数)</h1><p>聚合函数也叫分组函数。  </p>
<h2 id="3-1-聚合函数-分组函数"><a href="#3-1-聚合函数-分组函数" class="headerlink" title="3.1 聚合函数(分组函数)"></a>3.1 聚合函数(分组函数)</h2><p>聚合函数(分组函数)的特点：<br>1、 <strong>多行数据参与运算返回一行结果</strong>。<br>2、 <strong>主要用于统计</strong>。  </p>
<p>五个聚合函数：<br>1、 最值， <strong>MAX</strong> 和 <strong>MIN</strong>。可以统计任何数据类型， 包括数字，字符，日期。<br>2、 平均值， <strong>AVG</strong>。聚合函数会忽略空值，注意！<br>3、 求和，<strong>SUM</strong>  。<br>4、 统计记录条数，<strong>count</strong>。一般用 count(1) 或 count(*)。  </p>
<p>示例：<br>查询员工最晚(最大)入职日期<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(hire_date)</span><br><span class="line">  <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">--结果：'2018-7-3'</span></span><br></pre></td></tr></table></figure></p>
<p>查询员工平均工资<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(nvl(salary,<span class="number">0</span>))</span><br><span class="line">  <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">--结果：'11040'</span></span><br></pre></td></tr></table></figure></p>
<p>查询员工个数<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">--结果：'10'</span></span><br></pre></td></tr></table></figure></p>
<p>注意：聚合函数不能直接写在 where子句中。  </p>
<h2 id="3-2-分组"><a href="#3-2-分组" class="headerlink" title="3.2 分组"></a>3.2 分组</h2><p>查看每个部门的薪水总和：按部门 <strong>分组</strong>，在对组内数据使用 <strong>聚合函数(分组函数)</strong> ，计算之后每组返回一条数据。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> department_no,<span class="keyword">sum</span>(salary) sum_salary</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> department_no</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> sum_salary <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<p>注意：  </p>
<ol>
<li>若 <code>group by</code> 中出现多列，那么会按照这几列的 <strong>组合值相同的数据</strong> 看做一组。  </li>
<li>分组分出的小组有多少，结果集就有多少条。  </li>
<li>只有在 <code>group by</code> 子句中出现的字段，才能 <strong>直接</strong> 写在 <code>select</code> 子句中。  </li>
</ol>
<p><strong>分组</strong> 常常和 <strong>分组函数</strong> 一起使用：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--根据部门分组，计算每个部门的最高/低工资，平均工资，工资总和</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(salary),<span class="keyword">min</span>(salary),<span class="keyword">avg</span>(salary),<span class="keyword">sum</span>(salary)</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> department_no;</span><br></pre></td></tr></table></figure></p>
<p><code>having</code> 为 <code>group by</code> 添加过滤条件：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> department_no, <span class="keyword">count</span>(*)</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> department_no;</span><br><span class="line"><span class="comment">--结果：</span></span><br><span class="line"><span class="comment">--	01	4</span></span><br><span class="line"><span class="comment">--	02	6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> department_no, <span class="keyword">count</span>(*)</span><br><span class="line">  <span class="keyword">from</span> emp</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> department_no</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">4</span>;</span><br><span class="line"><span class="comment">--结果：</span></span><br><span class="line"><span class="comment">--	02	6</span></span><br></pre></td></tr></table></figure></p>
<h1 id="4-提高查询效率"><a href="#4-提高查询效率" class="headerlink" title="4 提高查询效率"></a>4 提高查询效率</h1><p>查询语句的执行顺序：  </p>
<ol>
<li><p>from 子句。从右往左。  </p>
</li>
<li><p>where 子句。从右往左。<strong>将能过滤掉最大数量记录的条件写在 where 子句的最右边</strong>。   </p>
</li>
<li><p>group by。从左往右。<strong>最好在 group by 之前使用 where 将不需要的记录在 group by 之前过滤掉</strong>。    </p>
</li>
<li><p>having。<strong>消耗资源，尽量避免使用</strong>。  </p>
</li>
<li><p>select。 <strong>尽量不要使用 星号(*)</strong>。  </p>
</li>
<li><p>order by。从左往右排序。  </p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/Oracle问题引发的思考/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/Oracle问题引发的思考/" itemprop="url">Oracle问题引发的思考</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-05T15:33:18+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>问题描述：<br>如下图，有两张表 emp 和 emp_history，现在想把 emp 中的数据拷贝到 emp_history 中，<br>同时添加一个日期字段。两张表的主键都是id，所以只拷贝id不同的。  </p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-22_154613.png" alt>  <img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-22_154736.png" alt>  </p>
<p>只拷贝，不考虑主键的话：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp_history</span><br><span class="line"><span class="keyword">select</span> e.*,to_char(<span class="keyword">sysdate</span>,<span class="string">'yyyy-mm-dd'</span>) <span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure></p>
<p><strong>如何判断 emp 中的数据在 emp_history 中是否存在？</strong>(id相同的数据)<br>我首先想到的是 when then , 然后想用一个存储过程实现，如果存在就不插入，不存在就插入。<br>但是当我无法实现的时候，我才想到了 <strong>exists</strong> 。<br>事实上，用 <strong>exists</strong> 可以很容易实现查找出重复 id 的数据：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.*,to_char(<span class="keyword">sysdate</span>,<span class="string">'yyyy-mm-dd'</span>)</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span> ( <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> emp_history eh</span><br><span class="line">                    <span class="keyword">where</span> eh.id=e.id);</span><br></pre></td></tr></table></figure></p>
<p>问题解决：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp_history</span><br><span class="line"><span class="keyword">select</span> e.*,to_char(<span class="keyword">sysdate</span>,<span class="string">'yyyy-mm-dd'</span>)</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span> ( <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> emp_history eh</span><br><span class="line">                     <span class="keyword">where</span> eh.id=e.id );</span><br></pre></td></tr></table></figure></p>
<p>思考：<br>Oracle 你真的熟稔于心了哇？  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/02/java正则表达式-预查/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/02/java正则表达式-预查/" itemprop="url">java正则表达式-预查</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-02T14:45:44+08:00">
                2018-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>应用场景：<br>解析报文(xml文件)，去除字段的空白字符(空白字段，字段首尾空白)。</p>
<p>思想：<br>利用正则表达式的 <strong>预查</strong> 定位到各个字段，并匹配到字段的空白字符，替换之。  </p>
<p>实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  StringBuilder builder=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">  builder.append(<span class="string">"&lt;name type='string'&gt;cx  &lt;/name&gt;\n"</span>);</span><br><span class="line">  builder.append(<span class="string">"&lt;age&gt;     &lt;/age&gt;\n"</span>);</span><br><span class="line">  builder.append(<span class="string">"&lt;hight&gt; 1.72 &lt;/hight&gt;\n"</span>);</span><br><span class="line">  builder.append(<span class="string">"&lt;weight&gt;   56&lt;/weight&gt;\n"</span>);</span><br><span class="line">  builder.append(<span class="string">"&lt;sex&gt; m a n &lt;/sex&gt;"</span>);</span><br><span class="line">  System.out.println(builder.toString());</span><br><span class="line">  System.out.println(<span class="string">"=====去除空串字段的空白字符======"</span>);</span><br><span class="line">  String s=builder.toString().replaceAll(<span class="string">"(?&lt;=&gt;)\\s+(?=&lt;)"</span>, <span class="string">""</span>);</span><br><span class="line">  System.out.println(s);</span><br><span class="line">  System.out.println(<span class="string">"=====去除所有字段的 首尾空白字符======"</span>);</span><br><span class="line">  <span class="comment">//除去空白字段，和首标签后的空白字符</span></span><br><span class="line">  String s1=builder.toString().replaceAll(<span class="string">"(?&lt;=&gt;)\\s+(?=(\\w|&lt;))"</span>, <span class="string">""</span>);</span><br><span class="line">  System.out.println(s1);</span><br><span class="line">  <span class="comment">//除去尾标签前的空白字符</span></span><br><span class="line">  s1=s1.replaceAll(<span class="string">"(?&lt;=\\w)\\s+(?=&lt;)"</span>, <span class="string">""</span>);</span><br><span class="line">  System.out.println(s1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-02_144254.png" alt>  </p>
<p>分析：<br>正向预查 <strong>strRE(<span style="background:#ffb3d9;">?=</span>regex)</strong>，查出前面的strRE，regex只做参考不做匹配。<br>反向预查 <strong>(<span style="background:#ffb3d9;">?&lt;=</span>regex)strRE</strong>，查出后面的strRE，regex只做参考不做匹配。  </p>
<h1 id="1-正向预查"><a href="#1-正向预查" class="headerlink" title="1. 正向预查"></a>1. 正向预查</h1><p>利用正则表达式正向预查匹配出 <strong>后面带数字Windows</strong>，如下：<br><strong><font color="red">Windows</font></strong> 1.03 and <strong><font color="red">Windows</font></strong> 2.0 fisrt Released in 1985 and 1987 respectively.<br><strong><font color="red">Windows</font></strong> 95 and <strong><font color="red">Windows</font></strong> 98 are the successor.<br>Then <strong><font color="red">Windows</font></strong> 2000 and <strong>Windows</strong> Xp appeared.<br><strong>Windows</strong> Vista is the Latest version of the family.  </p>
<p>正则表达式：<br><strong>Windows (<span style="background:#ffb3d9;">?=</span>[\d.]+\b)</strong><br>\d 表示匹配一个数字  </p>
<p>结果：<br>后面带有数字的 Windows 被匹配出来(只匹配Windows，不含数字)，不带数字Windows的不匹配。   </p>
<p>可以这样理解匹配过程：  </p>
<ol>
<li>先进行普通匹配：Windows ([\d.]+\b)</li>
<li>然后从匹配结果中将 <strong>子模式</strong> 内的文本<code>([\d.]+\b)</code>排除掉  </li>
</ol>
<h1 id="2-反向预查"><a href="#2-反向预查" class="headerlink" title="2. 反向预查"></a>2. 反向预查</h1><p>匹配出 “CNY:” 后面的金额：<br>CNY: <strong><font color="red">128.04</font></strong><br>USD: 22.5<br>USD: 23.5<br>HKD: 1533.5<br>CNY: <strong><font color="red">23.78</font></strong>    </p>
<p>正则表达式：<br><strong>(<span style="background:#ffb3d9;">?&lt;= </span>CNY: )\d+.\d+</strong>   </p>
<p>可以这样理解上面的匹配过程：</p>
<ol>
<li>先进行普通匹配：(CNY: )\d+.\d+</li>
<li>然后从匹配文本中将 <strong>子模式</strong> 内的文本<code>(CNY: )</code>排除掉。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/02/java运算符instanceof/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/02/java运算符instanceof/" itemprop="url">java运算符instanceof</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-02T10:16:24+08:00">
                2018-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关键字 <strong>instanceof</strong> 用于 判断一个对象是否是 <strong><font color="red">某一指定类型</font></strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (objectReference <span class="keyword">instanceof</span> type)</span><br></pre></td></tr></table></figure></p>
<p>例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] a)</span> </span>&#123;</span><br><span class="line">  String s = <span class="string">"Hello"</span>;</span><br><span class="line">  <span class="keyword">if</span> (s <span class="keyword">instanceof</span> java.lang.String) &#123;</span><br><span class="line">    System.out.println(<span class="string">"is a String"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is a String</span><br></pre></td></tr></table></figure></p>
<p>下面看一个常用的 <strong>instanceof</strong> 示例：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">//属性略</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printInterest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(interest);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">//属性略</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(score);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="comment">//属性略</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTeache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(teache);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Person person=<span class="keyword">new</span> Student(<span class="string">"cx"</span>,<span class="number">24</span>,<span class="keyword">new</span> BigDecimal(<span class="string">"172"</span>),<span class="string">"show"</span>,<span class="string">"12345"</span>,<span class="number">100</span>);</span><br><span class="line">		<span class="comment">//Person person=new Teacher("lyy",34,new BigDecimal("165"),"teache","00001","math");</span></span><br><span class="line">		<span class="keyword">if</span>(person <span class="keyword">instanceof</span> Student) &#123;</span><br><span class="line">			System.out.print(<span class="string">"分数："</span>);</span><br><span class="line">			((Student) person).printScore();</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"the person is not a student "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(person <span class="keyword">instanceof</span> Teacher) &#123;</span><br><span class="line">			System.out.println(<span class="string">"教学："</span>);</span><br><span class="line">			((Teacher) person).printTeache();</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"this person is not a teacher"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">分数：100</span><br><span class="line">this person is not a teacher</span><br></pre></td></tr></table></figure>
<p>分析：<br>在此例中，我们知道，<strong><font color="#00cc00">person</font></strong> 只能调用 <strong><font color="#8f00b3">Person</font></strong> 类的方法，不能调用 <strong><font color="cc7a00">Student</font></strong> 类的方法。    </p>
<p><strong><font color="#00cc00">person</font></strong> 要调用其子类 <strong><font color="cc7a00">Student</font></strong> 的方法的话，必须强转为 <strong><font color="cc7a00">Student</font></strong> 类型。  </p>
<p>如果 <strong><font color="#00cc00">person</font></strong> 是 <strong><font color="cc7a00">Student</font></strong> 实例化来的，那么强转为 <strong><font color="cc7a00">Student</font></strong> 没问题。<br>如果 <strong><font color="#00cc00">person</font></strong> 是 <strong><font color="#cc0066">Teacher</font></strong> 实例化来的，那么强转为 <strong><font color="cc7a00">Student</font></strong> 会报错。  </p>
<p>所以，<strong>父类对象/引用 强转为 子类类型 时，应当用instanceof 判断是否可以强制转换</strong>。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/01/java时间处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/01/java时间处理/" itemprop="url">java时间处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-01T09:04:29+08:00">
                2018-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>过去世界各地原本各自订定当地时间，但随着交通和电讯的发达，各地交流日益频繁，不同的地方时间，造成许多困扰。<br>于是，在1884年的国际会议上制定了全球性的标准时，明定以英国伦敦 <strong>格林威治</strong> 这个地方为 <strong>零度经线</strong> 的起点，并以地球由西向东每24小时自转一周360°，订定每隔经度15°，时差1小时。  </p>
<p>三个时间标准：<br>1、 <strong>格林威治标准时间</strong> GMT (Greenwich Mean Time):<br>全球都以格林威治的时间作为标准来设定时间。<br>2、 世界协调时间UTC (Coordinated Universal Time):<br>UTC的本质强调的是比GMT更为精确的世界时间标准。<br>3、 CST时间:<br>CST却同时可以代表如下 4 个不同的时区:  </p>
<ol>
<li>Central Standard Time (USA) UT-6:00  </li>
<li>Central Standard Time (Australia) UT+9:30  </li>
<li><strong>China Standard Time UT+8:00</strong> 北京时间  </li>
<li>Cuba Standard Time UT-4:00 古巴</li>
</ol>
<p>注：<br>时间比较一般说更早，更晚。<br>以1970 年 1 月 1 日 00:00:00 GMT 到目前的毫秒数作为参考的话，<br>可以说 <strong>早</strong> 一点的时间 <strong>小</strong>，<strong>晚</strong> 一点的时间 <strong>大</strong>。<br>比如，2018&gt;1995  </p>
<h1 id="1-java-util-Date-类"><a href="#1-java-util-Date-类" class="headerlink" title="1 java.util.Date 类"></a>1 java.util.Date 类</h1><p>说到 java 时间，大家都知道 <strong>Date</strong> 类型。<br>Date 有许多方法都已经不建议使用了(<strong>deprecated</strong>)，但是 Date 依然是一个最基本的时间类。  </p>
<h2 id="1-1-Date-常用的方法"><a href="#1-1-Date-常用的方法" class="headerlink" title="1.1 Date 常用的方法"></a>1.1 Date 常用的方法</h2><p>Date 常用的方法有以下三个：  </p>
<p>1、获取当前系统时间<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Date date=<span class="keyword">new</span> Date();</span><br><span class="line">System.out.println(date);</span><br><span class="line"><span class="comment">// 结果： Thu Nov 01 10:58:58 CST 2018</span></span><br></pre></td></tr></table></figure></p>
<p>2、 获取时间date 与 1970 年 1 月 1 日 00:00:00 GMT 差的毫秒值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//long getTime()</span></span><br><span class="line"><span class="keyword">long</span> timeMs=date.getTime();</span><br></pre></td></tr></table></figure></p>
<p>直接获取当前系统时间 与 1970 年 1 月 1 日 00:00:00 GMT 差的毫秒值：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> begin1=System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"><span class="comment">//等价写法，begin1 == begin2</span></span><br><span class="line">Date date=<span class="keyword">new</span> Date();</span><br><span class="line"><span class="keyword">long</span> begin2=date.getTime();</span><br></pre></td></tr></table></figure></p>
<p>3、 两个时间比较大小<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//int compareTo(Date anotherDate)</span></span><br><span class="line">date1.compareTo(date2)</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><strong>date1</strong> 比 date2 <strong>小</strong>(早)，则返回 <strong>-1</strong><br>date1 比 date2 大(晚)，则返回 1<br>相等，返回0    </p>
<h2 id="1-2-Date-和-String-相互转换"><a href="#1-2-Date-和-String-相互转换" class="headerlink" title="1.2 Date 和 String 相互转换"></a>1.2 Date 和 String 相互转换</h2><p><strong>java.text.SimpleDateFormat</strong> 格式化时间<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SimpleDateFormat(String pattern)</span></span><br><span class="line">SimpleDateFormat format=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br></pre></td></tr></table></figure></p>
<p>SimpleDateFormat 时间格式(pattern)的含义 :<br>yyyy 四位年。<br>MM 月。<br>dd 天。<br><strong>HH</strong> 24小时制时，hh是12小时制时。<br>mm 分。<br>ss 秒。<br><del>SSS 毫秒</del>    </p>
<h3 id="1-2-1-format-将Date转为String"><a href="#1-2-1-format-将Date转为String" class="headerlink" title="1.2.1 format 将Date转为String"></a>1.2.1 format 将Date转为String</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Date date = <span class="keyword">new</span> Date();</span><br><span class="line">System.out.println(<span class="string">"date: "</span>+date);</span><br><span class="line"><span class="comment">//时间格式</span></span><br><span class="line">SimpleDateFormat format=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">String sdate=format.format(date);</span><br><span class="line">System.out.println(sdate);</span><br></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date: Thu Nov 01 14:52:47 CST 2018</span><br><span class="line">2018-11-01 14:52:47</span><br></pre></td></tr></table></figure></p>
<h3 id="1-2-2-parse-将String转为Date"><a href="#1-2-2-parse-将String转为Date" class="headerlink" title="1.2.2 parse 将String转为Date"></a>1.2.2 parse 将String转为Date</h3><p>在上一小节中，format 把 Date 转为 String 没有问题。  </p>
<p><strong><font color="red">parse 把 String 转为 Date 时</font></strong>，如果 String 不符合 <strong>SimpleDateFormat</strong> 的格式，将会抛出 <strong><font color="red">ParseException</font></strong> 异常。所以字符串转Date需要try-catch。    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String s=<span class="string">"2018-11-11 9:9:9:123"</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Date date2=format.parse(s);</span><br><span class="line">  System.out.println(<span class="string">"date2: "</span>+date2);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date2: Sun Nov 11 09:09:09 CST 2018</span><br></pre></td></tr></table></figure></p>
<h1 id="2-时间的计算"><a href="#2-时间的计算" class="headerlink" title="2 时间的计算"></a>2 时间的计算</h1><p>抽象类(abstract class) <strong><font color="#9900cc">Calendar</font></strong> 提供了丰富的计算时间的方法。  </p>
<h2 id="2-1-初识Calendar"><a href="#2-1-初识Calendar" class="headerlink" title="2.1 初识Calendar"></a>2.1 初识Calendar</h2><p>一个例子，通过 GregorianCalendar 对象的 getTime 方法获取当前系统时间：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SimpleDateFormat format=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//GregorianCalendar 继承自 Calendar，实现了所有抽象方法</span></span><br><span class="line">Calendar calendar=<span class="keyword">new</span> GregorianCalendar();</span><br><span class="line"><span class="comment">//Calendar calendar=Calendar.getInstance();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取Date. (Calendar的getTime返回 Date类型， Date的getTime返回 long类型)</span></span><br><span class="line">Date date=calendar.getTime();</span><br><span class="line">System.out.println(format.format(date));</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01 15:23:48</span><br></pre></td></tr></table></figure></p>
<h2 id="2-2-Calendar-计算时间"><a href="#2-2-Calendar-计算时间" class="headerlink" title="2.2 Calendar 计算时间"></a>2.2 Calendar 计算时间</h2><h3 id="2-2-1-天数加减计算："><a href="#2-2-1-天数加减计算：" class="headerlink" title="2.2.1 天数加减计算："></a>2.2.1 天数加减计算：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> field, <span class="keyword">int</span> amount)</span></span></span><br></pre></td></tr></table></figure>
<p><strong><font color="#e68a00">field</font></strong> 是日期字段类型， <strong><font color="#e68a00">amount</font></strong> 表示时间的偏移总量。  </p>
<p><strong><font color="#e68a00">field</font></strong> 可用的名称如下，进行时间的运算离不开这些 field ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] FIELD_NAME = &#123;</span><br><span class="line">    <span class="string">"ERA"</span>,</span><br><span class="line">    <span class="string">"YEAR"</span>, <span class="comment">// &lt;------年</span></span><br><span class="line">    <span class="string">"MONTH"</span>, <span class="comment">// &lt;----月</span></span><br><span class="line">    <span class="string">"WEEK_OF_YEAR"</span>,</span><br><span class="line">    <span class="string">"WEEK_OF_MONTH"</span>,</span><br><span class="line">    <span class="string">"DAY_OF_MONTH"</span>, <span class="comment">// &lt;-- 月中日( (几月)几号 )  </span></span><br><span class="line">    <span class="string">"DAY_OF_YEAR"</span>, <span class="comment">// &lt;-- 年中日</span></span><br><span class="line">    <span class="string">"DAY_OF_WEEK"</span>, <span class="comment">// &lt;-- 周中日( 周几 )</span></span><br><span class="line">    <span class="string">"DAY_OF_WEEK_IN_MONTH"</span>,</span><br><span class="line">    <span class="string">"AM_PM"</span>,</span><br><span class="line">    <span class="string">"HOUR"</span>,</span><br><span class="line">    <span class="string">"HOUR_OF_DAY"</span>,</span><br><span class="line">    <span class="string">"MINUTE"</span>,</span><br><span class="line">    <span class="string">"SECOND"</span>,</span><br><span class="line">    <span class="string">"MILLISECOND"</span>,</span><br><span class="line">    <span class="string">"ZONE_OFFSET"</span>,</span><br><span class="line">    <span class="string">"DST_OFFSET"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><strong>DAY_OF_YEAR</strong>，DAY_OF_MONTH，DAY_OF_WEEK 在下面的例子中效果是相同的。<br>原因它们在于 <strong><font color="green">add方法</font></strong> 的内部实现是一样的 ( 为了便于理解，建议使用 <strong>DAY_OF_YEAR</strong> )。<br>但是这3个 <strong><font color="#e68a00">field</font></strong> 用在别的方法中时，含义就不同了，如 get、set方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">  Calendar calendar = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 34天前，calendar对象的时间被修改为 34天前</span></span><br><span class="line">  calendar.add(Calendar.DAY_OF_YEAR, -<span class="number">34</span>);</span><br><span class="line">  System.out.println(format.format(calendar.getTime()));</span><br><span class="line">  <span class="comment">// 34天后，calendar对象的时间 又回到原值</span></span><br><span class="line">  calendar.add(Calendar.DAY_OF_MONTH, <span class="number">34</span>);</span><br><span class="line">  System.out.println(format.format(calendar.getTime()));</span><br><span class="line">  <span class="comment">// 64天后，calendar对象的时间被修改为 64天后</span></span><br><span class="line">  calendar.add(Calendar.DAY_OF_WEEK, <span class="number">64</span>);</span><br><span class="line">  System.out.println(format.format(calendar.getTime()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果如下，当前时间是 2018-11-01 16:00:42 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-28 16:00:42</span><br><span class="line">2018-11-01 16:00:42</span><br><span class="line">2019-01-04 16:00:42</span><br></pre></td></tr></table></figure></p>
<h3 id="2-2-2-年月加减计算"><a href="#2-2-2-年月加减计算" class="headerlink" title="2.2.2 年月加减计算"></a>2.2.2 年月加减计算</h3><p>还是 add 函数，只是 field_name 改了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  SimpleDateFormat format=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">  Calendar cal=<span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">  System.out.println(<span class="string">"当前时间："</span>+format.format(cal.getTime()));</span><br><span class="line"></span><br><span class="line">  cal.add(Calendar.MONTH, <span class="number">3</span>);</span><br><span class="line">  System.out.println(<span class="string">"3个月后："</span>+format.format(cal.getTime()));</span><br><span class="line">  cal.add(Calendar.MONTH, -<span class="number">12</span>);</span><br><span class="line">  System.out.println(<span class="string">"12个月前："</span>+format.format(cal.getTime()));</span><br><span class="line">  cal.add(Calendar.YEAR, -<span class="number">10</span>);</span><br><span class="line">  System.out.println(<span class="string">"10年前："</span>+format.format(cal.getTime()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">当前时间：2018-11-01 16:44:36</span><br><span class="line">3个月后：2019-02-01 16:44:36</span><br><span class="line">12个月前：2018-02-01 16:44:36</span><br><span class="line">10年前：2008-02-01 16:44:36</span><br></pre></td></tr></table></figure></p>
<h3 id="2-2-3-其他操作"><a href="#2-2-3-其他操作" class="headerlink" title="2.2.3 其他操作"></a>2.2.3 其他操作</h3><p>1、 Calendar 的 <strong>get</strong> 和 <strong>set</strong> 方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取日期的每部分</span></span><br><span class="line"><span class="keyword">int</span> year =calendar.get(Calendar.YEAR);   </span><br><span class="line"><span class="keyword">int</span> month=calendar.get(Calendar.MONTH)+<span class="number">1</span>;  <span class="comment">//月份从0开始</span></span><br><span class="line"><span class="keyword">int</span> day =calendar.get(Calendar.DAY_OF_MONTH);   </span><br><span class="line"><span class="keyword">int</span> hour =calendar.get(Calendar.HOUR_OF_DAY);   </span><br><span class="line"><span class="keyword">int</span> minute =calendar.get(Calendar.MINUTE);   </span><br><span class="line"><span class="keyword">int</span> second =calendar.get(Calendar.SECOND);  </span><br><span class="line"><span class="comment">//日期在年的第几周</span></span><br><span class="line"><span class="keyword">int</span> weekOfYear = calendar.get(Calendar.WEEK_OF_YEAR);</span><br><span class="line"><span class="comment">//周几，1-周日，2-周一，3-周二... 7-周六</span></span><br><span class="line"><span class="keyword">int</span> dayOfWeek=calendar.get(Calendar.DAY_OF_WEEK);</span><br></pre></td></tr></table></figure></p>
<p>上面列举了get方法。 <strong>set</strong> 用于设置时间，不再举例。   </p>
<p>2、获取月的总天数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> day=calendar.getActualMaximum(Calendar.DAY_OF_MONTH);</span><br></pre></td></tr></table></figure></p>
<p>3、<strong>两个日期之间相隔的天数</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// date1 和 date2 为 Date类型</span></span><br><span class="line"><span class="keyword">long</span> day=(date1.getTime()-date2.getTime())/(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p>
<p>4、9月份第一个星期一是几号<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  SimpleDateFormat format=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">  Calendar calendar=<span class="keyword">new</span> GregorianCalendar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置时间为9月1号</span></span><br><span class="line">  calendar.set(Calendar.MONTH, Calendar.SEPTEMBER); <span class="comment">//8</span></span><br><span class="line">  <span class="keyword">int</span> day=<span class="number">1</span>;</span><br><span class="line">  calendar.set(Calendar.DAY_OF_MONTH, day);</span><br><span class="line">  System.out.println(format.format(calendar.getTime()));</span><br><span class="line">  <span class="comment">//遍历直到第一个星期一</span></span><br><span class="line">  <span class="keyword">while</span>(calendar.get(Calendar.DAY_OF_WEEK)!=Calendar.MONDAY) &#123;</span><br><span class="line">    calendar.set(Calendar.DAY_OF_MONTH, ++day);</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(format.format(calendar.getTime()));</span><br><span class="line">  System.out.println(calendar.getTime());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-01</span><br><span class="line">2018-09-03</span><br><span class="line">Mon Sep 03 18:52:07 CST 2018</span><br></pre></td></tr></table></figure></p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-01_184844.png" alt>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/31/java运算java-math-BigDecimal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/31/java运算java-math-BigDecimal/" itemprop="url">java运算java.math.BigDecimal</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-31T10:38:51+08:00">
                2018-10-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>空值可以强转为 BigDecimal 类型</strong> ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object a=<span class="keyword">null</span>;</span><br><span class="line">BigDecimal b=(BigDecimal)a;</span><br><span class="line"><span class="comment">//b=null</span></span><br></pre></td></tr></table></figure></p>
<p><strong><font color="red">调用b时，注意非空判断。</font></strong>   </p>
<hr>
<p>BigDecimal常用的构造方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal(<span class="keyword">double</span> val)  </span><br><span class="line">BigDecimal(<span class="keyword">int</span> val)</span><br><span class="line">BigDecimal(<span class="keyword">long</span> val)</span><br><span class="line">BigDecimal(<span class="keyword">char</span>[] in)</span><br><span class="line">BigDecimal(String val)  <span class="comment">// 建议使用</span></span><br></pre></td></tr></table></figure></p>
<p>参考<a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">java API</a> .<br><strong>参数类型为double的构造方法的结果有一定的不可预知性。</strong><br><strong>new BigDecimal(0.01)</strong> 结果是：0.010000000000000000208…<br>而 <strong>new BigDecimal(“0.01”)</strong> 就是 0.01  。   </p>
<h1 id="1-加减乘除"><a href="#1-加减乘除" class="headerlink" title="1. 加减乘除"></a>1. 加减乘除</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加</span></span><br><span class="line">add(BigDecimal)</span><br><span class="line"><span class="comment">//减  </span></span><br><span class="line">subtract(BigDecimal)   </span><br><span class="line"><span class="comment">//乘</span></span><br><span class="line">multiply(BigDecimal)</span><br></pre></td></tr></table></figure>
<p>加减乘除 其实最终都返回的是一个新的BigDecimal对象，<br>因为BigInteger与BigDecimal都是不可变的（immutable）的，<br>在进行每一步运算时，都会产生一个新的对象。<br>所以a.add(b);虽然做了加法操作，但是a并没有保存加操作后的值，<br><strong>正确的用法应该是a=a.add(b);</strong>    </p>
<p>加减乘一般不用考虑精度，而 <strong>除法需要考虑精度 (scale) 问题</strong>，BigDecimal 的除法重载了6次，一般用下面的方法就够了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//除</span></span><br><span class="line"><span class="function">BigDecimal <span class="title">divide</span><span class="params">(BigDecimal divisor, <span class="keyword">int</span> scale, <span class="keyword">int</span> roundingMode)</span></span></span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal b1=<span class="keyword">new</span> BigDecimal(<span class="string">"100"</span>);</span><br><span class="line">BigDecimal b3=<span class="keyword">new</span> BigDecimal(<span class="string">"3"</span>);</span><br><span class="line">System.out.println(b1.divide(b3, <span class="number">10</span>, BigDecimal.ROUND_HALF_UP));</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33.3333333334</span><br></pre></td></tr></table></figure></p>
<p><strong>分析</strong>:  </p>
<ol>
<li>精度scale=10，保留10位小数。  </li>
<li><strong>BigDecimal.ROUND_HALF_UP</strong> 四舍五入。  </li>
</ol>
<p>BigDecimal 提供了 8 中 舍入模式(<strong><font color="#cc0066">Rounding mode</font></strong>)：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_UP =           <span class="number">0</span>; <span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_DOWN =         <span class="number">1</span>; <span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_CEILING =      <span class="number">2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_FLOOR =        <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_HALF_UP =      <span class="number">4</span>; <span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_HALF_DOWN =    <span class="number">5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_HALF_EVEN =    <span class="number">6</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ROUND_UNNECESSARY =  <span class="number">7</span>;</span><br></pre></td></tr></table></figure></p>
<p>常用的有：  </p>
<ul>
<li>ROUND_UP 进一法(不论保留位是多少，都进一)</li>
<li>ROUND_DOWN 截断法(不论保留位是多少，都舍弃)</li>
<li>ROUND_HALF_UP 四舍五入法(保留位大于等于5进一，否则就舍弃)</li>
<li>ROUND_HALF_DOWN 五舍五入(<strong>保留位及以后位大于5进一</strong>，否则舍弃)  </li>
</ul>
<p>ROUND_HALF_UP 和 ROUND_HALF_DOWN 很像，只是在对5 的进位尺度有一点点不同。<br>比如，<br><strong>3.0500</strong> 保留两位小数：<br><strong>ROUND_HALF_UP</strong>：3.1<br><strong>ROUND_HALF_DOWN</strong>：3.0    </p>
<p><strong>3.0501</strong> 保留两位小数：<br><strong>ROUND_HALF_UP</strong>：3.1<br><strong>ROUND_HALF_DOWN</strong>：3.1  </p>
<h1 id="2-设置精度"><a href="#2-设置精度" class="headerlink" title="2. 设置精度"></a>2. 设置精度</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">setScale</span><span class="params">(<span class="keyword">int</span> newScale, <span class="keyword">int</span> roundingMode)</span></span></span><br></pre></td></tr></table></figure>
<p>newScale : 精度，保留小数的位数。<br><strong><font color="#cc0066">RoundingMode</font></strong> : 进位模式，上面 8 种模式之一。</p>
<h1 id="3-比较大小"><a href="#3-比较大小" class="headerlink" title="3. 比较大小"></a>3. 比较大小</h1><p>对比：Returns:-1, 0, or 1 as this BigDecimal is numerically less than, equal to, or greater than val.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(BigDecimal val)</span></span></span><br></pre></td></tr></table></figure></p>
<p>说明：<strong>a.compareTo(b)</strong>  </p>
<ul>
<li><strong>若a&gt;b : 返回1</strong>   </li>
<li>若a=b : 返回0  </li>
<li>若a&lt;b : 返回-1</li>
</ul>
<h1 id="4-其他"><a href="#4-其他" class="headerlink" title="4. 其他"></a>4. 其他</h1><p><strong>乘方</strong>：Returns a BigDecimal whose value is (this^n), The <strong>power</strong> is computed exactly, to unlimited precision.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">pow</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>取绝对值</strong>：Returns a BigDecimal whose value is the <strong>absolute value</strong> of this BigDecimal, and whose scale is this.scale().<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">abs</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>取反</strong>：Returns a BigDecimal whose value is (-this),and whose scale is this.scale().<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">negate</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/30/java正则表达式-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/30/java正则表达式-1/" itemprop="url">java正则表达式-1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-30T09:21:54+08:00">
                2018-10-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>java.util.regex</strong> 下有两个类，<strong><font color="#00e600">Pattern</font></strong> 和 <strong><font color="#3399ff">Matcher</font></strong> 。    </p>
<h1 id="1-抛砖引玉-Pattern-matches"><a href="#1-抛砖引玉-Pattern-matches" class="headerlink" title="1. 抛砖引玉  Pattern.matches"></a>1. 抛砖引玉  <strong><font color="#00e600">Pattern.matches</font></strong></h1><p><strong>Pattern.matches(regex,str)</strong> 要求 <strong>字符串str</strong> <font color="#cc00cc">完全符合</font> <strong>匹配规则(字符串)regex</strong> ，返回结果才为 true。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String str=<span class="string">"A compiled representation of a regular expression."</span>;</span><br><span class="line">		String regex=<span class="string">".*re.*"</span>;</span><br><span class="line">		<span class="keyword">boolean</span> b=Pattern.matches(regex, str);</span><br><span class="line">		System.out.println(<span class="string">"是否包含字符串re: "</span>+b);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Pattern.matches(regex, str) 等价于Pattern.compile(regex).matcher(str).matches()</span></span><br><span class="line">		<span class="keyword">boolean</span> b2=Pattern.compile(regex).matcher(str).matches();</span><br><span class="line">		System.out.println(b2);</span><br><span class="line"></span><br><span class="line">		System.out.println(Pattern.matches(<span class="string">"re"</span>, <span class="string">"A compiled representation of a regular expression."</span>));<span class="comment">//false</span></span><br><span class="line">		System.out.println(Pattern.matches(<span class="string">"\\d+"</span>,<span class="string">"123"</span>)); <span class="comment">//true</span></span><br><span class="line">		System.out.println(Pattern.matches(<span class="string">"\\d+"</span>,<span class="string">"123a"</span>)); <span class="comment">//false</span></span><br><span class="line">		System.out.println(Pattern.matches(<span class="string">"\\d+"</span>,<span class="string">"123a456"</span>)); <span class="comment">//false</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>正则表达式，就是一个指定匹配规则的字符串，这个字符串(正则表达式)必须被编译成 <strong><font color="#e60000">Pattern类的实例</font></strong> 才能创建 <strong><font color="#3399ff">Matcher 对象</font></strong>。正则表达式先编译成 Pattern实例 再创建 Matcher对象有一个好处：多个 matcher 可以共享一个 pattern，达到复用的效果。<br>如下，引用 java API 提供的<a href="https://docs.oracle.com/javase/7/docs/api/" target="_blank" rel="noopener">例子</a>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pattern p = Pattern.compile(<span class="string">"a*b"</span>);</span><br><span class="line">Matcher m = p.matcher(<span class="string">"aaaaab"</span>);</span><br><span class="line"><span class="keyword">boolean</span> b2 = m.matches(); <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<p>下面的写法与上面等价，其内部实现就是上面三行代码，只是 <strong>一个匹配的简写</strong> 罢了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> b1 = Pattern.matches(<span class="string">"a*b"</span>, <span class="string">"aaaaab"</span>);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<h1 id="2-Groups-and-capturing-捕获组"><a href="#2-Groups-and-capturing-捕获组" class="headerlink" title="2. Groups and capturing 捕获组"></a>2. Groups and capturing 捕获组</h1><p>通过 <strong>从左到右</strong> 数开头圆括号，对捕获组进行编号。例如下面的正则表达式 <strong>捕获组</strong> ：<br><strong>( (A) (B (C)) )</strong><br>1 &emsp;((A)(B(C)))<br>2 &emsp;(A)<br>3 &emsp;(B(C))<br>4 &emsp;(C)<br>0 &emsp;整个字符串，((A)(B(C)))   </p>
<p>捕获组的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  String str=<span class="string">"for example, there are four such groups"</span>;</span><br><span class="line">  String regex=<span class="string">"((.*)(,)(.*))"</span>;</span><br><span class="line">  Pattern pattern=Pattern.compile(regex);</span><br><span class="line">  Matcher m=pattern.matcher(str);</span><br><span class="line">  <span class="keyword">if</span>(m.find()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"start: "</span>+m.start());</span><br><span class="line">    System.out.println(<span class="string">"end: "</span>+m.end());</span><br><span class="line">    System.out.println(<span class="string">"group  : "</span>+m.group());</span><br><span class="line">    System.out.println(<span class="string">"group等价于: "</span>+<span class="string">"str.substring(m.start(),m.end())"</span>);</span><br><span class="line">    System.out.println(str.substring(m.start(),m.end()));</span><br><span class="line">    System.out.println(<span class="string">"------"</span>);</span><br><span class="line">    System.out.println(<span class="string">"group1 : "</span>+m.group(<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">"group2 : "</span>+m.group(<span class="number">2</span>));</span><br><span class="line">    System.out.println(<span class="string">"group3 : "</span>+m.group(<span class="number">3</span>));</span><br><span class="line">    System.out.println(<span class="string">"group4 : "</span>+m.group(<span class="number">4</span>));</span><br><span class="line">    System.out.println(<span class="string">"group0 : "</span>+m.group(<span class="number">0</span>));</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">"字符串与正则表达式 不完全匹配"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-30_143437.png" alt>   </p>
<p>Matcher 的 <strong><font color="#e65c00">find() 函数</font></strong> 的两个特点：<br>1、 如果正则表达式里 <strong>包含</strong> 分组。那么，<strong>find()函数</strong> 会对 <strong>str</strong> 与 <strong>regex</strong> 做完全匹配。若匹配上，返回 <strong>true</strong>，此时可以通过 <strong>group(int i)</strong> 来访问每一个组；若未匹配上，返回 <strong>false</strong> 。<br>2、 如果正则表达式 <strong>不包含</strong> 分组。那么，<strong>find()函数</strong> 会对 <strong>str</strong> 与 <strong>regex</strong> 做 <strong>不完全</strong> 匹配。即只要 str 中包含 regex 就会返回 true。此时可以通过 <strong>group()</strong> 来访问匹配到的 regex (注：str中可能有多个regex，第一次find只能获取到第一个匹配，第二次find获取到第二个，以此类推)，regex在str中的起始位置可以通过 <strong>start() 和 end()</strong> 获得。   </p>
<p><strong><font color="#e65c00">find() 函数</font></strong> 的第 2 个特点，看例子会更清楚：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  String str1=<span class="string">"A compiled representation of a regular expression."</span>;</span><br><span class="line">  String regex1=<span class="string">"re"</span>;</span><br><span class="line">  Pattern p=Pattern.compile(regex1);</span><br><span class="line">  Matcher m1=p.matcher(str1);</span><br><span class="line">  <span class="keyword">if</span>(m1.find()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"m1.start: "</span>+m1.start());</span><br><span class="line">    System.out.println(<span class="string">"m1.end: "</span>+m1.end());</span><br><span class="line">    System.out.println(<span class="string">"m1.group(): "</span>+m1.group());</span><br><span class="line">    System.out.println(str1.substring(m1.start(), m1.end()));<span class="comment">//与上等价写法</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"m1.group(0): "</span>+m1.group(<span class="number">0</span>)); <span class="comment">// group(1..n)会报错</span></span><br><span class="line">    System.out.println(<span class="string">"====="</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m1.start: 11</span><br><span class="line">m1.end: 13</span><br><span class="line">m1.group(): re</span><br><span class="line">re</span><br><span class="line">m1.group(0): re</span><br><span class="line">=====</span><br></pre></td></tr></table></figure></p>
<p>如果把if 换成 while， 结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">m1.start: 11</span><br><span class="line">m1.end: 13</span><br><span class="line">m1.group(): re</span><br><span class="line">re</span><br><span class="line">m1.group(0): re</span><br><span class="line">=====</span><br><span class="line">m1.start: 14</span><br><span class="line">m1.end: 16</span><br><span class="line">m1.group(): re</span><br><span class="line">re</span><br><span class="line">m1.group(0): re</span><br><span class="line">=====</span><br><span class="line">m1.start: 31</span><br><span class="line">m1.end: 33</span><br><span class="line">m1.group(): re</span><br><span class="line">re</span><br><span class="line">m1.group(0): re</span><br><span class="line">=====</span><br><span class="line">m1.start: 42</span><br><span class="line">m1.end: 44</span><br><span class="line">m1.group(): re</span><br><span class="line">re</span><br><span class="line">m1.group(0): re</span><br><span class="line">=====</span><br></pre></td></tr></table></figure></p>
<p>分析：<br>“ <strong>A compiled <font color="#ff0000">re</font>p<font color="#ff0000">re</font>sentation of a <font color="#ff0000">re</font>gular exp<font color="#ff0000">re</font>ssion.</strong> “<br>这句话有4个 <strong>re</strong> ，但是第一次 find ，group() 只能匹配到下标为[11,13)的第一个字符串。后面3个 需要多次find 获得。  </p>
<p>看一个实际应用的例子：<br>把字符串 “$year$ $month$ $day$” 中的年月日换成真实的年月日。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">  map.put(<span class="string">"year"</span>, <span class="string">"2018"</span>);</span><br><span class="line">  map.put(<span class="string">"month"</span>, <span class="string">"10"</span>);</span><br><span class="line">  map.put(<span class="string">"day"</span>,<span class="string">"30"</span>);</span><br><span class="line">  String str=<span class="string">"$year$ $month$ $day$"</span>;</span><br><span class="line">  <span class="comment">//String regex="\\$[^\\$]+\\$";</span></span><br><span class="line">  String regex=<span class="string">"\\$.*?\\$"</span>;</span><br><span class="line"></span><br><span class="line">  Pattern p=Pattern.compile(regex);</span><br><span class="line">  <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">    Matcher m=p.matcher(str);</span><br><span class="line">    <span class="keyword">if</span>(!m.find())</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    String group=m.group();</span><br><span class="line">    String param=group.replaceAll(<span class="string">"\\$"</span>,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">//System.out.println(param);</span></span><br><span class="line">    str=str.replace(<span class="string">"$"</span>+param+<span class="string">"$"</span>,map.get(param));</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018 10 30</span><br></pre></td></tr></table></figure></p>
<p>分析：  </p>
<ol>
<li><strong>regex=”\\$.*?\\$”</strong> 问号表示 <strong>非贪婪匹配</strong> ，默认是贪婪匹配。  </li>
<li><strong>regex=”\\$[^\\$]+\\$”</strong> 也可以完成此例，这是参照公司框架代码的写法。  </li>
<li>此例关键在于，循环多次find，每次把第一个替换掉，这样可以遍历到所有的匹配到的字符串。  </li>
</ol>
<h1 id="3-Pattern-的方法-split"><a href="#3-Pattern-的方法-split" class="headerlink" title="3. Pattern 的方法-split"></a>3. Pattern 的方法-split</h1><p><strong><font color="#00b3b3">String[]    split(CharSequence input)</font></strong><br>String 实现了 CharSequence 接口，因此可以给split传一个 String 参数。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Pattern p=Pattern.compile(<span class="string">"\\++"</span>);</span><br><span class="line">String[] str=p.split(<span class="string">"1+1+2+3"</span>);</span><br></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str[0]=1</span><br><span class="line">str[1]=1</span><br><span class="line">str[2]=2</span><br><span class="line">str[3]=3</span><br></pre></td></tr></table></figure></p>
<p><strong>String 也有一个 split 方法</strong> ：<br><strong><font color="#0059b3">String[] split(String regex)</font></strong>   </p>
<h1 id="4-附录"><a href="#4-附录" class="headerlink" title="4. 附录"></a>4. 附录</h1><h2 id="4-1-常用正则表达式"><a href="#4-1-常用正则表达式" class="headerlink" title="4.1 常用正则表达式"></a>4.1 常用正则表达式</h2><table>
<thead>
<tr>
<th>规则</th>
<th>正则表达式语法</th>
</tr>
</thead>
<tbody>
<tr>
<td>一个或多个汉字</td>
<td>^[\u0391-\uFFE5]+$</td>
</tr>
<tr>
<td>邮政编码</td>
<td>^[1-9]\d{5}$</td>
</tr>
<tr>
<td>邮箱</td>
<td>^[a-zA-Z_]{1,}[0-9]{0,}@(([a-zA-z0-9]-*){1,}.){1,3}[a-zA-z-]{1,}$</td>
</tr>
<tr>
<td>用户名（字母开头 + 数字/字母/下划线）</td>
<td>^[A-Za-z][A-Za-z1-9_-]+$</td>
</tr>
<tr>
<td>手机号码</td>
<td>^1[3 &#124;4&#124;5&#124;8][0-9]\d{8}$</td>
</tr>
<tr>
<td>URL</td>
<td>^((http &#124;https)://)?([\w-]+.)+[\w-]+(/[\w-./?%&amp;=]*)?$</td>
</tr>
<tr>
<td>18位身份证号</td>
<td>^(\d{6})(18&#124;19&#124;20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d&#124;X&#124;x)?$</td>
</tr>
</tbody>
</table>
<h2 id="4-2-正则表达式语法"><a href="#4-2-正则表达式语法" class="headerlink" title="4.2 正则表达式语法"></a>4.2 正则表达式语法</h2><p><a href="https://www.cnblogs.com/lzq198754/p/5780340.html" target="_blank" rel="noopener">参见</a>   </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/Spring学习7-Spring-JDBC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/Spring学习7-Spring-JDBC/" itemprop="url">Spring学习7-Spring JDBC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-23T21:45:37+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h1><p>最原始的(不考虑ORM框架，不考虑Spring JDBC)，我们用 JDBC 操作数据库通常是以下几步：  </p>
<ol>
<li>连接数据库：加载驱动，根据url，用户名，密码连接数据库。(初始化连接池)  </li>
<li>获取connection。    </li>
<li>获取statement。  </li>
<li>增删改查，提交。(查询返回ResultSet)  </li>
<li>关闭连接  </li>
</ol>
<p>通常，我们会编写一个 DBUtils 类来管理连接，然后编写 DAO 封装增删改查方法。  </p>
<p>因为更简便、耦合度低的操作数据库的框架出现，现在人们开发程序很少直接用 JDBC 了。<br>本文介绍 Spring 提供的 API JdbcTemplate ，后面再介绍 MyBatis 框架。<br>JDBCTemplate 封装了获取连接，执行SQL，释放连接等操作。  </p>
<p></p><h1 id="id1"> 1. Spring 与 JDBC 整合</h1><br>Spring 提供了：<p></p>
<ul>
<li>JdbcTemplate  </li>
<li>AOP事务管理  </li>
<li>统一异常处理 DataAccessException  </li>
</ul>
<p>Spring + JDBC 开发步骤：  </p>
<ol>
<li>搭建开发环境：<br>引入各种jar包，包括Spring(Core，AOP，DAO) ,连接池dbcp，JDBC包等。  </li>
<li>编写实体类domain  </li>
<li>编写Dao数据库操作逻辑  </li>
<li>applicationContext.xml 中配置，扫描Dao组件，<strong>注入 JdbcTamplate 对象</strong>   </li>
</ol>
<p>举个例子：<br>1、搭建开发环境，略。<br>2、 编写 domain 类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.domain;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="keyword">private</span> BigDecimal salary;</span><br><span class="line">  <span class="comment">//get set方法略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3、 Dao数据库操作：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.domain.Emp;</span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">//扫描到Spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpDao</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Resource</span></span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate template;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 向MySQL数据库emp表中插入一条数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> cx</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> emp 实体对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@time</span> 上午8:43:02</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Emp emp)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"insert into emp(name,age,salary) values(?,?,?)"</span>;</span><br><span class="line">		Object[] param= &#123;emp.getName(),emp.getAge(),emp.getSalary()&#125;;</span><br><span class="line">		<span class="comment">//update 可用在 增删改</span></span><br><span class="line">		template.update(sql, param);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"delete from emp where id=?"</span>;</span><br><span class="line">		Object[] param= &#123;id&#125;;</span><br><span class="line">		template.update(sql, param);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"delete from emp where name=?"</span>;</span><br><span class="line">		Object[] param= &#123;name&#125;;</span><br><span class="line">		template.update(sql, param);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//查找</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">queryAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">		String sql=<span class="string">"select * from emp"</span>;</span><br><span class="line">		EmpRowMapper empRowMapper=<span class="keyword">new</span> EmpRowMapper();  <span class="comment">//自定义RowMapper</span></span><br><span class="line">		List&lt;Emp&gt; list=template.query(sql, empRowMapper);</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>查找时，需要RowMapper参数，用于把数据库字段和domain字段对应：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.domain.Emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Emp</span>&gt; </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Emp <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> index)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		Emp emp=<span class="keyword">new</span> Emp();</span><br><span class="line">		emp.setId(resultSet.getInt(<span class="string">"id"</span>));</span><br><span class="line">		emp.setName(resultSet.getString(<span class="string">"name"</span>));</span><br><span class="line">		emp.setAge(resultSet.getInt(<span class="string">"age"</span>));</span><br><span class="line">		emp.setSalary(resultSet.getBigDecimal(<span class="string">"salary"</span>));</span><br><span class="line">		<span class="keyword">return</span> emp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4、 applicationContext.xml 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.mitrecx"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"template"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入连接信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dbcp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- dataSource数据源， 连接池: dbcp,c3p0,proxool --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- dbcp连接池 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dbcp"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp2.BasicDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://cherry.mitrecx.cn:3306/DBmitre?useUnicode=true&amp;amp;characterEncoding=utf8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.domain.Emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDao</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		EmpDao empDao=ac.getBean(<span class="string">"empDao"</span>,EmpDao.class);</span><br><span class="line"><span class="comment">//		Emp emp=new Emp();</span></span><br><span class="line"><span class="comment">//		emp.setName("李敖");</span></span><br><span class="line"><span class="comment">//		emp.setAge(23);</span></span><br><span class="line"><span class="comment">//		emp.setSalary(new BigDecimal("5000"));</span></span><br><span class="line"><span class="comment">//		empDao.insert(emp);</span></span><br><span class="line"><span class="comment">//		empDao.deleteByName("李敖");</span></span><br><span class="line">		List&lt;Emp&gt; list=empDao.queryAll();</span><br><span class="line">		<span class="keyword">for</span>(Emp emp1:list) &#123;</span><br><span class="line">			System.out.println(emp1.getName()+<span class="string">"  "</span>+emp1.getAge());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-06_234000.png" alt>  </p>
<h1 id="2-Spring-MVC-与-JDBC-template-结合"><a href="#2-Spring-MVC-与-JDBC-template-结合" class="headerlink" title="2. Spring MVC 与 JDBC template 结合"></a>2. Spring MVC 与 JDBC template 结合</h1><p>Spring MVC 和 JDBC Template 结合，这不是一个新的知识，只是在 Spring MVC 的基础上，加上 <a href="#id1">上一节</a> 介绍地 JDBC Template 数据库操作。   </p>
<p>直接看一个简单的实例，就清楚怎么写了。  </p>
<p>最近，我也在想，一直写简单的例子，什么时候才能掌握Spring ？<br>其实，这应该是一个日积月累的过程。达到一定的量，就会有质的改变。<br>能独立做好无数个简单的例子，就已经在深入学习了。<br>不要怕一直在做简单的例子，应该考虑如何在最短的时间学会更多的简单的例子。。  </p>
<p>下面演示利用 JDBC Template 向 MySQL 数据库插入一条数据：  </p>
<p>1、servlet 配置文件 web.xml ：    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>spring11-8-JdbcTemplate<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、 操作页面 add.jsp :  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"font-size: 30px;"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"addHandle.do"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">			name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			age: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			salary: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"salary"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、 实体类 Emp.java :  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="keyword">private</span> BigDecimal salary;</span><br><span class="line">  <span class="comment">//get set 方法略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、 数据库操作类 EmpDao.java :<br>DAO类一定要注意 template 成员的值 <strong>是由Spring 容器注入的</strong>。<br><strong>template 在 <a href="#applicationContext">applicationContext.xml</a> 中配置</strong>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.domain.Emp;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span>(<span class="string">"empDaoID"</span>) <span class="comment">//扫描到Spring IoC容器，id为empDaoID</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Resource</span>(name=<span class="string">"template"</span>) <span class="comment">//注入id为template的bean，已在applicationContext.xml中配置</span></span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Emp emp)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"insert into emp(name,age,salary) values(?,?,?)"</span>;</span><br><span class="line">		Object[] param= &#123;emp.getName(),emp.getAge(),emp.getSalary()&#125;;</span><br><span class="line">		<span class="comment">//update 可用在 增删改</span></span><br><span class="line">		template.update(sql, param);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5、 Spring 配置文件 <span id="applicationContext">applicationContext.xml</span>:<br><strong>注意组件扫描</strong> 的 base-package 属性，一定要包含所有需要扫描的包。    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- HandlerMapping : 用mvc:annotation-driven包含了多个bean，其中有handlerMapping这个bean --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 扫描controller --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.mitrecx"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- ViewResolver --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ViewResolver的前缀后缀属性，用于给controller返回的mav加前后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"template"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入连接信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dbcp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- dataSource数据源， 连接池: dbcp,c3p0,proxool --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- dbcp连接池 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dbcp"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp2.BasicDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://cherry.mitrecx.cn:3306/DBmitre?useUnicode=true&amp;amp;characterEncoding=utf8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>6、 controller 组件 ：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.dao.EmpDao;</span><br><span class="line"><span class="keyword">import</span> cn.mitrecx.domain.Emp;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/add.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ModelAndView mav=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">		mav.setViewName(<span class="string">"add"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/addHandle.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addHandle</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		EmpDao empDao=ac.getBean(<span class="string">"empDaoID"</span>,EmpDao.class);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 *不能直接 new EmpDao()  </span></span><br><span class="line"><span class="comment">		 *直接new的对象，无法获取到注入到的成员 template(在applicationContext.xml中定义)。</span></span><br><span class="line"><span class="comment">		 *****确切的说，直接new的对象，无法获取到Spring容器注入到 此对象 的成员。</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="comment">//EmpDao empDao=new EmpDao();</span></span><br><span class="line">		Emp emp=<span class="keyword">new</span> Emp();</span><br><span class="line">		emp.setName(request.getParameter(<span class="string">"name"</span>));</span><br><span class="line">		emp.setAge(Integer.parseInt(request.getParameter(<span class="string">"age"</span>)));</span><br><span class="line">		emp.setSalary(<span class="keyword">new</span> BigDecimal(request.getParameter(<span class="string">"salary"</span>)));</span><br><span class="line"></span><br><span class="line">		empDao.insert(emp);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-08_164355.png" alt>    </p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-11/2018-11-08_164516.png" alt>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/17/Spring学习6-拦截器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/17/Spring学习6-拦截器/" itemprop="url">Spring学习6-过滤器,异常处理,拦截器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-17T23:59:29+08:00">
                2018-10-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-过滤器"><a href="#1-过滤器" class="headerlink" title="1. 过滤器"></a>1. 过滤器</h1><p>过滤器在介绍 servlet 已经 <a href="https://mitrecx.github.io/2018/09/21/servlet%E8%BF%87%E6%BB%A4%E5%99%A8/" target="_blank" rel="noopener">讲过</a>，<br>这里在讲是为了抛砖引玉，说明 Spring 提供了一些 <strong>拦截器</strong> ， 在开发中，我们可以直接拿来用。  </p>
<p>用拦截器解决中文乱码问题：<br>从页面表单( utf-8 ) 传到 controller( iso-8859 )  的中文是乱码的。<br>解决问题很简单，在controller 中加一行代码就能解决。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure></p>
<p>考虑到，每个 controller 都会有编码问题，所以写一个 <strong>过滤器</strong> 统一处理比较好。  </p>
<p>写一个类 MyFilter.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String conf;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 拦截方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//前期逻辑</span></span><br><span class="line">		request.setCharacterEncoding(<span class="keyword">this</span>.conf);</span><br><span class="line">		<span class="comment">//执行chain.doFilter，程序就会继续向后执行</span></span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		<span class="comment">//后期逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 启动Tomcat服务器时，加载web.xml里的Filter配置</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">this</span>.conf=arg0.getInitParameter(<span class="string">"encoding"</span>);</span><br><span class="line">		System.out.println(conf);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 web.xml 中配置过滤器<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>cn.mitrecx.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>事实上，上面的这个过滤器Spring 已经写好了，我们直接在web.xml 中配置一下就行了。<br>配置方法：<br>用<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>替换<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>cn.mitrecx.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>即可。  </p>
<p><strong>CharacterEncodingFilter</strong> 这个类在 spring-web-5.0.0.RELEASE.jar 中，在这个jar 包中有十几个过滤器。  </p>
<h1 id="2-异常处理"><a href="#2-异常处理" class="headerlink" title="2. 异常处理"></a>2. 异常处理</h1><p>异常处理，我们首先能想到的是 try-catch。这里不用try-catch，用Spring 提供的异常处理机制。<br>有两种处理方法：  </p>
<ol>
<li>全局按异常类型处理，遇到异常直接抛出，统一处理。  </li>
<li>局部单独处理。  </li>
</ol>
<p>就 <strong>第一种处理方法（全局）</strong> 举个例子：  </p>
<p>controller  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/exception.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		String ss=<span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//故意制造一个空指针异常，throws Exception，交个容器处理</span></span><br><span class="line">		ss.length();</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- HandlerMapping --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- controller --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.mitrecx.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- ViewResolver --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ViewResolver的前缀后缀属性，用于给controller返回的mav加前后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 异常处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- key是异常类型，value是视图名 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"java.lang.Exception"</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这样，空指针异常将不会出现一个500页面，而是 WEB-INF/error.jsp 呈现的内容。  </p>
<p>这个流程可以描绘成下面这幅图：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-22_223213.png" alt>  </p>
<p><strong>SimpleMappingExceptionResolver</strong> 是Spring提供的一个简单的异常处理器，我们可以自己写一个，只要实现 <strong>HandlerExceptionResolver接口</strong> 就行。 事实上， SimpleMappingExceptionResolver 也是 实现了 HandlerExceptionResolver接口的。  </p>
<p>这里给一个demo：<br>写一个异常处理类MyExceptionHandler.java：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerExceptionResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object arg2, Exception e)</span> </span>&#123;</span><br><span class="line">		ModelAndView mav=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">		System.out.println(<span class="string">"异常信息："</span>+e);</span><br><span class="line">		mav.setViewName(<span class="string">"error"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>applicationContext.xml 中配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.mitrecx.exception.MyExceptionHandler"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>第二种异常处理方法（局部）</strong>：<br>把第一种异常处理方法的 controller 改一下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/exception.do"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String ss=<span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//故意制造一个空指针异常，throws Exception，交个容器处理</span></span><br><span class="line">		ss.length();</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 这个 异常处理方法只对当前controller起作用，</span></span><br><span class="line"><span class="comment">	 * 方法名自定义，参数固定</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> cx</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@time</span> 下午11:15:33</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@ExceptionHandler</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">handleException</span><span class="params">(HttpServletRequest request, Exception e)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"localError"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时，当我访问exception.do 时，<br>不会到异常处理页面WEB-INF/error.jsp，<br>而会访问异常处理页面WEB-INF/localError.jsp  </p>
<h1 id="3-Spring拦截器组件"><a href="#3-Spring拦截器组件" class="headerlink" title="3. Spring拦截器组件"></a>3. Spring拦截器组件</h1><p>拦截器组件是 Spring MVC 特有的组件。<br>拦截器组件可以在 controller 之前拦截，也可以在 controller 之后拦截。<br>还可以在 jsp 解析完成后拦截。  </p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/spring-interceptor.png" alt></p>
<p>拦截器使用步骤：  </p>
<ol>
<li>编写一个拦截器组件，实现 <strong>HandlerInterceptor</strong>  </li>
<li>在applicationContext.xml 中配置拦截器  </li>
</ol>
<p>实现如下：<br>编写拦截器组件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mitrecx.interceptor;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">	<span class="comment">//controll 之前，bool 返回false，就会拦截，拦截器后面的组件就不执行了</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"preHandle:  在controll前拦截。"</span>);</span><br><span class="line">		HttpSession session=request.getSession();</span><br><span class="line">		String userName=(String) session.getAttribute(<span class="string">"userName"</span>);</span><br><span class="line">		<span class="comment">//登录过</span></span><br><span class="line">		<span class="keyword">if</span>(userName!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 按正常流程走</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//未登录过，或登录失效</span></span><br><span class="line">			<span class="comment">//重定向到登录页面</span></span><br><span class="line">			response.sendRedirect(<span class="string">"login.do"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// controll 之后</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"postHandle:  controll 之后"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求出来完毕，输出之前</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"afterCompletion..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截哪些请求，/**表示拦截所有请求 /*表示拦截所有不包含子目录的请求 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 放过哪些请求 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/login.do"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/checkup.do"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.mitrecx.interceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/Spring学习5-Spring-web-MVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/Spring学习5-Spring-web-MVC/" itemprop="url">Spring学习5-Spring web MVC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T23:38:41+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-Spring-Web-MVC-简介"><a href="#1-Spring-Web-MVC-简介" class="headerlink" title="1. Spring Web MVC 简介"></a>1. Spring Web MVC 简介</h1><p>Spring Web MVC 是构建在 Servlet API 上的原始Spring框架。它的正式名称”Spring Web MVC”来自于它的源组件(spring-webmvc)，<br>但是通常我们简称它为 “Spring MVC” 。<br>在Spring Framework 5.0 引入了一个 reactive-stack 的web 框架，其名称为 “Spring WebFlux”，名称同样来自于它的源组件(spring-webflux)，<br>Spring WebFlux 是与Spring MVC 并行存在的(不是Spring MVC的替代)。  </p>
<p>Spring MVC 依赖于 Spring IoC 。<br>Spring MVC 用于 <strong>开发</strong> 具有 MVC 模式的 <strong>web应用</strong>。  </p>
<p>Spring MVC 的 Context Hierarchy(上下文层次体系) 如下，图源来自于Spring官方<a href="https://docs.spring.io/spring/docs/5.1.1.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">参考指南</a> ：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/mvc-context-hierarchy.png" alt>  </p>
<h1 id="id2">2. Spring MVC 开发步骤</h1>  

<ol>
<li>在 <strong>web.xml</strong> 文件中 <strong><font color="#00B2EE">配置</font></strong> <strong>DispatcherServlet</strong>   </li>
<li>在 applicationContext.xml 文件中 <strong><font color="#00B2EE">配置</font></strong> <strong>HandlerMapping</strong>  </li>
<li>编写 <strong>controller</strong> (实现Controller) 在applicationContext.xml中配置注入(或注解注入)  </li>
<li><strong><font color="#00B2EE">配置</font></strong> <strong>ViewResolver</strong> 用于寻找页面展示文件  </li>
<li>编写 页面展示文件(jsp、HTML等)  </li>
</ol>
<p>注：<br>导包需要  </p>
<ul>
<li>spring-context-5.0.0.RELEASE.jar</li>
<li>spring-core-5.0.0.RELEASE.jar</li>
<li>spring-beans-5.0.0.RELEASE.jar</li>
<li>commons-logging.jar</li>
<li>spring-expression-5.0.0.RELEASE.jar</li>
<li>spring-web-5.0.0.RELEASE-sources.jar</li>
<li>spring-web-5.0.0.RELEASE.jar</li>
<li>spring-webmvc-5.0.0.RELEASE.jar</li>
<li>扩展，以后开发用<ul>
<li>standard.jar</li>
<li>spring-aop-5.0.0.RELEASE.jar</li>
<li>jstl.jar</li>
<li>mybatis-3.4.6.jar</li>
<li>mysql-connector-java-8.0.12.jar</li>
</ul>
</li>
</ul>
<p>导包很麻烦？ 先学习下 <a href>Maven</a>.  </p>
<h1 id="3-Spring-MVC-入门实例"><a href="#3-Spring-MVC-入门实例" class="headerlink" title="3. Spring MVC 入门实例"></a>3. Spring MVC 入门实例</h1><p>实例结果:<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-17_095628.png" alt>  </p>
<p>实现过程如下：  </p>
<p>1、 在 web.xml 中配置 DispatcherServlet<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>spring10-16-MVC1<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 编写controller 组件：处理逻辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> <span class="keyword">implements</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ModelAndView mav=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">    <span class="comment">//设置返回页面的名称，此名称会经过ViewResolver加工，最终定位到一个文件</span></span><br><span class="line">		mav.setViewName(<span class="string">"helloSpring"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//绑定数据，等价于 request.setAttribute</span></span><br><span class="line">		mav.getModel().put(<span class="string">"msg"</span>, <span class="string">"由 mav.getModel().put传出"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3、 配置HandlerMapping 把请求交给对应的 controller 组件<br>注入controller ，也可以用注解注入<br>配置(注入)ViewResolver 组件，为controller组件定位jsp页面   </p>
<p>applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- HandlerMapping --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"handlermapping"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappings"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- helloController取自controller的id名 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/hello.do"</span>&gt;</span>helloController<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- controller --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloController"</span> <span class="attr">class</span>=<span class="string">"controller.HelloController"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- ViewResolver --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ViewResolver的前缀后缀属性，用于给controller返回的mav加前后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4、 展示页面 helloSpring.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"font-size: 30px;"</span>&gt;</span></span><br><span class="line">		hello Spring web MVC.  <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span>/&gt;</span> msg: $&#123;msg &#125;</span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span>/&gt;</span> requestScope.msg: $&#123;requestScope.msg &#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="4-使用注解改进程序"><a href="#4-使用注解改进程序" class="headerlink" title="4. 使用注解改进程序"></a>4. 使用注解改进程序</h1><p>Spring MVC 使用注解开发步骤和<a href="#id2">前面步骤</a>一样，只是：<br>把applicationContext.xml 中的 <strong>handlerMapping</strong> 这个 bean 用 <strong>mvc:annotation-driven</strong> 代替,<br>把 <strong>配置controller</strong> 用 <strong>扫描context:component-scan</strong> 代替，<br>controller类里加上注解。  </p>
<p>使用注解的好处是方便灵活。   </p>
<p>程序实现：<br>web.xml 不变。  </p>
<p>applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- HandlerMapping : 用mvc:annotation-driven包含了多个bean，其中有handlerMapping这个bean --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 扫描controller --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- ViewResolver --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ViewResolver的前缀后缀属性，用于给controller返回的mav加前后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>controller组件 helloSpring.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hello.do"</span>) <span class="comment">//直接把请求和处理方法关联</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		mav.getModel().put(<span class="string">"msg"</span>, <span class="string">"注解版"</span>);</span><br><span class="line">    <span class="comment">//返回视图名称</span></span><br><span class="line">		mav.setViewName(<span class="string">"helloSpring"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">/*可以写多个方法，结合RequestMapping注解匹配处理多个请求*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面 helloSpring.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"font-size: 30px;"</span>&gt;</span></span><br><span class="line">		hello Spring web MVC.  <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span>/&gt;</span> msg: $&#123;msg &#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/spring-mvc-2.png" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/15/Spring学习4-注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/15/Spring学习4-注解/" itemprop="url">Spring学习4-注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-15T18:50:02+08:00">
                2018-10-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>JDK 5.0</strong> ，是JDK (Java Development Kit) 具有里程碑的一个版本。2004年发布的。<br>SE(JavaSE): standard edition，从JDK 5.0开始，改名为Java SE。<br>EE(JavaEE): enterprise edition，从JDK 5.0开始，改名为Java EE。<br>JDK 5.0 引入许多新特性，包括泛型(Generic)、可变参数、for-each、<strong>注解</strong> 等。<br>java SE 8 我上大学那年发布的(2014)。<br>Java SE 10 2018年3月发布。<br>时间过得真快….</p>
<p><strong>注解</strong> : 在 类的定义，方法的定义，成员变量的定义 前使用，格式为 <strong>@注解标记名</strong> 。   </p>
<h1 id="1-组件扫描-component-scan"><a href="#1-组件扫描-component-scan" class="headerlink" title="1. 组件扫描 (component-scan)"></a>1. 组件扫描 (component-scan)</h1><p>可以根据包的路径，把包下所有的组件扫描，如果发现组件类定义前有以下标记，将会把组件扫描的Spring IoC 容器，这样同一个包下的组件就不用一个一个的在主配置文件中配置bean了。     </p>
<ul>
<li>@Controller  </li>
<li>@Service  </li>
<li>@Repository  </li>
<li>@Component</li>
<li>@Named—需要引入第三方标准包  </li>
</ul>
<p>以上的注解可以混用，但是一般我们按类使用：     </p>
<ul>
<li>@Controller 用于扫描控制层组件  </li>
<li>@Service 扫描业务层组件  </li>
<li>@Repository 扫描数据访问层组件  </li>
<li>@Component 扫描其他组件  </li>
</ul>
<h2 id="1-1-注入对象"><a href="#1-1-注入对象" class="headerlink" title="1.1 注入对象"></a>1.1 注入对象</h2><p>一个组件扫描的例子：<br>在applicationContext.xml中，开启组件扫描<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 扫描包controller下的组件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>包controller下的组件LoginController.java ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PreDestroy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">//注解: 扫描到Spring容器</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>) <span class="comment">//等价于&lt;bean scope="prototype"&gt; , 默认singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"处理逻辑"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//了解一下</span></span><br><span class="line">  <span class="meta">@PostConstruct</span> <span class="comment">//等价于 init-method</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"初始化逻辑"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@PreDestroy</span> <span class="comment">//等价于 destroy-method</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"销毁"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注：<br>扫描到Spring IoC容器中的组件 id 默认是 <strong>此类名并且首字母小写</strong>。<br>如果想要改变 id 名， 可以在注解后加指定的id名：<br><strong>@Controller(“loginComponent1”)</strong>    </p>
<p>利用注解注入属性：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> other;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Resource</span> <span class="comment">//注入 id 为 phone(默认和属性同名) 的对象</span></span><br><span class="line">  <span class="keyword">private</span> Phone phone;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@Resource(name="指定id") 可以通过name指定id 来注入 指定的对象</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//@Autowired 按类型注入</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="1-2-注入字符串-数值"><a href="#1-2-注入字符串-数值" class="headerlink" title="1.2 注入字符串/数值"></a>1.2 注入字符串/数值</h2><p>通过 <strong>Value注解</strong> 注入，都是固定的写法，直接看一个例子掌握：  </p>
<p>MyDataSource.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"myDataSource"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSource</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"#&#123;db.username&#125;"</span>) <span class="comment">//将db对象key为username的值注入</span></span><br><span class="line">	<span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"#&#123;db.password&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"#&#123;db.driver&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"#&#123;db.url&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"数据库连接操作"</span>);</span><br><span class="line">		System.out.println(userName);</span><br><span class="line">		System.out.println(password);</span><br><span class="line">		System.out.println(driver);</span><br><span class="line">		System.out.println(url);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		MyDataSource ds=ac.getBean(<span class="string">"myDataSource"</span>,MyDataSource.class);</span><br><span class="line">		ds.getConnection();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置文件applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/util/spring-util-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 扫描data包下的组件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"data"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 实例化一个properties对象，用于存储配置信息 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">"db"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driver"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"url"</span>&gt;</span>jdbc:mysql://cherry.mitrecx.cn:3306/DBmitre?useUnicode=true&amp;amp;characterEncoding=utf8<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当然，这些prop也可以写在文件中，通过location属性加载 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">util:properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>执行结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/2018-10-15_231228.png" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/13/Spring学习3-注入/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/13/Spring学习3-注入/" itemprop="url">Spring学习3-Spring IoC各种类型注入</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-13T21:18:24+08:00">
                2018-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://docs.spring.io/spring/docs/5.1.1.RELEASE/spring-framework-reference/core.html#spring-core" target="_blank" rel="noopener">Bean Overview</a> :<br>A bean definition is essentially a recipe for creating one or more objects.<br>Bean定义本质上是创建一个或多个对象的配方(方法)。  </p>
<h1 id="1-各种类型注入的配置方式"><a href="#1-各种类型注入的配置方式" class="headerlink" title="1. 各种类型注入的配置方式"></a>1. 各种类型注入的配置方式</h1><p>给bean的属性注入值，这些配置方式都是固定的，不难理解。<br>所以直接给出一个例子展示各种类型的注入方法。<br>bean：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; friends;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;String&gt; interests;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,String&gt; books;</span><br><span class="line">	<span class="keyword">private</span> Properties db;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getFriends</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> friends;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFriends</span><span class="params">(List&lt;String&gt; friends)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.friends = friends;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getInterests</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> interests;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(Set&lt;String&gt; interests)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.interests = interests;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> books;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBooks</span><span class="params">(Map&lt;String, String&gt; books)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.books = books;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Properties <span class="title">getDb</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> db;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDb</span><span class="params">(Properties db)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.db = db;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="1-1-注入字符串，数值"><a href="#1-1-注入字符串，数值" class="headerlink" title="1.1 注入字符串，数值"></a>1.1 注入字符串，数值</h2><p>字符串注入<a href="https://mitrecx.github.io/2018/10/13/2-Spring-IoC-%E7%AE%A1%E7%90%86%E5%AF%B9%E8%B1%A1/" target="_blank" rel="noopener">上一篇博客</a>已经涉及到了。<br>数值注入的话，Spring会在内部做类型转换，所以我们可以为数值类型(如，int)注入可以转换为数值字符串。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"domain.Person"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"cx"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"24"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>注：如果想要给name属性注入空值null<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="1-2-注入-List-和-Set"><a href="#1-2-注入-List-和-Set" class="headerlink" title="1.2 注入 List 和 Set"></a>1.2 注入 List 和 Set</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"domain.Person"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"friends"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>汤姆<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>杰克<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interests"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>足球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>篮球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>乒乓球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="1-3-注入Map"><a href="#1-3-注入Map" class="headerlink" title="1.3 注入Map"></a>1.3 注入Map</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"domain.Person"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"books"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"朱光潜"</span> <span class="attr">value</span>=<span class="string">"谈美"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"亚当斯密"</span> <span class="attr">value</span>=<span class="string">"国富论"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="1-4-注入Property"><a href="#1-4-注入Property" class="headerlink" title="1.4 注入Property"></a>1.4 注入Property</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"domain.Person"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"db"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driver"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="1-5-使用表达式注入"><a href="#1-5-使用表达式注入" class="headerlink" title="1.5 使用表达式注入"></a>1.5 使用表达式注入</h2><p>#{表达式}<br>#{id名.属性} 或 #{id名.key}<br>如果是对象属性的话，需要类有getter。  </p>
<h2 id="1-6-使用-util"><a href="#1-6-使用-util" class="headerlink" title="1.6 使用 util:"></a>1.6 使用 util:</h2><p>使用 <strong>util:集合类型</strong> 可以把集合的配置放在 <strong><beans\></beans\></strong> 标签下。<br>当别的 <strong><bean\></bean\></strong> 需要时，可以直接调用集合。  </p>
<p>使用 <strong>util:</strong> 需要引入命名空间：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/util/spring-util-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"list1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>汤姆<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>杰克<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 调用集合对象list1，和前面1.2中的配置等价 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"domain.Person"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"friends"</span> <span class="attr">ref</span>=<span class="string">"list1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>注：<br><strong>util:集合类型</strong> 包括：<br>util:list<br>util:set<br>util:map<br>util:properties  </p>
<p><util: xxx\> 和 <xxx\> 的子标签是一样的。<br>当集合需要 <strong>重复利用</strong> 时，<strong>util:集合类型</strong> 显然是更好的选择。  </xxx\></util:></p>
<p>值得注意的是，<util: properties\> 可以读取文件：<br>比如，在src目录下有一个db.properties文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> key = value</span></span><br><span class="line">username = root</span><br><span class="line">password = 123</span><br><span class="line">driver = com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure></util:></p>
<p>在applicationContext.xml 文件中用 <util: properties\> 的 location 属性读取：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">"db1"</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:properties</span>&gt;</span></span><br></pre></td></tr></table></figure></util:></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/13/2-Spring-IoC-管理对象/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/13/2-Spring-IoC-管理对象/" itemprop="url">Spring学习2-Spring IoC 管理对象</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-13T03:29:07+08:00">
                2018-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-管理对象"><a href="#1-管理对象" class="headerlink" title="1. 管理对象"></a>1. 管理对象</h1><p>创建，初始化，释放资源，销毁。  </p>
<p>下载<a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">Spring jar 包</a>   </p>
<h2 id="1-1-如何管理对象"><a href="#1-1-如何管理对象" class="headerlink" title="1.1 如何管理对象"></a>1.1 如何管理对象</h2><h3 id="a-搭建Spring-IoC开发环境"><a href="#a-搭建Spring-IoC开发环境" class="headerlink" title="a. 搭建Spring IoC开发环境"></a>a. 搭建Spring IoC开发环境</h3><ol>
<li>引入相关jar包<br>spring-core-5.0.0.RELEASE<br>spring-context-5.0.0.RELEASE<br>spring-beans-5.0.0.RELEASE<br>spring-expression-5.0.0.RELEASE<br>commons-logging  </li>
<li>在src下添加applicationContext.xml文件，内容如下：    </li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="b-在applicationContext-xml文件中配置bean，通过ApplicationContext对象取得配置的bean"><a href="#b-在applicationContext-xml文件中配置bean，通过ApplicationContext对象取得配置的bean" class="headerlink" title="b. 在applicationContext.xml文件中配置bean，通过ApplicationContext对象取得配置的bean"></a>b. 在applicationContext.xml文件中配置bean，通过ApplicationContext对象取得配置的bean</h3><p>applicationContext.xml文件 <strong><font color="#00B2EE">用构造方法创建bean对象</font></strong> 配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  相当于 new GregorianCalendar(); 注意id的值唯一--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"calendar1"</span> <span class="attr">class</span>=<span class="string">"java.util.GregorianCalendar"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>java类通过ApplicationContext获取bean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例化Spring容器</span></span><br><span class="line">ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="comment">//从Spring容器中获取id为calendar1的对象</span></span><br><span class="line">Calendar c1= ac.getBean(<span class="string">"calendar1"</span>,Calendar.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上操作等价于 Calendar c1=new GregorianCalendar();</span></span><br></pre></td></tr></table></figure></p>
<p>applicationContext.xml文件 <strong><font color="#00B2EE">用静态工厂方法创建bean对象</font></strong> 配置如下(所谓工厂，就是封装了对象场景的细节)：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  相当于Calendar.getInstance() ; 注意id的值唯一--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"calendar2"</span> <span class="attr">class</span>=<span class="string">"java.util.Calendar"</span> <span class="attr">factory-method</span>=<span class="string">"getInstance"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- factory-method的值是类中的方法名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>java类通过ApplicationContext获取bean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从Spring容器中获取id为calendar2的对象</span></span><br><span class="line">Calendar c2= ac.getBean(<span class="string">"calendar2"</span>,Calendar.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上操作等价于 Calendar c2=Calendar.getInstance();</span></span><br></pre></td></tr></table></figure></p>
<p>小结：<br>不论xml配置中用构造方法创建bean对象，还是用静态工厂方法创建bean对象，在java类里获取bean的方法都是一样的。<br><strong>了解一下</strong>：<br>如果我们想要获取对象的属性，而这个属性任然是一个对象。<br>比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Date date=c2.getTime();</span><br></pre></td></tr></table></figure></p>
<p>那么如何通过Spring 配置获取呢？获取方法如下：<br>applicationContext.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"date1"</span> <span class="attr">factory-bean</span>=<span class="string">"c2"</span> <span class="attr">factory-method</span>=<span class="string">"getTime"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- factory-bean的值是Spring容器中现有的对象名 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- factory-method的值是对象中的方法名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>java类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Date date=ac.getBean(<span class="string">"date1"</span>,Date.class);</span><br></pre></td></tr></table></figure></p>
<h2 id="1-2-Spring创建bean对象—属性配置"><a href="#1-2-Spring创建bean对象—属性配置" class="headerlink" title="1.2 Spring创建bean对象—属性配置"></a>1.2 Spring创建bean对象—属性配置</h2><ol>
<li><p>控制对象创建方式：<bean\>元素的 <strong><font color="#FF34B3">scope属性</font></strong> 支持 <strong><font color="#8080f0">singleton</font></strong> 和 <strong><font color="#8080f0">prototype</font></strong> 两种创建方式。<br>scope的缺省值是singleton，<strong>一般用默认</strong>。<br><strong><font color="#8080f0">singleton</font></strong> 方式：每次 <strong>ac.getBean(“id”)</strong> 相同id取出的是同一个bean对象 (Spring容器中只实例化一个bean对象)。<br><strong><font color="#8080f0">prototype</font></strong> 方式：每次取出不是同一个bean对象。  </bean\></p>
</li>
<li><p>控制对象初始化：<bean\>元素的 <strong><font color="#FF34B3">init-method属性</font></strong> 可以指定bean对象的初始化方法，init-method的值是bean初始化方法名，这样每创建一个bean对象就会调用一次初始化方法 (注：singleton只会初始化一次)。初始化工作放在 <strong>构造方法</strong> 中的话，初始化会在对象创建过程中进行；初始化工作放在 <strong>初始化方法</strong> 中则在对象创建后进行。  </bean\></p>
</li>
<li><p>控制对象销毁：<bean\>元素的 <strong><font color="#FF34B3">destroy-method属性</font></strong> 可以指定bean对象的销毁方法。满足下面两个条件才有效：<br>—组件(bean)对象为singleton模式<br>—调用AbstractApplicationContext容器对象的close()方法   </bean\></p>
</li>
<li><p>控制singleton对象创建时机：<bean\>元素 <strong><font color="#FF34B3">lazy-init=true</font></strong> 可以推迟singleton模式的bean对象的创建时间。默认的创建ApplicationContext对象的时候，singleton模式的bean对象就会被创建；lazy-init=true singleton模式的bean对象在实例化时才被创建。  </bean\></p>
</li>
</ol>
<h1 id="2-依赖注入-dependency-injection"><a href="#2-依赖注入-dependency-injection" class="headerlink" title="2. 依赖注入(dependency injection)"></a>2. 依赖注入(dependency injection)</h1><p>利用注入设置bean 属性的值。   </p>
<p></p><h2 id="1">2.1 set注入</h2><br>举个例子，利用 <strong>set注入</strong> 设置属性的值：<br>bean：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<p>applicationContext.xml 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user1"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 信息的 set注入，底层调用的是User bean的setter --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1001"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"cx"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>处理类中调用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">User u1= ac.getBean(<span class="string">"user1"</span>,User.class);</span><br><span class="line"><span class="comment">//u1的id="1001", username="cx", password="123"</span></span><br></pre></td></tr></table></figure></p>
<p>说明：<br>如果现在需要改u1属性的值，只要修改配置文件即可，不用修改代码了。<br>注：<br>如果User新加一个属性computer，而Computer有属性cpu, memory，可以使用 <strong><font color="red">ref</font></strong> 替代 <strong><font color="red">value</font></strong> 注入。  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"comp1"</span> <span class="attr">class</span>=<span class="string">"domain.Computer"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">value</span>=<span class="string">"corei7"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"memory"</span> <span class="attr">value</span>=<span class="string">"8G"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user1"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 信息的 set注入，底层调用的是User bean的setter --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1001"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"cx"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"computer"</span> <span class="attr">ref</span>=<span class="string">"comp1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-2-构造器注入"><a href="#2-2-构造器注入" class="headerlink" title="2.2 构造器注入"></a>2.2 构造器注入</h2><p>接着上面<a href="#1">set注入的例子</a> 中的bean，现在做 <strong>构造器注入</strong> ：<br>beans:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Computer computer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id,String username,String password,Computer computer)</span> </span>&#123;</span><br><span class="line">  		<span class="keyword">this</span>.id=id;</span><br><span class="line">  		<span class="keyword">this</span>.username=username;</span><br><span class="line">  		<span class="keyword">this</span>.password=password;</span><br><span class="line">          <span class="keyword">this</span>.computer=computer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>applicationContext.xml 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--set注入Computer--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"comp2"</span> <span class="attr">class</span>=<span class="string">"domain.Computer"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">value</span>=<span class="string">"corei8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"memory"</span> <span class="attr">value</span>=<span class="string">"16G"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--构造器注入User--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user2"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 构造器注入，底层调用的是User bean的构造方法 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"1002"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"cx"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">value</span>=<span class="string">"123"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"3"</span> <span class="attr">ref</span>=<span class="string">"comp2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><del>这里不对bean的自动注入autowire做说明。</del>  </p>
<h1 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h1><p>简而言之，IoC控制反转就是把对象创建控制权 从处理类手里 交到了Spring手里 ，这一控制权改变建立在 依赖注入 的机制上。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/Spring-Framework-简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/Spring-Framework-简介/" itemprop="url">Spring学习1-Spring Framework 简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-12T01:25:37+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-为什么选择Spring-框架"><a href="#1-为什么选择Spring-框架" class="headerlink" title="1. 为什么选择Spring 框架"></a>1. 为什么选择Spring 框架</h1><p>如果没有Spring 框架，我们按照 MVC模式 开发一个 web应用，需要配置web.xml，写Servlet来处理请求，写实体类和DAO类，写jsp展示页面等。<br>这样做思路和结构都很清晰，没有什么不好。<br>那为什么我们还要用Spring 框架？<br>原因：  </p>
<ol>
<li><strong>松耦合</strong>–IoC, AOP。    </li>
<li><strong>面向切面编程(AOP)</strong>–组件复用，将系统服务(安全、事务、日志等)从业务逻辑中分离出来。  </li>
<li><strong>简化web开发</strong>–缩短开发时间。<br>可见，Spring 框架的设计哲学是优秀的，于是许多开发者选择了Spring web MVC。  </li>
</ol>
<h1 id="2-了解一下-术语Spring"><a href="#2-了解一下-术语Spring" class="headerlink" title="2. 了解一下-术语Spring"></a>2. 了解一下-术语Spring</h1><p>不同的背景下，Spring的含义是不同的。<br>通常我们说的 <strong>Spring</strong> 指的是 <strong><a href="https://spring.io/projects" target="_blank" rel="noopener">Spring项目家族</a></strong> ，包含Spring boot，Spring Framework, Spring Cloud等等。<br>这个Spring系列的博客，指的是Spring Framework。<br>没有特殊说明的话，后面Spring 默认指的是Spring Framework。  </p>
<p>Spring Framework被分离成多个模块，我们开发的web应用可以选择自己需要的模块。<br>这些模块的核心是 Core Container，<strong>包含</strong> 配置模块和依赖注入机制(dependency injection mechanism)。<br>此外，Spring Framework 支持不同的应用结构(application architecture)：  </p>
<ul>
<li>messaging(消息传递)  </li>
<li>transactional data and persistence(事务数据和持久化)  </li>
<li>web  </li>
</ul>
<p><strong>还包含</strong> 基于 <strong><font color="#00B2EE">Spring MVC</font></strong> 的web框架 和 <strong><font color="#00B2EE">Spring WebFlux</font></strong> 响应式的web框架。  </p>
<h1 id="3-Spring-的版本历史"><a href="#3-Spring-的版本历史" class="headerlink" title="3. Spring 的版本历史"></a>3. Spring 的版本历史</h1><table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.9</td>
<td>2002</td>
<td><a href>Rod Johnson</a>开发了第一版</td>
</tr>
<tr>
<td>1.0</td>
<td>2003</td>
<td>里程碑</td>
</tr>
<tr>
<td>2.0</td>
<td>2006</td>
<td></td>
</tr>
<tr>
<td>3.0</td>
<td>2009</td>
<td></td>
</tr>
<tr>
<td>4.0</td>
<td>2013</td>
<td>JavaSE 8，Groovy 2，JavaEE 7</td>
</tr>
<tr>
<td>5.0</td>
<td>2017</td>
<td>WebFlux，响应式编程</td>
</tr>
</tbody>
</table>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>1、<a href="https://docs.spring.io/spring/docs/5.1.0.RELEASE/spring-framework-reference/overview.html#overview" target="_blank" rel="noopener">Spring Framework Overview</a><br>2、<a href="https://spring.io/projects" target="_blank" rel="noopener"> Spring Projects</a><br>3、<a href="https://www.cnblogs.com/wt695742319/p/5500392.html" target="_blank" rel="noopener">SSH框架——Spring + Struts + Hibernate简介-2016</a><br>4、<a href="https://www.cnblogs.com/zyw-205520/p/4771253.html" target="_blank" rel="noopener">SSM框架——详细整合教程(Spring + SpringMVC + MyBatis)</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/10/jsp标签和el表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/10/jsp标签和el表达式/" itemprop="url">jsp标签和el表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-10T20:58:35+08:00">
                2018-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jsp/" itemprop="url" rel="index">
                    <span itemprop="name">jsp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="jsp标签和el表达式"><a href="#jsp标签和el表达式" class="headerlink" title="jsp标签和el表达式"></a>jsp标签和el表达式</h1><h2 id="1-jsp标签"><a href="#1-jsp标签" class="headerlink" title="1. jsp标签"></a>1. jsp标签</h2><p>jsp标签用来替换jsp文件中的java代码。<br>因为直接在jsp文件中写java代码，不方便维护，<br>所以sun制定了 <strong><font color="red">jsp标签技术规范</font></strong>。  </p>
<p>可以将jsp标签看做一个占位符，容器遇到jsp标签，会依据标签名找到对应的标签类，然后执行标签类中的代码。<br><strong>简而言之，jsp标签用来代替jsp文件中的java代码</strong>   </p>
<p><strong>使用jsp标签的好处：</strong><br>1、 jsp文件方便维护<br>2、 方便代码的复用  </p>
<p><strong>jstl ：java标准标签库( java standard tag lib ),</strong> apache 开发的一套标签库，捐献给sun，sun将其命名为jstl。</p>
<p><strong>如何使用 jstl</strong>：<br>1、 将jstl相关的jar文件拷贝到 WEB-INF/lib 目录下。<br>注：如果使用javaEE 5.0(包含了jstl相关的jar文件)，一般不用拷贝，不绝对，和Tomcat版本有关。<br>2、 使用 <strong><font color="#FF34B3">taglib</font></strong>  指令导入相应的标签。  </p>
<p><strong>jstl 几个常用的标签：</strong><br>1、 if<br>uri取自standard.jar的META-INF目录中的c.tld(或c-rt.tld)的uri<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/jsp-taglib1.png" alt><br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/jsp-taglib2.png" alt><br>c 是命名空间的前缀(别名)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">""</span> <span class="attr">var</span>=<span class="string">""</span> <span class="attr">scope</span>=<span class="string">""</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- test属性为true时，容器会执行if标签体，test属性可以使用el表达式--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- var属性：指定绑定名称（绑定结果是test结果） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scope属性：指定绑定范围，page，request，session，application--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、choose<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--when可以出现一次或多次，当test属性为true时，执行when下的语句--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--otherwise可以出现0次或1次，表示其他情况--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、forEach<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用来遍历集合或数组--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">""</span> <span class="attr">var</span>=<span class="string">""</span> <span class="attr">varStatus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--items属性指定要遍历的集合或数组--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--var属性指定一个绑定名，绑定范围固定是pageContext--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注：每次从集合或数组中取一个元素，然后绑定到pageContext上，绑定名由var属性指定--&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><a href="#1">tld自定义jsp标签的实现</a></p>
<h2 id="2-el表达式"><a href="#2-el表达式" class="headerlink" title="2. el表达式"></a>2. el表达式</h2><p>el (Expression Language) 表达式是一套简单的运算规则，用于给jsp标签的属性赋值，也可以直接输出。  </p>
<p><strong>el 表达式的使用：</strong><br>1、 <strong><font color="#8080f0">访问 bean 的属性</font></strong>  </p>
<ul>
<li>方式一：<strong><font color="#8080f0">${user.name}</font></strong><br>容器会依次从 pageContext，request，session，application 中查找（getAttribute) 绑定名为 <strong>“user” 的对象</strong> ，找到该对象后，调用该对象的 <strong>“getName” 方法</strong> ，然后输出。<br>可以使用 pageScope, requestScope,sessionScope,application 指定查找范围，如，${pageScope.user.name}  </li>
<li>方式二：<strong><font color="#8080f0">${user[“name”]}</font></strong><br>[ ]里可以是一个绑定名，也可以是从0开始的下标（访问数组）  </li>
</ul>
<p>2、 <strong><font color="#008B00">进行一些简单的运算，运算结果可以给jsp标签赋值，也可以直接输出</font></strong>  </p>
<ul>
<li>算术运算 “ <strong>+, -, *, /, %</strong> “<br><strong><font color="#008B00">如，${1+1}, ${“3”+”4”}</font></strong></li>
<li>关系运算 “ <strong>&gt;, &gt;=, &lt;, &lt;=, ==, !=</strong> “<br><strong><font color="#008B00">如，${2&gt;1}, ${user.name==”cx”}</font></strong>  </li>
<li>逻辑运算 “ <strong>&amp;&amp;, ||, !</strong> “<br><strong><font color="#008B00">如，${1&lt;2 || 3&lt;4} </font></strong>  </li>
<li>empty运算, 判断集合是否为空，或字符串是否是一个空字符串<br><strong><font color="#008B00">如，${empty str}</font></strong> str为空返回true，不空为false  </li>
</ul>
<p>3、 <strong><font color="#00B2EE">读取请求参数值  (jsp负责展示数据，不适合处理请求)</font></strong>  </p>
<ul>
<li><strong><font color="#00B2EE">${param.username}</font></strong><br>等价于 request.getParameter(“username”)  </li>
<li><strong><font color="#00B2EE">${paramValues.friends}</font></strong><br>等价于request.getParameterValues(“friends”)  </li>
</ul>
<p>如果 el 表达式解析不了，请检查 web.xml 文件 的 web-app 标签属性，如下配置：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">	xmlns=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span><br><span class="line">	xsi:schemaLocation=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span><br><span class="line">	id=<span class="string">"WebApp_ID"</span> version=<span class="string">"3.1"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></p>
<p></p><h2 id="1">3. jsp 自定义标签</h2><br>tld (tag lib descriptor)<br>自己写一个标签：<br>1、 在WEB-INF目录下建一个文件hello.tld, 文件内容如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">short-name</span>&gt;</span>ExampleTLD<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">uri</span>&gt;</span>/WEB-INF/hello.tld<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>完成一个自定义jsp标签库<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>test.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p>
<p><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/jspTLD1.png" alt><br>2、 编写标签的实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.JspWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.SimpleTagSupport;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		JspWriter out=getJspContext().getOut();</span><br><span class="line">		out.println(<span class="string">"自定义标签输出，由JspWriter输出"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3、 使用自定义的tag<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"/WEB-INF/hello.tld"</span> <span class="attr">prefix</span>=<span class="string">"c1"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"font-size: 30px;"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>自定义标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c1:hello</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/jspTLD2.png" alt>  </p>
<p>注：<br>如果在标签里添加属性，需要在实现类里加上对应的属性和setter，实现类属性的值是从标签属性中获取的。<br>同时还需要在tld 文件中配置 <strong>attribute</strong> 标签，<br><strong>attribute</strong> 的子标签(tag Subelements/嵌套元素nested elements) 介绍如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">(Optional) Defines the name of the attribute as it appears in the tag element in the JSP page. For example:</span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>myAttribute<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  (Required)attribute name</span><br><span class="line">  <span class="tag">&lt;<span class="name">required</span>&gt;</span>true | false<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">  (Optional) Defines whether this attribute has optional use in the JSP page.   </span><br><span class="line">  If not defined here, the default is false — that is, the attribute is optional by default.</span><br><span class="line">  If true is specified, and the attribute is not used in a JSP page, a translation-time error occurs.</span><br><span class="line">  <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true | false<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">  (Optional) Defines whether this attribute can take a scriptlet expression as a value,</span><br><span class="line">  allowing it to be dynamically calculated at request time.</span><br><span class="line">  If this element is not specified, the value is presumed to be false.</span><br><span class="line"><span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>这只是一个 taglib 入门的例子，很简单，实现类继承的 SimpleTagSupport 还有一些方法, 这里不再深入学习</strong></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>1、 <a href="https://docs.oracle.com/cd/E21043_01/web.1111/e13722/tld.htm" target="_blank" rel="noopener">Creating a Tag Library Descriptor</a>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/09/eclipse中使用git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/09/eclipse中使用git/" itemprop="url">eclipse中使用git</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-09T11:12:53+08:00">
                2018-10-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="eclipse-使用-git-进行版本控制"><a href="#eclipse-使用-git-进行版本控制" class="headerlink" title="eclipse 使用 git 进行版本控制"></a>eclipse 使用 git 进行版本控制</h1><p>如果没有git插件，需要先<a href="https://www.eclipse.org/egit/download/" target="_blank" rel="noopener">安装git插件</a>。    </p>
<p>git配置如下图：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/blog-2018-09/eclipse-git1.png" alt>  </p>
<h2 id="git-eclipse中的项目："><a href="#git-eclipse中的项目：" class="headerlink" title="git eclipse中的项目："></a>git eclipse中的项目：</h2><ol>
<li>在GitHub上建一个repository  </li>
<li>本地项目右键, Team , share Project , Git , 创建本地repository(勾选use or create)  </li>
<li>新建的本地仓库有 <strong>NO-HEAD</strong> 标识，要先把远程仓库pull到本地仓库，使用 https协议  </li>
<li>commit 到本地仓库  </li>
<li>push 到 GitHub远程仓库  </li>
</ol>
<p>这是我git的<a href="https://github.com/mitrecx/youranAccount" target="_blank" rel="noopener">结果</a>，<br>注意一下.gitignore , 这个文件里是提交时指定忽略的文件。<br>git 相关学校 <a href="https://mitrecx.github.io/2017/11/26/git%E7%AE%80%E5%8D%95%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">看这篇博客</a>.  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/08/彼得-杜拉克个人管理思维/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/08/彼得-杜拉克个人管理思维/" itemprop="url">彼得 杜拉克个人管理思维</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-08T21:50:19+08:00">
                2018-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>西元前四百四十年，有一个著名的希腊雕刻家叫做–菲狄亚斯。<br>菲狄亚斯在当时被委任要制作帕特农神庙上面的雕像。<br>但是当菲狄亚斯去跟市政府请款时，市政府却不愿意付钱。<br>原因是这些雕像位于神庙的屋顶上，而神庙位于山丘的制高点，<br>所以人们只能够看到雕像的正面。<br>然而，菲狄亚斯申请了整座立体雕像的费用，所以市政府不愿意拨款。<br>这时，菲狄亚斯反驳说，“you are wrong, The gods can see.”   </p>
<p>如果我们今天是为了某一个人或某一个团体的认定而去做某件事。<br>那我只会做人们看得到的那个部分。<br>那我也只会在那个部分有所成长，在那个部分有所得。<br><strong>但如果我想着举头三尺有神明</strong>，<br>我就会超出别人的期待来做事情。<br>我就不再是为了别人的认同和掌声来做这件事。   </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/23/servlet线程安全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/23/servlet线程安全/" itemprop="url">servlet线程安全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-23T09:25:54+08:00">
                2018-09-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="servlet-线程安全问题"><a href="#servlet-线程安全问题" class="headerlink" title="servlet 线程安全问题"></a>servlet 线程安全问题</h1><p>容器在默认情况下，只会创建一个 <strong>servlet实例</strong>。<br>容器收到一个请求，就会 <strong>启动一个线程</strong> 来处理。  </p>
<p>如果有多个请求同时访问某个 servlet，<br>就会有多个线程调用同一个 servlet实例，<br>就有可能产生线程安全问题（如，这些线程要修改servlet的属性）。   </p>
<p>一个 多线程访问 servlet 示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		count++;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 输出线程名+线程个数</span></span><br><span class="line">		System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>利用 jMeter 测试：<br>1、 打开 jMeter，创建一个线程组<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/jMeter1.png" alt>  </p>
<p>2、 配置线程组<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/jMeter2.png" alt>  </p>
<p>3、 为线程组添加 访问协议类型，配置并启动<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/jMeter3.png" alt>  </p>
<p>4、 测试结果<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/jMeter4.png" alt>  </p>
<h1 id="解决servlet-线程安全问题"><a href="#解决servlet-线程安全问题" class="headerlink" title="解决servlet 线程安全问题"></a>解决servlet 线程安全问题</h1><p>把可能产生线程不安全的程序 用 <strong>synchronized(this)</strong> 括起来。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">			count++;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 输出线程名+线程个数</span></span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + count);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试结果：<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/jMeter5.png" alt>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/22/servlet监听器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/22/servlet监听器/" itemprop="url">servlet监听器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-22T09:25:36+08:00">
                2018-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h1><p>监听器 是 servlet规范 中定义的一种特殊的组件，<strong>用来监听容器产生的事件</strong>。  </p>
<p>容器产生的事件主要有两大类：<br>1、 生命周期相关的事件<br>容器创建或销毁了 request，session，<strong>servlet上下文</strong> 时产生的事件。  </p>
<p>2、 绑定数据相关的事件<br>调用了 request，session，<strong>servlet上下文</strong> 的 setAttribute，removeAttribute 时产生的事件。  </p>
<h2 id="1-servlet-上下文"><a href="#1-servlet-上下文" class="headerlink" title="1. servlet 上下文"></a>1. servlet 上下文</h2><p><strong>什么是 servlet上下文 ？</strong><br>  容器启动之后，<strong>会为每一个web应用 创建唯一的一个符合ServletContext接口的对象</strong>。  </p>
<h3 id="1-1-特点"><a href="#1-1-特点" class="headerlink" title="1.1 特点"></a>1.1 <font color="orange">特点</font></h3><p>1、 唯一性： 一个web应用 对应唯一一个上下文。<br>2、 持久性： 只要容器没有关闭，并且应用没有被删除，则上下文会一直存在。  </p>
<p>获得上下文的 <strong>4种途径</strong>：<br><strong><font color="green">GenericServlet，或 ServletConfig，或 FilterConfig，或 HttpSession</font></strong><br>提供的 <strong>getServletContext</strong> 方法。  </p>
<h3 id="1-2-上下文的作用："><a href="#1-2-上下文的作用：" class="headerlink" title="1.2 上下文的作用："></a>1.2 <font color="orange">上下文的作用</font>：</h3><p>将数据绑定到上下文，应用可以随时访问。<br>1、绑定数据，<br>setAttribute，getAttribute，removeAttribute<br>注：<br>request.setAttribute, session.setAttribute, ServletContext.setAttribute, <strong>在绑定数据时，应该优先使用生命周期短的对象绑定</strong>，这样可以节约内存空间( request &lt; session &lt; context )。  </p>
<p>例如：<br>在 ServletA对象中绑定 一条数据，在ServletRead对象中读取并显示。<br>ServletA.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextA</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">// 获得上下文context，注：HTTPServlet 是 GenericServlet的子类</span></span><br><span class="line">		ServletContext ctx= getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将一条数据绑定到 context</span></span><br><span class="line">		ctx.setAttribute(<span class="string">"userList"</span>, <span class="string">"陈兴，mitre"</span>);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ContextRead.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextRead</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">//获得上下文context</span></span><br><span class="line">		ServletContext ctx=getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取context绑定的数据</span></span><br><span class="line">		String ul=(String)ctx.getAttribute(<span class="string">"userList"</span>);</span><br><span class="line">		out.println(ul);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>web.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>web06-context<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>write<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.ContextA<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>write<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/set<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>read<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.ContextRead<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>read<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/get<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 访问全局的初始化参数。<br>web.xml配置：<context-param\><br>ServletContext对象读取: String getInitParameter(String paramterName)  </context-param\></p>
<p>例如：<br>接着上一个例子<br>在 web.xml 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局的初始化参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>company<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>宇信<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 ServletRead.java 中读取初始化参数(添加两行代码):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextRead</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		<span class="comment">//获得上下文context</span></span><br><span class="line">		ServletContext ctx=getServletContext();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取context绑定的数据</span></span><br><span class="line">		String ul=(String)ctx.getAttribute(<span class="string">"userList"</span>);</span><br><span class="line">		out.println(ul);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取 全局的初始化参数</span></span><br><span class="line">		String companyName=ctx.getInitParameter(<span class="string">"company"</span>);</span><br><span class="line">		out.println(<span class="string">"&lt;br/&gt;"</span>+companyName);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果:<br><img src="https://mitre.oss-cn-hangzhou.aliyuncs.com/java-%E8%BE%BE%E5%86%85%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/servlet-context-01.png" alt>  </p>
<h2 id="2-监听器"><a href="#2-监听器" class="headerlink" title="2. 监听器"></a>2. 监听器</h2><p>写一个监听器：<br>1、 写一个 java类，实现相应的监听器接口。<br>注：<br>要依据监听的事件类型来选择合适的接口。<br>比如，要监听 <strong>session</strong> 的创建和销毁，需要实现 <strong>HttpSessionListener接口</strong>。  </p>
<p>2、 实现接口方法，完成监听处理逻辑。  </p>
<p>3、 配置 web.xml  </p>
<p>实例：<br>使用监听器统计在线人数。  </p>
<p>配置web.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--首页--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>web.CountOnline<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--退出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>logout<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>web.LogOutServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>logout<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/logout<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>退出界面/首页 index.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=ISO-8859-1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	当前系统在线人数：</span><br><span class="line">	<span class="tag">&lt;<span class="name">%=</span> <span class="attr">application.getAttribute</span>("<span class="attr">count</span>") %&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"logout"</span> &gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>CountOnline类 实现 HttpSessionListener 接口。<br>当前浏览器 HttpSession 还不存在时，每次打开 <a href="http://localhost:8080/web06-context/" target="_blank" rel="noopener">http://localhost:8080/web06-context/</a> 地址，<br>都会触发 sessionCreated 方法，继而创建 HttpSession 对象。<br>如果当前浏览器 已经有 HttpSession 对象了，那么就不会触发 sessionCreated 方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountOnline</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  session对象创建时 会调用此方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent arg0)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session对象 正在创建.."</span>);</span><br><span class="line">		<span class="comment">// 通过HttpSessionEvent 获取 HttpSession 对象</span></span><br><span class="line">		HttpSession session=arg0.getSession();</span><br><span class="line">		<span class="comment">// 通过会话session 获取上下文ServletContext</span></span><br><span class="line">		ServletContext sctx=session.getServletContext();</span><br><span class="line">		Integer count=(Integer)sctx.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="keyword">if</span>(count==<span class="keyword">null</span>) &#123;</span><br><span class="line">			count=<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			count++;</span><br><span class="line">		&#125;</span><br><span class="line">		sctx.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * session对象销毁时 会调用此方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent arg0)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session对象 正在销毁。。"</span>);</span><br><span class="line">		HttpSession httpSession=arg0.getSession();</span><br><span class="line">		ServletContext sctx=httpSession.getServletContext();</span><br><span class="line">		Integer count=(Integer)sctx.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		count--;</span><br><span class="line">		sctx.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>退出登录(销毁HttpSession): LogOutServlet.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogOutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		HttpSession hSession=request.getSession();</span><br><span class="line">		hSession.invalidate();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/21/servlet过滤器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mitre">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MITRE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/21/servlet过滤器/" itemprop="url">servlet过滤器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-21T09:25:24+08:00">
                2018-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/servlet/" itemprop="url" rel="index">
                    <span itemprop="name">servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h1><p>servlet 规范中 定义的一种特殊的组件，用来拦截容器的调用过程。  </p>
<p>容器收到请求后，通常情况下会调用servlet 的 service 方法来处理请求，<br>如果有过滤器，则 <strong>容器先调用过滤器的方法</strong>。  </p>
<p><strong>注：</strong>  容器一启动，就会创建过滤器。  </p>
<h2 id="写一个-过滤器"><a href="#写一个-过滤器" class="headerlink" title="写一个 过滤器"></a>写一个 过滤器</h2><p>1、 写一个 java类，实现 <strong>Filter 接口</strong>。  </p>
<p>2、 在 <strong>doFilter方法</strong> 里，编写拦截处理逻辑。  </p>
<p>3、 配置 过滤器 ( web.xml )。  </p>
<p>实例：<br>写一个评论页面，在评论框中输入评论，<br>如果评论包含“敏感字”就不显示评论，<br>如果不包含就显示评论。  </p>
<p>1、 在根目录webContent下，写一个 <strong>comment.jsp</strong> 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=utf-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"comment"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">			评论: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、 写一个 CommentServlet.java， 先不考虑过滤：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> comment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line">		String comment = request.getParameter(<span class="string">"content"</span>);</span><br><span class="line">		out.println(<span class="string">"&lt;h1&gt;你的评论是: "</span> + comment + <span class="string">"&lt;/h1&gt;"</span>);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置一下 <strong>web.xml</strong> ，然后 Tomcat部署，debug ,可以正常访问，下面加入过滤器。  </p>
<p>3、写一个过滤器 <strong>CommentFilterA.java</strong>，屏蔽敏感字”傻” ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentFilterA</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器启动后，会创建过滤器对象 只会创建一个</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommentFilterA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的构造 方法"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器在创建好 过滤器对象 之后， 接下来会调用对象的init 方法 init 方法只会执行一次 注： 可以在web.xml 中配置</span></span><br><span class="line"><span class="comment">	 * &lt;init-param&gt;提供初始化参数 由 FilterConfig arg 来读取</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//可以定义一个属性，来保存 容器(web.xml,init-param)传过来的FilterConfig对象</span></span><br><span class="line">		<span class="comment">//config=arg0</span></span><br><span class="line">    <span class="comment">//在别处 就可以 读初始化参数:</span></span><br><span class="line">    <span class="comment">//String ils = config.getParameter("illegalString");</span></span><br><span class="line">		System.out.println(<span class="string">"FilterA init方法。。"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 容器调用 doFilter方法来处理请求。</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ServletRequest</span></span><br><span class="line"><span class="comment">	 *            arg0 请求对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ServletResponse</span></span><br><span class="line"><span class="comment">	 *            arg1 响应对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> FilterChain</span></span><br><span class="line"><span class="comment">	 *            arg2 过滤器链 如果调用 过滤器链 的 doFilter方法 则容器会继续向后调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest arg0, ServletResponse arg1, FilterChain arg2)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的 doFilter 方法 开始执行！"</span>);</span><br><span class="line">		<span class="comment">// 强转，因为要调用的方法是 HttpServletRequest子类的方法</span></span><br><span class="line">		HttpServletRequest request = (HttpServletRequest) arg0;</span><br><span class="line">		HttpServletResponse response = (HttpServletResponse) arg1;</span><br><span class="line">		<span class="comment">// 先执行过滤器，对请求报文 utf-8 编码处理</span></span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line"></span><br><span class="line">		String content = request.getParameter(<span class="string">"content"</span>);</span><br><span class="line">		<span class="keyword">if</span> (content.indexOf(<span class="string">"傻"</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">// 包含了敏感字</span></span><br><span class="line">			out.println(<span class="string">"&lt;h1&gt;评论包含了敏感字--傻&lt;/h1&gt;"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 没有包含敏感字，继续向后调用</span></span><br><span class="line">			arg2.doFilter(arg0, arg1);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"FilterA 的 doFilter 方法 执行完毕！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4、配置 <strong>web.xml</strong> , 添加 过滤器配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>web05-Filter<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filterA<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>web.CommentFilterA<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 初始化参数，非必须，通过FilterConfig对象读取 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>illegalString<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>猪<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filterA<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/comment<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>comt<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>comment.CommentServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>comt<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/comment<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>5、部署，测试可以实现过滤 “傻” 字。 第一个 <strong>java过滤器</strong> 完成。  </p>
<p><strong>注：</strong><br>当有多个过滤器时，<br>容器会依据 <strong><filter-mapping\></filter-mapping\></strong> 在web.xml 中的先后顺序 来调用。在前面的先调用。   </p>
<h2 id="java过滤器的优点"><a href="#java过滤器的优点" class="headerlink" title="java过滤器的优点"></a>java过滤器的优点</h2><p>1、 在不修改源程序的基础上，为程序增加一些过滤条件（过滤器独立于已存在的servlet程序）。   </p>
<p>2、 将多个组件相同的处理逻辑集中写在过滤器里面，方面代码维护。<br>比如，request.getSession 做登录验证。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://mitre.oss-cn-hangzhou.aliyuncs.com/img/vlcsnap-2018-02-22-21h01m56s237.png" alt="mitre">
            
              <p class="site-author-name" itemprop="name">mitre</p>
              <p class="site-description motion-element" itemprop="description">Goals determine what you are going to be</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">102</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.yanmin99.com/" title="yanmin" target="_blank">yanmin</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://whark.cn" title="大鹏" target="_blank">大鹏</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.notall.cn/" title="zkp" target="_blank">zkp</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://qiracle.cn/" title="强强" target="_blank">强强</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mitre</span>

  
</div>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">totle: <span id="busuanzi_value_site_pv"></span> times</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">Visitors: <span id="busuanzi_value_site_uv"></span></span>
    <span class="post-meta-divider">|</span>



  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
